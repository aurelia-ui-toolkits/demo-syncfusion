/*!
*  filename: ej.olap.base.min.js
*  version : 12.3
*  Copyright Syncfusion Inc. 2001 - 2014. All rights reserved.
*  Use of this code is subject to the terms of our license.
*  A copy of the current license can be obtained at any time by e-mailing
*  licensing@syncfusion.com. Any infringement will be prosecuted under
*  applicable laws. 
*/
(function(n){typeof define=="function"&&define.amd?define(["./../common/ej.core.min"],n):n()})(function(){(function(n,t,i){t.olap=t.olap||{};t.olap.base={_initProperties:function(){this._columnHeaders=[];this._rowHeaders=[];this._valueCells=[];this.pivotEngine=[];this.olapCtrlObj=null;this._cBIndx=null;this._rBIndx=null;this._OlapDataSource;this._measureDt={};this._cTotIndexInfo=null;this._rTotIndexInfo=null;this._kpi=null},_initControlProperties:function(n){n._drilledCellSet=[];n.XMLACellSet=null;n._fieldData={};n.pluginName=="ejPivotGrid"&&this._getFieldItemsInfo(n);this._currIndex={};this._isRowDrilled=!1;this._isColDrilled=!1},getJSONData:function(t,i,r){var f,o,e,u;t.action&&t.action=="initialLoad"&&(this._initControlProperties(r),this._applyTrim(r));this._initProperties();this.olapCtrlObj=n.extend({},r);this._OlapDataSource=i;f="";o=i.data;r.model.enableGroupingBar&&r._createGroupingBar(i);f=i.MDXQuery?i.MDXQuery:this._getParsedMDX(i,i.cube);u=this._getConnectionInfo(this.olapCtrlObj.model.dataSource.data);e='<Envelope xmlns="http://schemas.xmlsoap.org/soap/envelope/"> <Header><\/Header> <Body> <Execute xmlns="urn:schemas-microsoft-com:xml-analysis"> <Command> <Statement> '+f+" <\/Statement> <\/Command> <Properties> <PropertyList> <Catalog>"+i.catalog+"<\/Catalog> <LocaleIdentifier>"+u.LCID+"<\/LocaleIdentifier> <\/PropertyList> <\/Properties><\/Execute> <\/Body> <\/Envelope>";t.action=="drilldown"?this.olapCtrlObj.doAjaxPost("POST",u.url,{XMLA:e},this._onDemandExpand,null,t):this.olapCtrlObj.doAjaxPost("POST",u.url,{XMLA:e},this._generateJSONData,null,t)},_getParsedMDX:function(n,r){if(n!=i){var e="",u,f,o;u=t.olap._mdxParser._getRowMDX(n);f=t.olap._mdxParser._getcolumnMDX(n);u=u.length>0?",NON EMPTY("+u+")\n dimension properties MEMBER_TYPE,CHILDREN_CARDINALITY, PARENT_UNIQUE_NAME  ON ROWS":"";o=t.olap._mdxParser._getSlicerMDX(n,this.olapCtrlObj);e="\nSelect \nNON EMPTY("+(f==""?"{}":f)+")\ndimension properties MEMBER_TYPE,CHILDREN_CARDINALITY, PARENT_UNIQUE_NAME  ON COLUMNS \n"+u+"\n "+t.olap._mdxParser._getIncludefilterQuery(n,r,this.olapCtrlObj)+o+"\n CELL PROPERTIES VALUE, FORMAT_STRING, FORMATTED_VALUE \n ";f==""&&e.replace(/NON EMPTY/g," ")}return e},_getAxisElementsUName:function(n){for(var i="",t=0;t<n.length;t++)i+=i==""?"{"+n[t].uniqueName+"}":", {"+n[t].uniqueName+"}";return i},_generateJSONData:function(t,r){var e=[],h=[],o,a,y,v,s,c,l,u,f;if(n(r).find("Error").length>0)return this.olapCtrlObj._createErrorDialog(n(r).find("faultstring").text(),t.action),!1;if(n(r).find("Axis[name|='SlicerAxis']").remove(),this.olapCtrlObj.XMLACellSet=n(r).find("Axes, CellData"),y=[],t=="onDemandDrill"&&(this.olapCtrlObj.XMLACellSet=r),o=n(this.olapCtrlObj.XMLACellSet).find("Axis[name|='Axis0'] Tuple"),a=n(this.olapCtrlObj.XMLACellSet).find("Axis[name|='Axis1'] Tuple"),o.length>0){for(v=n(this.olapCtrlObj.XMLACellSet).find("CellData Cell"),this._columnHeaders=this._getHeaderCollection(o,"colheader"),this._rowHeaders=this._getHeaderCollection(a,"rowheader"),this._valueCells=this._getValueCells(v,o.length),indexRCell=this._measureDt.axis=="rowheader"?n.Enumerable.From(this._rowHeaders.maxLvlLen).Sum()+1:n.Enumerable.From(this._rowHeaders.maxLvlLen).Sum(),indexCCell=this._measureDt.axis=="colheader"?n.Enumerable.From(this._columnHeaders.maxLvlLen).Sum()+1:n.Enumerable.From(this._columnHeaders.maxLvlLen).Sum(),this._populateEngine(this._rowHeaders.headers,this._columnHeaders.headers,this._valueCells),n(this.olapCtrlObj).find(".pivotGridTable").remove(),s=this._rowHeaders.headers.length+indexCCell,c=this._columnHeaders.headers.length+indexRCell,this.pivotEngine.length>1&&(s=this.pivotEngine.length),u=0;u<s;u++)for(f=0;f<c;f++)e[f]==i&&(e[f]=[]),this.pivotEngine[u]!=i&&this.pivotEngine[u][f]!=i?(e[f][u]={Index:f+","+u,CSS:this.pivotEngine[u][f].CSS==""?"none":this.pivotEngine[u][f].CSS==i?"value":this.pivotEngine[u][f].CSS,Value:this.pivotEngine[u][f].Value,State:this.pivotEngine[u][f].ChildCount>0?2:this.pivotEngine[u][f].ChildCount<0?1:0,RowSpan:this.pivotEngine[u][f].RowSpan!=i?this.pivotEngine[u][f].RowSpan:1,ColSpan:this.pivotEngine[u][f].ColSpan!=i?this.pivotEngine[u][f].ColSpan:1,Info:this.pivotEngine[u][f].UName+"::"+this.pivotEngine[u][f].LName+"::"+this.pivotEngine[u][f].Value+"::"+this.pivotEngine[u][f].PUName,Span:"None",Expander:1},this.pivotEngine[u][f].kpiInfo&&(e[f][u].kpi=this.pivotEngine[u][f].kpi,e[f][u].kpiInfo=this.pivotEngine[u][f].kpiInfo),this.pivotEngine[u][f].ActualValue&&(e[f][u].ActualValue=this.pivotEngine[u][f].ActualValue)):this.pivotEngine[u]!=i&&(l="none",u<indexCCell&&f<indexRCell&&(l="rowheader"),e[f][u]={Index:f+","+u,CSS:l,Value:"",State:0,RowSpan:1,ColSpan:1,Info:"",Span:"None",Expander:0});if(typeof this.olapCtrlObj.model.dataSource.data=="string")this.olapCtrlObj.generateJSON({baseObj:this},e);else{for(u=0;u<c;u++)for(f=0;f<s;f++)e[u]!=i&&e[u][f]!=i&&h.push(e[u][f]);this.olapCtrlObj._dataModel="XMLA";this.olapCtrlObj.setJSONRecords(JSON.stringify(h));this.olapCtrlObj.renderControlFromJSON(h);t.action&&t.action=="initialLoad"&&(this.olapCtrlObj._trigger("renderSuccess",this.olapCtrlObj),this.olapCtrlObj._fieldData={hierarchy:this.olapCtrlObj._fieldData.hierarchy});this.olapCtrlObj._ogridWaitingPopup.hide();this._columnHeaders=this._rowHeaders=this._valueCells=this.pivotEngine=[];this._cBIndx=this._rBIndx=null;this._measureDt={axis:"",posision:null};this._cTotIndexInfo=this._rTotIndexInfo=null}}else this.olapCtrlObj._generateJSONRecord({activeObj:this.olapCtrlObj,measureDetails:this._measureDt},transeposeEngine)},_onDemandExpand:function(t,i){var et=i,f,it,r="",e=this.olapCtrlObj.XMLACellSet,b,k,d=n(this.olapCtrlObj.XMLACellSet).find("Axis[name='Axis0'] Tuple").length,c=n(this.olapCtrlObj.XMLACellSet).find("Axis[name='Axis1'] Tuple").length,y,rt=0,ut=0,h,u,nt,ft,tt;c=c?c:1;rt=n(i).find("CellData Cell").length;ut=n(this.olapCtrlObj.XMLACellSet).find("CellData Cell").length;it=t.cellInfo.previousElements.split(">#>");var l=n(i).find("Axis[name|='Axis0'] Tuple"),a=n(i).find("Axis[name|='Axis1'] Tuple"),b=l.length;k=a.length;n(i).find("Axis[name='SlicerAxis']").remove();var g=t.cellInfo.itemPosition,v,p,o=0,s=!1,w="";for(p=t.cellInfo.axis=="rowheader"?a[0]:l[0],r=v=n(p).find("Member:nth-child("+(g+1)+") PARENT_UNIQUE_NAME").text(),h=g+1;h>0;h--)e=n(e).find("Tuple Member:nth-child("+h+") UName:contains('"+v+"')").parents("tuple"),v=n(p).find("Member:nth-child("+(h-1)+") UName").text(),w=v+w;if(r=w+r,y=e.index()+1,r=t.cellInfo.previousElements.split(">#>").join().replace(/,/g,""),f=t.cellInfo.preRepItm.split(">#>").join().replace(/,/g,""),this.olapCtrlObj._drilledCellSet&&(o=this.olapCtrlObj._drilledCellSet.length),this.olapCtrlObj._drilledCellSet[0]&&o)for(u=0;u<o;u++){for(nt=this.olapCtrlObj._drilledCellSet[u].length,ft=t.cellInfo.parentUniqueName,cEllen=0;cEllen<nt;cEllen++)if(t.cellInfo.previousElements.startsWith(this.olapCtrlObj._drilledCellSet[u][cEllen].key)){this.olapCtrlObj._drilledCellSet[u].push({key:r,repItms:f,cSet:n(i).find("Axes, CellData").clone(!0)});s=!0;break}else if(this.olapCtrlObj._drilledCellSet[u][cEllen].key.startsWith(t.cellInfo.previousElements)){this.olapCtrlObj._drilledCellSet[u].splice(cEllen,0,{key:r,repItms:f,cSet:n(i).find("Axes, CellData").clone(!0)});s=!0;break}if(s)break}else this.olapCtrlObj._drilledCellSet[0]=[],this.olapCtrlObj._drilledCellSet[0][0]={key:r,repItms:f,cSet:n(i).find("Axes, CellData").clone(!0)},s=!0;s||(this.olapCtrlObj._drilledCellSet[o]=[],this.olapCtrlObj._drilledCellSet[o].push({key:r,repItms:f,cSet:n(i).find("Axes, CellData").clone(!0)}));t.cellInfo.axis=="rowheader"?(tt=n(i).find("Axis[name|='Axis1'] Tuple"),this._insertCellSet("rowheader",e,a,l,k,d,b,y,i)):(tt=n(i).find("Axis[name|='Axis1'] Tuple"),this._insertCellSet("colheader",e,l,a,c,d,b,y,i));this._generateJSONData("onDemandDrill",this.olapCtrlObj.XMLACellSet)},_insertCellSet:function(t,i,r,u,f,e,o,s,h){var g=n(n(h).find("CellData Cell")[0]).clone(),a,l,c,v,it;n(g).find("FmtValue").text("");i.length>1?n(i[0]).after(r):n(i).after(r);l=e;t=="rowheader"?a=n(this.olapCtrlObj.XMLACellSet).find("Axis[name|='Axis0'] Tuple"):(a=n(this.olapCtrlObj.XMLACellSet).find("Axis[name|='Axis1'] Tuple"),l=o);var y=0,nt=n(a).filter(function(t,i){if(u[y]&&n(i).find("UName").text()==n(u[y]).find("UName").text())return y++,!0}),p=0,w=!1;for(c=0;c<f;c++){var tt="",b=0,k=0,d;for(d=t=="rowheader"?(s+c)*l:c*(e+l)+s,v=0;v<l;v++)(t!="rowheader"||n(nt[b]).index()!=v)&&(t!="colheader"||n(nt[p]).index()!=c)&&a.length?n(this.olapCtrlObj.XMLACellSet).find("CellData Cell:nth-child("+(d+k)+")").after(n(g).clone()):(it=t=="rowheader"?c*o:p*o,tt=n(n(h).find("CellData Cell")[it+b]).clone(),n(this.olapCtrlObj.XMLACellSet).find("CellData Cell:nth-child("+(d+k)+")").after(tt),b++,w=!0),k++;t=="colheader"&&(w&&p++,w=!1)}},_onDemandCollapse:function(t,i){var f,e,o,r,u,s=t.drilledMembers[t.drilledMembers.length-1].cSet;e=n(this.olapCtrlObj.XMLACellSet).find("Axis[name|='Axis0'] Tuple");f=n(this.olapCtrlObj.XMLACellSet).find("Axis[name|='Axis1'] Tuple");r=n(s).find("Axis[name|='Axis0'] Tuple");u=n(s).find("Axis[name|='Axis1'] Tuple");try{o=i=="rowheader"?u:r;i=="rowheader"?this._removeCellSets(o,f,e,r,u,i):this._removeCellSets(o,e,f,u,r,i);this.olapCtrlObj.model.dataSource=this.olapCtrlObj._clearCollapsedItems(i,t.drilledMembers[t.drilledMembers.length-1],this.olapCtrlObj.model.dataSource);t.drilledMembers=t.drilledMembers.splice(0,t.drilledMembers.length-1)}catch(h){this.olapCtrlObj._ogridWaitingPopup.hide()}t.drilledMembers.length?this._onDemandCollapse({drilledMembers:t.drilledMembers},i):t.action||this._generateJSONData("onDemandDrill",this.olapCtrlObj.XMLACellSet)},_removeCellSets:function(t,i,r,u,f,e){for(var c,s,v,o,l=t.length,h,y,p=f[0],a=0;a<i.length;a++)if(n(i[a]).find("UName").text()==n(p).find("UName").text()){y=i[a];break}if(c=l,s=n(y).index(),s)if(e=="rowheader"){for(h=r.length;c>0;)n(n(this.olapCtrlObj.XMLACellSet).find("Axis[name|='Axis1'] Tuple")[s]).remove(),c--;for(o=ext=s;o<ext+l;o++)v=n(n(this.olapCtrlObj.XMLACellSet).find("CellData Cell")).splice(s*h,h),n(v).remove()}else{for(h=i.length;c>0;)n(n(this.olapCtrlObj.XMLACellSet).find("Axis[name|='Axis0'] Tuple")[s]).remove(),c--;for(o=0;o<h;o++)v=n(n(this.olapCtrlObj.XMLACellSet).find("CellData Cell")).splice(h*o-o*l+s,l),n(v).remove()}},_getDrilledMemeber:function(t){var u=[],e=t.item.itemPosition,f,r,i,o=this.olapCtrlObj._drilledCellSet.length;return keyVal=t.item.previousElements.split(">#>").join().replace(/,/g,""),n.grep(this.olapCtrlObj._drilledCellSet,function(n,t){for(var u=0;u<n.length;u++)if(n[u].key.startsWith(keyVal))return r=u,i=t,f=n.length,!0}),this.olapCtrlObj._drilledCellSet[i]&&(n.merge(u,this.olapCtrlObj._drilledCellSet[i].splice(r,f-r)),this.olapCtrlObj._drilledCellSet[i].length||this.olapCtrlObj._drilledCellSet.splice(i,1)),u},_getHeaderCollection:function(t,r){var f,dt,p=[],st,ht="",w=[],d=null,it={},g={},l=this,vt,u,e,a,at,ii,y,wt,nt,ut,bt,ft,h,ri,et,gt,ui,ni,tt,ot,kt,ti;if(f=n.Enumerable.From(t).Where(function(t,i){var f=n(t).find("Member"),e=n(f[0]).find("LName").text().indexOf("[(All)]")!=-1,h=e?1:0,o=0,u,s;for(d=null,e?(st=0,ht="total"):(ht="",st=f.length),u=1,n(f[0]).find("LName").text().toLowerCase().indexOf("[measures]")!=-1&&(u=0),u;u<f.length;u++)n(f[u]).find("LName").text().toLowerCase().indexOf("[measures]")!=-1?(o=e,g.axis=r,g.posision=u,parseInt(n(f[u]).find("MEMBER_TYPE").text())==4&&(s=n(f[u]).find("UName").text().toLowerCase(),s.indexOf("trend]")!=-1?(l._kpi||l._loadKpi(l.olapCtrlObj.model.dataSource,this._loadKpiSuccess,""),(it=l._isKpi(n(f[u]).find("UName").text(),"trend"))&&(d="trend",g.isKpiExist=!0)):s.indexOf("status]")!=-1?(l._kpi||l._loadKpi(l.olapCtrlObj.model.dataSource,this._loadKpiSuccess,""),(it=l._isKpi(n(f[u]).find("UName").text(),"status"))&&(d="status",g.isKpiExist=!0)):s.indexOf("goal]")!=-1&&(l._kpi||l._loadKpi(l.olapCtrlObj.model.dataSource,this._loadKpiSuccess,""),(it=l._isKpi(n(f[u]).find("UName").text()+"::"+n(f[u]).find("Caption").text(),"goal"))&&(d="goal",g.isKpiExist=!0)))):o=n(f[u]).find("LName").text().indexOf("[(All)]")!=-1,(e==!1&&o==!0||e==!0&&o==!1)&&(h++,st=u,ht="total"),e=o;return dt=i,h<2}).Select(function(t){for(var o,s,f=n(t).find("Member"),e=[],u=0;u<f.length;u++)o=parseInt(n(f[u]).find("LNum").text()),s=n(f[u]).find("PARENT_UNIQUE_NAME").length?n(f[u]).find("PARENT_UNIQUE_NAME").text():"",e.push({CSS:r,Value:n(f[u]).find("Caption").text(),ColSpan:1,RowSpan:1,HUName:n(f[u]).attr("Hierarchy"),LName:n(f[u]).find("LName").text(),UName:n(f[u]).find("UName").text(),ChildCount:parseInt(n(f[u]).find("CHILDREN_CARDINALITY").text()),PUName:s,LNum:o,MemberType:parseInt(n(f[u]).find("MEMBER_TYPE").text())}),n(f[u]).find("LName").text().toLowerCase().indexOf("[measures]")!=-1&&d&&(e[e.length-1].kpiInfo=it,e[e.length-1].kpi=d),w[u]==i?w[u]=o:w[u]<o&&(w[u]=o);return p.push({selIndx:dt,totLvl:st,type:ht,kpi:d,kpiInfo:it}),e}).ToArray(),r=="colheader"?this._cTotIndexInfo=p:this._rTotIndexInfo=p,f={headers:f,indxInfo:p,maxLvlLen:w},n.isEmptyObject(g)||(this._measureDt=n.extend({},g)),vt=1,r.indexOf(this._OlapDataSource.values[0].axis.substring(0,3))>-1&&(vt=this._measureDt.measureCount=this._OlapDataSource.values[0].measures.length),!this._OlapDataSource._enableBasicEngine){var s={headers:[],indxInfo:[]},fi=p,c=p.length,ct=s.length,lt=[],o=[],yt=0,b=[],rt=!1;try{for(u=0;u<c;u++){for(yt=e==0?o.length:o.length;u<c&&f.indxInfo[u-yt].type=="total";)s.indxInfo.push(f.indxInfo.splice(u-yt,1)[0]),s.headers.push(f.headers.splice(u,1)[0]),c--,ct++;if(u==0&&(s.indxInfo.reverse(),s.headers.reverse()),u+1<c||u+1==c){var k=f.headers[u].length,v=0,pt=0;for(e==k-1&&w[w.length-1]==0&&(k-=1),this._measureDt.posision==k-1&&this._measureDt.axis==r&&(pt=1),e=0;e<k-1-pt;e++){if(a=1,f.headers[u][e+1]!=i&&e+1<k-1&&f.headers[u][e+1].LName.toLowerCase().indexOf("[measures]")!=-1&&(a=2),b[e]==i?b[e]=0:f.headers[u+1]!=i&&u!=0&&f.headers[u][e].LNum==f.headers[u+1][e].LNum&&f.headers[u][e].UName!=f.headers[u-1][e].UName&&f.headers[u][e].UName==f.headers[u+1][e].UName&&(b[e]!=i&&(b[e]=u),rt=!0),f.headers[u+1]!=i&&f.headers[u+1][e].LNum>1&&f.headers[u][e].LNum<f.headers[u+1][e].LNum){for(at=0,ii=0,tlen=s.headers.length,ut=f.headers[u+1][e].PUName,y=0;y<tlen;y++)s.headers[y]!=i&&s.headers[y][e].UName==ut&&s.headers[y][e+a]!=i&&s.headers[y][e+a].LNum!=0&&(s.headers.splice(y,1),s.indxInfo.splice(y-o.length,1),ct--,y--,tlen--);for(wt=b[e];wt<=u;wt++)nt=b[e],(f.headers[nt][e+a]!=i&&(e+a==k-1||f.headers[nt][e+a].LName.toLowerCase().indexOf("[measures]")!=-1)||f.headers[nt][e+a].LName.indexOf("[(All)]")==-1&&f.headers[nt][e+a].LNum!=0)&&(f.indxInfo.splice(nt-o.length,1),f.headers.splice(nt,1),c--,at++);if(u+1>=at)for(u-=at-1;u<c&&f.indxInfo[u-o.length].type=="total";)s.indxInfo.push(f.indxInfo.splice(u-o.length,1)[0]),s.headers.push(f.headers.splice(u,1)[0]),c--,ct++}if(u>0&&f.headers[u-1]!=i&&f.headers[u][e].LNum<f.headers[u-1][e].LNum){for(ut=f.headers[u-1][e].PUName,bt=f.headers[u][e].LNum;bt<=f.headers[u-1][e].LNum;bt++)n.grep(s.headers,function(n,t){n!=i&&n[e].UName==ut&&(ut=n[e].PUName,f.headers.splice(u,0,s.headers.splice(t,1)[0]),f.indxInfo.splice(u-o.length,0,s.indxInfo.splice(t,1)[0]),c++,ct--,u++,rt&&b[e]++)});rt=!1}if(ft=this._comparePrevMembers(f.headers,c,u,e,k,v),u+1+v==c||f.headers[u+1+v]!=i&&f.headers[u][e].UName!=f.headers[u+1+v][e].UName||ft){for(h=[],ri=n.grep(s.headers,function(n,t){if(f.headers[u][e].UName==n[e].UName&&s.indxInfo[t].totLvl==e+a||f.headers[u+1+v]!=i&&f.headers[u][e].UName!=f.headers[u+1+v][e].UName&&f.headers[u][e].PUName==n[e].UName&&s.indxInfo[t].totLvl==e+a&&ft)return h.push(t),n}),ft&&(h.reverse(),ft=!1);h.length>0;){for(et=h.length-1,gt=h[h.length-1];et>=0;)gt<h[et]&&h[et]--,et--;f.headers.splice(u+1,0,s.headers.splice(h[h.length-1],1)[0]);f.indxInfo.splice(u+1-o.length,0,s.indxInfo.splice(h[h.length-1],1)[0]);v++;h.pop();c++;rt&&b[e]++}rt=!1;lt[e]=0}lt[e]==i?lt[e]=0:lt[e]++}if(ui=this._findNextMember(f.headers,u,e),ni=this._findPreviousMember(f.headers,u-1,e),u>=vt&&e==k-1-pt&&w[e]>1){if(u>0&&f.headers[u]!=i&&f.headers[u-1][e].LNum!=0&&f.headers[u-1][e].LNum<f.headers[u][e].LNum)for(tt=ni;tt<0;tt++)f.indxInfo[u+tt-o.length].lnum=f.headers[u+tt][e].LNum,f.indxInfo[u+tt-o.length].type="total",o.push(f.indxInfo.splice(u+tt-o.length,1)[0]);if(u!=0&&f.headers[u]!=i&&f.headers[u][e].LNum!=0&&f.headers[u-1][e].LNum>f.headers[u][e].LNum)if(ot=0,f.headers[u][e].LNum!=1&&o.length)for(kt=f.headers[u][e].LNum;kt<f.headers[u-1][e].LNum;kt++)for(ti=o[o.length-1].lnum;ti==o[o.length-1].lnum;)f.indxInfo.splice(u+ot-o.length,0,o.splice(o.length-1,1)[0]),r==this._measureDt.axis&&this._measureDt.measureCount>1&&ot--;else while(o.length>0)f.indxInfo.splice(u+ot-o.length,0,o.splice(o.length-1,1)[0]),r==this._measureDt.axis&&this._measureDt.measureCount>1&&ot--;else if(f.indxInfo[u+1-o.length]&&o.length&&f.indxInfo[u+1-o.length].type=="total")while(o.length>0)f.indxInfo.splice(u+1-o.length,0,o.splice(o.length-1,1)[0])}v>0&&(u+=v,v=0)}if(u+1==c){if(o.length&&f.headers[u][e].LNum!=1)while(o.length>0)f.indxInfo.splice(u+1-o.length,0,o.splice(o.length-1,1)[0]);n.grep(s.indxInfo,function(){f.headers.splice(u+1,0,s.headers.splice(0,1)[0]);f.indxInfo.splice(u+1-o.length,0,s.indxInfo.splice(0,1)[0])})}}}catch(ei){this.olapCtrlObj._ogridWaitingPopup.hide()}}return r=="rowheader"?this._rBIndx=p:this._cBIndx=p,f.maxLvlLen[e]>1&&(f.headers=this._drillOrderHeaderCollection(f.indxInfo,t,r)),f},_insertSummaryHeaders:function(n,t,i,r,u){while(i.length>0)n.headers.splice(r+1,0,t.headers.splice(i[i.length-1],1)[0]),n.indxInfo.splice(r+1-u,0,t.indxInfo.splice(i[i.length-1],1)[0]),i.pop()},_comparePrevMembers:function(n,t,i,r,u,f){if(r>0&&i+1+f<t)for(var e=r-1;e<=0;e--)return n[i][e].UName!=n[i+1+f][e].UName?!0:!1},_drillOrderHeaderCollection:function(t,i,r){var f=t,e=i,o=r,u=0;return n(f).map(function(t,i){var f=n(e[i.selIndx]).find("Member"),s=[],r,c,l,h;for(s[u]=[],r=0;r<f.length;r++)c=parseInt(n(f[r]).find("LNum").text()),l=n(f[r]).find("PARENT_UNIQUE_NAME").length?n(f[r]).find("PARENT_UNIQUE_NAME").text():"",s[u].push({CSS:o,Value:n(f[r]).find("Caption").text(),ColSpan:1,RowSpan:1,HUName:n(f[r]).attr("Hierarchy"),LName:n(f[r]).find("LName").text(),UName:n(f[r]).find("UName").text(),ChildCount:parseInt(n(f[r]).find("CHILDREN_CARDINALITY").text()),PUName:l,LNum:c,MemberType:parseInt(n(f[r]).find("MEMBER_TYPE").text())}),h=s[u][s[u].length-1],i.kpiInfo&&h.UName.toLowerCase().indexOf("[measures]")>-1&&h.MemberType==4&&(s[u][s[u].length-1].kpiInfo=i.kpiInfo),i.kpi&&h.UName.toLowerCase().indexOf("[measures]")>-1&&h.MemberType==4&&(s[u][s[u].length-1].kpi=i.kpi);return s})},_loadKpi:function(n,t,i){var r='<Envelope xmlns="http://schemas.xmlsoap.org/soap/envelope/"><Header/><Body><Discover xmlns="urn:schemas-microsoft-com:xml-analysis"><RequestType>MDSCHEMA_KPIS<\/RequestType><Restrictions><RestrictionList><CATALOG_NAME>'+n.catalog+"<\/CATALOG_NAME><CUBE_NAME>"+n.cube+"<\/CUBE_NAME><\/RestrictionList><\/Restrictions><Properties><PropertyList><Catalog>"+n.catalog+"<\/Catalog><\/PropertyList><\/Properties><\/Discover><\/Body><\/Envelope>";this.olapCtrlObj.doAjaxPost("POST",n.data,{XMLA:r},this._loadKpiSuccess,null,i)},_loadKpiSuccess:function(n,t){this._kpi=t},_isKpi:function(t,i){var u=n(this._kpi).find("row:contains("+t.split("::")[0]+")"),r={};return u.length?(i=="trend"?(r.Graphic=n(u).find("KPI_TREND_GRAPHIC").text(),r.Value=n(u).find("KPI_NAME").text()):i=="status"?(r.Graphic=n(u).find("KPI_STATUS_GRAPHIC").text(),r.Value=n(u).find("KPI_NAME").text()):i=="goal"&&(r.Caption=t.split("::")[1],r.Value=n(u).find("KPI_NAME").text()),r):!1},_getValueCells:function(t,i){var s=this._columnHeaders.headers.length,h=this._rowHeaders.headers.length?this._rowHeaders.headers.length:1,e=0,u=0,f,l,r,o,c;if(this._valueCells[e]=[],this._OlapDataSource._enableBasicEngine)for(r=0;r<t.length;r++)u<s&&(this._valueCells[e][u]={Value:n(t[r]).find("FmtValue")[0]?n(t[r]).find("FmtValue").text():"",FormatString:n(t[r]).find("FormatString")[0]?n(t[r]).find("FormatString").text():""},u++),u==s&&e+1<h&&(u=0,e++,this._valueCells[e]=[]);else for(f=0;f<h;f++)for(l=this._rBIndx.length?this._rBIndx[f].selIndx:0,r=0;r<s;r++)o=n(t[l*i+this._cBIndx[r].selIndx]),c="",(this._columnHeaders.indxInfo[r]&&this._columnHeaders.indxInfo[r].type=="total"||this._rowHeaders.indxInfo[f]&&this._rowHeaders.indxInfo[f].type=="total")&&(c="summary"),u<s&&(this._valueCells[f][r]={ActualValue:n(o).find("Value").text(),Value:n(o).find("FmtValue")[0]?this._getFormatedValue(n(o),n(o).find("FormatString")[0]):"",FormatString:n(o).find("FormatString")[0]?n(o).find("FormatString").text():"",kpi:this._cBIndx[r].kpi?this._cBIndx[r].kpi:this._rBIndx[f]?this._rBIndx[f].kpi:"status",summary:c},u++),u==s&&e+1<h&&(u=0,e++,this._valueCells[e]=[]);return this._valueCells},_getFormatedValue:function(i,r){var r,u;if(this.olapCtrlObj.model.locale!="en-US"&&n.isNumeric(parseFloat(n(i).find("Value").text()))){r=n(r).length>0?n(r).text().toLowerCase():"";u=parseFloat(i.find("Value").text());switch(r){case"decimal":u=parseFloat(t.widgetBase.formatting("{0:D2}",u,this.olapCtrlObj.model.locale));break;case"percent":u=t.widgetBase.formatting("{0:P0}",u,this.olapCtrlObj.model.locale);break;case"number":u=t.widgetBase.formatting("{0:N}",u,this.olapCtrlObj.model.locale);break;case"currency":u=t.widgetBase.formatting("{0:C2}",u,this.olapCtrlObj.model.locale);break;case"date":u=new Date((Number(u)-2)*864e5+new Date("01/01/1900").getTime());this._isDateTime(u)&&(u=t.widgetBase.formatting("{0:MM/dd/yyyy}",u,this.olapCtrlObj.model.locale));break;case"scientific":u=u.toExponential(2).replace("e","E");break;case"accounting":u=this._toAccounting(u,"{0:C2}");break;case"time":u=new Date((Number(u)-2)*864e5+new Date("01/01/1900").getTime());this._isDateTime(u)&&(u=t.widgetBase.formatting("{0:h:mm:ss tt}",u,this.olapCtrlObj.model.locale));break;case"fraction":u=this._toFraction(u);u="numerator"in u?u.integer+" "+u.numerator+"/"+u.denominator:u.integer;break;default:u=n(i).find("FmtValue").text()}}else u=n(i).find("FmtValue").text();return u},_isDateTime:function(n){return Object.prototype.toString.call(n)==="[object Date]"&&!isNaN(n.valueOf())},_toAccounting:function(n,i,r){var h=t.preferredCulture(r).numberFormat,f,e,u=h.currency.symbol,o,s;return val=t.widgetBase.formatting(i,n,this.olapCtrlObj.model.locale),o=val.replace(u,""),s=val.indexOf(u),!s||n<0&&s===1?(f=u,e=Number(n)?o:"-"):(f=Number(n)?o:"-",e=u),f+"   "+e},_toFraction:function(n){if(this._isNumber(n)){var r=n.toString(),e=r.split(".")[0],t=r.split(".")[1];if(!t)return{integer:n};var i=(+t).toString(),u=this._getPlaceValue(t,i),f=this._getGCD(i,u);return{integer:e,numerator:Number(i)/f,denominator:Number(u)/f}}return null},_isNumber:function(n){return n-parseFloat(n)>=0},_getGCD:function(n,t){return(n=Number(n),t=Number(t),!t)?n:this._getGCD(t,n%t)},_getPlaceValue:function(n,t){var i=n.indexOf(t)+t.length;return"1"+Array(i+1).join("0")},_populateEngine:function(t,r,u){var l=t.length,a=r.length,v=l?t[0].length:l,s=a?r[0].length:a,y=u.length,p=u[0].length,f,e,c,tt;try{this.pivotEngine=[];var w=[],b=[],it=!1,k=n.Enumerable.From(r.maxLvlLen).Sum(),h=!1,o=[];for(f=0;f<a;f++)for(this.pivotEngine[f+s]==i&&(this.pivotEngine[f+s]=[]),f==0&&(this.pivotEngine[0]=[],this.pivotEngine[0][0]={CSS:"none",Value:"",ColSpan:indexCCell?indexCCell:1,RowSpan:indexRCell?indexRCell:1,HUName:"",LName:"",UName:"",LNum:""}),e=0;e<s;e++)h=!1,this._OlapDataSource.columns&&this._OlapDataSource.columns[e]&&this._OlapDataSource.columns[e].isNamedSets&&(h=!0),this._pivotEngineSpanCalculation("colheader",r,t,this._columnHeaders.maxLvlLen,u,e,f,b,w,k,this._cTotIndexInfo,h);for(o=this.pivotEngine.slice(),this.pivotEngine=[],f=0;f<o.length;f++)if(o[f])for(e=0;e<o[f].length;e++)o[f][e]&&(this.pivotEngine[e]==i&&(this.pivotEngine[e]=[]),this.pivotEngine[e][f]={CSS:o[f][e].CSS,ColSpan:o[f][e].RowSpan,HUName:o[f][e].HUName,LName:o[f][e].LName,LNum:o[f][e].LNum,RowSpan:o[f][e].ColSpan,UName:o[f][e].UName,PUName:o[f][e].PUName,Value:o[f][e].Value,ChildCount:o[f][e].ChildCount,MemberType:o[f][e].MemberType},o[f][e].kpiInfo&&(this.pivotEngine[e][f].kpiInfo=o[f][e].kpiInfo,this.pivotEngine[e][f].kpi=o[f][e].kpi));var d=[],g=[],it=!1,nt=n.Enumerable.From(this._rowHeaders.maxLvlLen).Sum();for(f=0;f<l;f++)for(this.pivotEngine[f+indexCCell]==i&&(this.pivotEngine[f+indexCCell]=[]),e=0;e<v;e++)h=!1,this._OlapDataSource.rows&&this._OlapDataSource.rows[e]&&this._OlapDataSource.rows[e].isNamedSets&&(h=!0),this._pivotEngineSpanCalculation("rowheader",t,r,this._rowHeaders.maxLvlLen,u,e,f,g,d,nt,this._rTotIndexInfo,h);for(v=this._measureDt.axis=="rowheader"?indexRCell+1:indexRCell,s=indexCCell?indexCCell:s,f=0;f<y;f++)for(this.pivotEngine[f+s]!=i&&(v=this.pivotEngine[f+s].length),e=0;e<p;e++)this.pivotEngine[f+s]==i&&(this.pivotEngine[f+s]=[]),c=this._setClassName(u[f][e]),u[f][e].CSS=c,c.indexOf("kpiiconvalue")>-1&&!1?u[f][e].Value="":c.indexOf("kpiiconvalue")>-1&&(u[f][e].Value=parseInt(u[f][e].Value)),this.pivotEngine[f+indexCCell][e+indexRCell]=u[f][e];tt=n.grep(this.pivotEngine,function(n){return n})}catch(rt){this.olapCtrlObj._ogridWaitingPopup.hide()}},_pivotEngineSpanCalculation:function(n,t,r,u,f,e,o,s,h,c,l,a){var ft=t.length,et="",pt=r.length,k=ft?t[0].length:ft,y=pt?r[0].length:pt,gt=f.length,ni=f[0].length,bt,d,nt,v,wt,lt,tt,g,ut,dt,st,vt,yt,ht;n=="rowheader"?(y=indexCCell?indexCCell:y,et="row"):(y=indexRCell?indexRCell:y,et="col");bt=1;d=0;a&&(t[o][e].ChildCount=0);this._measureDt.axis==n&&this._measureDt.posision==k-1&&(d=1);s[e]||(s[e]=[]);this.pivotEngine[o+y]||(this.pivotEngine[o+y]=[]);h[e]=o;var kt=u[e]?u[e]:1,p=0,ct=0;for(nt=0;nt<e;nt++)u[nt]&&(p+=u[nt]-1,ct+=u[nt]);if(!this._OlapDataSource._enableBasicEngine||this._OlapDataSource._checkSummaryHeaders)for(v=1;v<=kt;v++){var w=null,rt=!1,b=t[o][e].LNum;if(s[e][v]==i&&(s[e][v]=0),t[o-1]&&s[e][b]&&(t[o][e].LNum!=0&&t[o-1][e].PUName==t[o][e].UName||e+d==k-1&&t[o-1][e].LNum<t[o][e].LNum)&&(tempSpan=s[e][b],this.pivotEngine[o+y-tempSpan][e+b-1+p]=t[o][e],a||(this.pivotEngine[o+y-tempSpan][e+b-1+p].ChildCount=-1),this.pivotEngine[o+y-tempSpan][e+b-1+p].ColSpan=1,this.pivotEngine[o+y-tempSpan][e+b-1+p].RowSpan+=tempSpan,this._drilledJSONData(o+y-tempSpan,o+y,e+b-1+p,t[o][e]),s[e][b]=0,e+d==k-1&&t[o-1][e].LNum>t[o][e].LNum)){for(wt=u[e]-b,lt=this._findNextMember(t,o,e),tt=0;tt<lt;tt++)this.pivotEngine[o+y+tt]||(this.pivotEngine[o+y+tt]=[]),this.pivotEngine[o+y+tt][e+p+b]={CSS:"summary "+et,Value:"Total",ColSpan:wt,RowSpan:1,HUName:"",LName:"",UName:"",LNum:"",MemberType:"",ChildCount:""};this.pivotEngine[o+y-tempSpan][e+b-1+p].RowSpan+=lt-1}if(t[o][e].LNum>v&&s[e][v]++,w=o+y,v==t[o][e].LNum&&o==0&&t[o][e].LNum>1)this.pivotEngine[w]||(this.pivotEngine[w]=[]),this.pivotEngine[w][e+v-1+p]=t[o][e],(!(t[o+1]!=i&&t[o][e].LNum<t[o+1][e].LNum)||e+d==k-1&&t[o+1]&&t[o][e].LNum<t[o+1][e].LNum)&&(this.pivotEngine[w][e+v-1+p].ColSpan+=u[e]-this.pivotEngine[w][e+v-1+p].LNum);else if(o!=0&&t[o][e].LNum>1&&v==t[o][e].LNum&&t[o-1][e].UName!=t[o][e].UName&&t[o-1][e].PUName!=t[o][e].UName)this.pivotEngine[w]==i&&(this.pivotEngine[w]=[]),this.pivotEngine[w][e+v-1+p]=t[o][e],(!(t[o+1]!=i&&t[o][e].LNum<t[o+1][e].LNum)||e+d==k-1&&t[o+1]&&t[o][e].LNum<t[o+1][e].LNum)&&(this.pivotEngine[w][e+v-1+p].ColSpan+=u[e]-this.pivotEngine[w][e+v-1+p].LNum);else if(o!=0&&v==t[o][e].LNum&&t[o-1][e].UName==t[o][e].UName)s[e][v]++,this.pivotEngine[o+y][e+v-1+p]=t[o][e],(t[o+1]!=i&&t[o+1][e].UName!=t[o][e].UName||o+1==ft&&s[e][v]>0)&&(g=s[e][v],ut=t[o][e].LNum,g&&this.pivotEngine[o+y-g][e+ut-1+p]!=i&&this.pivotEngine[o+y-g][e+ut-1+p].Value!=i&&(this.pivotEngine[o+y-g][e+ut-1+p].RowSpan+=g,this._drilledJSONData(o+y-g,o+y,e+ut-1+p,t[o][e])),s[e][v]=0);else if(t[o][e].LNum<2&&(v==t[o][e].LNum||t[o][e].LNum==0)||t[o][e].LNum<v&&t[o-1]&&t[o][e].LNum<t[o-1][e].LNum&&l[o].type=="total"&&this._measureDt.axis==n)if(dt=v-1,t[o-1]&&t[o-1][e].UName==t[o][e].UName&&t[o][e].LName.toLowerCase().indexOf("[measures]")>-1&&(this.pivotEngine[o+y][e+v-1+p]=t[o][e],this._measureDt.measureCount>1&&n==this._measureDt.axis||s[e][v]++),l[o].type!="total")t[o-1]&&t[o-1][e].UName==t[o][e].UName||(this.pivotEngine[o+y][e+v-1+p]=t[o][e],rSCnt=s[e][v],rSCnt&&this.pivotEngine[o+y-rSCnt][e+v-1+p]!=i&&(this.pivotEngine[o+y-rSCnt][e+v-1+p].RowSpan+=s[e][v],this._drilledJSONData(o+y-rSCnt,o+y,e+v-1+p,t[o][e])),s[e][v]=0),!t[o][e].LNum==0&&(!(t[o+1]!=i&&t[o][e].LNum<t[o+1][e].LNum)||e+d==k-1&&t[o+1]&&t[o][e].LNum<t[o+1][e].LNum)&&this.pivotEngine[o+y][e+v-1+p]&&(this.pivotEngine[o+y][e+v-1+p].ColSpan+=u[e]-this.pivotEngine[o+y][e+v-1+p].LNum);else if(l[o].type=="total"&&t[o][e].LName.toLowerCase().indexOf("[measures]")==-1&&t[o][e].LNum!=v&&u[e]!=0){if((t[o][e-1]&&t[o][e-1].LName.toLowerCase().indexOf("[measures]")==-1||this._measureDt.axis!=n)&&(e>l[o].totLvl||e==k-1&&v>l[o].totLvl&&l[o].totLvl!=0||l[o].totLvl==0&&v-1>l[o].totLvl))break;for(var ot=1,at=1,it=0;t[o-at][e]&&t[o-at][e].LNum==0;)at++,it++;if(this._measureDt.axis==n){for(st=0,rt=!1,it=0,e<this._measureDt.posision?(vt=e,yt=this._measureDt.posision):e>this._measureDt.posision&&(yt=u.length,vt=e,rt=!0),ht=vt;ht<yt;ht++)st+=u[ht];t[o][e+1]&&t[o][e+1].LName.toLowerCase().indexOf("[measures]")>-1&&u[e]>1&&(rt=!0,st-=t[o][e].LNum);ot=st}else t[o][e].LNum==0&&(o!=0&&t[o][e-1]&&u[e-1]>1&&t[o][e-1].LNum<t[o-1][e-1].LNum&&(it=u[e-1]-t[o][e-1].LNum),n=="rowheader"?ot=indexRCell-ct+it:n=="colheader"&&(ot=indexCCell-ct+it),(u.length!=1&&e==k-1||u.length>1&&e<k-1)&&(rt=!0));this.pivotEngine[o+y][e+v-1+p-it]={CSS:"summary "+et,Value:"Total",ColSpan:ot,RowSpan:1,HUName:"",LName:"",UName:"",LNum:"",MemberType:"",ChildCount:""}}else t[o][e].LName.toLowerCase().indexOf("[measures]")!=-1&&(t[o-1]&&t[o-1][e].UName==t[o][e].UName||(this.pivotEngine[o+y][e+v-1+p]=t[o][e]),(t[o-1]&&t[o-1][e].UName!=t[o][e].UName||o+1==ft)&&(rSCnt=s[e][v],rSCnt&&this.pivotEngine[o+y-rSCnt][e+v-1+p]!=i&&(this.pivotEngine[o+y-rSCnt][e+v-1+p].RowSpan+=s[e][v],this._drilledJSONData(o+y-rSCnt,o+y,e+v-1+p,t[o][e])),s[e][v]=0));if(rt)break}else this.pivotEngine[o+y][e]=t[o][e]},_findNextMember:function(n,t,i){for(var r=0;n[t+r]&&n[t][i].UName==n[t+r][i].UName;)r++;return r},_findPreviousMember:function(n,t,i){for(var r=-1;n[t+r]&&n[t][i].UName==n[t+r][i].UName;)r--;return r},_drilledJSONData:function(n,t,i,r){for(var u=n+1;u<t;u++)this.pivotEngine[u][i]=r},_setClassName:function(n){var i=parseInt(n.Value),t="value";if(n.kpi)if(n.kpi=="trend")switch(i){case-1:t="value kpiiconvalue kpidownarrow";break;case 0:t="value kpiiconvalue kpirightarrow";break;case 1:t="value kpiiconvalue kpiuparrow"}else if(n.kpi=="status")switch(i){case-1:t="value kpiiconvalue kpidiamond";break;case 0:t="value kpiiconvalue kpitriangle";break;case 1:t="value kpiiconvalue kpicircle"}return n.summary+" "+t},_getFieldItemsInfo:function(n){var t=this._getConnectionInfo(n.model.dataSource.data),i='<Envelope xmlns="http://schemas.xmlsoap.org/soap/envelope/"><Header/><Body><Discover xmlns="urn:schemas-microsoft-com:xml-analysis"><RequestType>MDSCHEMA_HIERARCHIES<\/RequestType><Restrictions><RestrictionList><CATALOG_NAME>'+n.model.dataSource.catalog+"<\/CATALOG_NAME><CUBE_NAME>"+n.model.dataSource.cube+"<\/CUBE_NAME><\/RestrictionList><\/Restrictions><Properties><PropertyList><Catalog>"+n.model.dataSource.catalog+"<\/Catalog> <LocaleIdentifier>"+t.LCID+"<\/LocaleIdentifier><\/PropertyList><\/Properties><\/Discover><\/Body><\/Envelope>";n.doAjaxPost("POST",t.url,{XMLA:i},this._getHierarchyInfo,null,{pvtGridObj:n,action:"loadFieldElements"})},_getHierarchyInfo:function(t,i){for(var r,o,e=[],s=t.pvtGridObj,u=this._getConnectionInfo(s.model.dataSource.data),f=0;f<n(i).find("row").length;f++)r=n(n(i).find("row")[f]),e.push({pid:r.find("DIMENSION_UNIQUE_NAME").text(),id:r.find("HIERARCHY_UNIQUE_NAME").text(),name:r.find("HIERARCHY_CAPTION").text(),tag:r.find("HIERARCHY_UNIQUE_NAME").text()});olapCtrlObj._fieldData={hierarchy:e,hierarchySuccess:i,measures:[]};u.LCID.indexOf("1033")>=0&&!olapCtrlObj.model.enableDrillThrough||(o='<Envelope xmlns="http://schemas.xmlsoap.org/soap/envelope/"><Header/><Body><Discover xmlns="urn:schemas-microsoft-com:xml-analysis"><RequestType>MDSCHEMA_MEASURES<\/RequestType><Restrictions><RestrictionList><CATALOG_NAME>'+olapCtrlObj.model.dataSource.catalog+"<\/CATALOG_NAME><CUBE_NAME>"+olapCtrlObj.model.dataSource.cube+"<\/CUBE_NAME><\/RestrictionList><\/Restrictions><Properties><PropertyList><Catalog>"+olapCtrlObj.model.dataSource.catalog+"<\/Catalog> <LocaleIdentifier>"+u.LCID+"<\/LocaleIdentifier> <\/PropertyList><\/Properties><\/Discover><\/Body><\/Envelope>",olapCtrlObj.doAjaxPost("POST",u.url,{XMLA:o},this._getMeasureInfo,null,{pvtGridObj:olapCtrlObj,action:"loadFieldElements"}))},_getMeasureInfo:function(t,i){for(var f=[],r=0;r<n(i).find("row").length;r++){var u=n(n(i).find("row")[r]),o=u.children("MEASUREGROUP_NAME").text(),e=u.find("MEASURE_UNIQUE_NAME").text();f.push({id:e,pid:o,name:u.children("MEASURE_CAPTION").text(),tag:e})}t.pvtGridObj._fieldData.measures=f;t.pvtGridObj._fieldData.measureSuccess=i},_getConnectionInfo:function(t){var i={url:"",LCID:"1033"};return t!=""&&n.map(t.split(";"),function(n){n.toLowerCase().indexOf("locale")<0&&i.url.length==0?i.url=n:n.toLowerCase().indexOf("locale")>=0&&(i.LCID=n.replace(/ /g,"").split("=")[1])}),i},_applyTrim:function(t){var u=[],r=t.model.dataSource,f=this;t._fieldData&&t._fieldData.measures&&t._fieldData.hierarchy?(n.merge(u,t._fieldData.hierarchy),n.merge(u,t._fieldData.measures)):t._fieldData&&t._fieldData.hierarchy?t._fieldData.hierarchy:[];r.rows=n.map(r.rows,function(t){if(t.fieldName!=i)return t.fieldName=n.trim(t.fieldName),t.fieldCaption=f._getCaption(t.fieldName,u),t});r.columns=n.map(r.columns,function(t){if(t.fieldName!=i)return t.fieldName=n.trim(t.fieldName),t.fieldCaption=f._getCaption(t.fieldName,u),t});r.filters=n.map(r.filters,function(t){if(t.fieldName!=i)return t.fieldName=n.trim(t.fieldName),t.fieldCaption=f._getCaption(t.fieldName,u),t});r.values=r.values.length>0&&r.values[0].measures!=i?r.values:[{measures:[],axis:"columns"}];r.values[0].measures=n.map(r.values[0].measures,function(t){if(t.fieldName!=i)return t.fieldName=n.trim(t.fieldName),t.fieldCaption=f._getCaption(t.fieldName,u),t});t.model.dataSource=r},_getCaption:function(t,r){if(r.length>0){var u=n.map(r,function(r){if(r.tag!=i&&r.tag==n.trim(t))return r});return t.toLowerCase().indexOf("[measures]")>=0&&u.length==0&&t.split(".[").length>0&&(u=[{name:t.split(".[")[1].replace(/]/g,"")}]),u.length>0?u[0].name:t}return t}};t.olap._mdxParser={_getRowMDX:function(r){var f=n(r)[0].rows,s,u,o,e,h;if(rowQuery="",measureQuery="",updateQuery=[],isSorted=!1,s=r.values.length>0&&r.values[0].measures!=i&&r.values[0].axis==t.olap.AxisName.Row,f.length>0){for(u=0;u<f.length;u++)o=t.isNullOrUndefined(f[u].isNamedSets)||!f[u].isNamedSets?!1:!0,e="",f[u].fieldName==i||o?o&&(rowQuery=u>0?rowQuery+"*{"+f[u].fieldName+"}":"{"+f[u].fieldName+"}"):(e=this._getDimensionQuery(f[u],r,"rows",u),updateQuery.push(e.replace(/["'\(\)]/g,"").replace(/["'\{\}]/g,"")),f[u].sortOrder&&f[u].sortOrder!=t.olap.SortOrder.None?(h=f[u].sortOrder==t.olap.SortOrder.None?"asc":"desc",isSorted=!0,rowQuery=rowQuery+(u>0?"*":"")+"{ORDER({HIERARCHIZE({"+e+"})},"+f[u].fieldName+".CurrentMember.MEMBER_CAPTION,"+h+")}"):rowQuery=rowQuery+(u>0?"*":"")+"{HIERARCHIZE({({"+e+"})})}");rowQuery=(isSorted?" ":" HIERARCHIZE ")+"( {"+this._updateOlapReport(n(r)[0].rows,rowQuery,"rows",updateQuery)+"})"}return s&&(measureQuery=t.olap._mdxParser._getMeasuresQuery(r),rowQuery=rowQuery!=""?rowQuery+(rowQuery!=""&&measureQuery!=""?",":"")+measureQuery:measureQuery),rowQuery},_getcolumnMDX:function(r){var f=n(r)[0].columns,e="",s=[],h=!1,l=r.values.length>0&&r.values[0].measures!=i&&r.values[0].axis==t.olap.AxisName.Column,u,c;if(f.length>0){for(u=0;u<f.length;u++){var a=t.isNullOrUndefined(f[u].isNamedSets)||!f[u].isNamedSets?!0:!1,h=!1,o="";f[u].fieldName!=i&&a?(o=this._getDimensionQuery(f[u],r,"columns",u),s.push(o.replace(/["'\(\)]/g,"").replace(/["'\{\}]/g,"")),f[u].sortOrder&&f[u].sortOrder!=t.olap.SortOrder.None?(c=f[u].sortOrder==t.olap.SortOrder.Ascending?"asc":"desc",h=!0,e=e+(u>0?"*":"")+"{ ORDER ({HIERARCHIZE ({"+o+"})},"+f[u].fieldName+".CurrentMember.MEMBER_CAPTION,"+c+")}"):e=e+(u>0?"*":"")+"{"+o+"}"):e=u>0?e+"*{"+f[u].fieldName+"}":"{"+f[u].fieldName+"}"}e=(h?" ":" HIERARCHIZE ")+"( {"+this._updateOlapReport(f,e,"columns",s)+"})"}return l&&(measureQuery=t.olap._mdxParser._getMeasuresQuery(r),e=e!=""?e+(e!=""&&measureQuery!=""?",":"")+measureQuery:measureQuery),e},_getSortedMembers:function(i){var r=i.fieldName,u;return i.sortOrder&&i.sortOrder!=t.olap.SortOrder.None?(u=i.sortOrder=="ascending"?"asc":"desc",n.map(i.drilledItems,function(t){return n.map(t,function(n){return n.indexOf(r)>=0&&(n="order ( "+n+" , "+r+".CurrentMember.MEMBER_CAPTION,"+u+")"),n})})):i.drilledItems},_updateOlapReport:function(r,u,f,e){var c=this,s,h,o;return f=="rows"?(s=n.map(r,function(n,t){if(r[t].drilledItems!=i)return c._getSortedMembers(n,r)}),t.olap.base._isRowDrilled&&"rows"==t.olap.base._currIndex.axis&&r[t.olap.base._currIndex.Index]!=i&&r[t.olap.base._currIndex.Index].drilledItems!=i?(o=n.map(e,function(n){return n.indexOf("DrillDownlevel")>=0&&(n=n.replace("DrillDownlevel","DrillDownlevel(")+")"),n}),r[t.olap.base._currIndex.Index].drilledItems.push(o),t.olap.base._isRowDrilled=!1):s.length>0&&(t.olap.base._currIndex.axis==i||t.olap.base._currIndex.axis=="columns"&&!t.olap.base._isRowDrilled)&&(u=this._getDrillQuery(s,u,r)),t.isNullOrUndefined(t.olap.base._currIndex.axis)||t.olap.base._currIndex.axis!="rows"||(t.olap.base._currIndex={})):(h=n.map(r,function(n,t){if(r[t].drilledItems!=i)return c._getSortedMembers(n,r)}),t.olap.base._isColDrilled&&"columns"==t.olap.base._currIndex.axis&&r[t.olap.base._currIndex.Index]!=i&&r[t.olap.base._currIndex.Index].drilledItems!=i?(o=n.map(e,function(n){return n.indexOf("DrillDownlevel")>=0&&(n=n.replace("DrillDownlevel","DrillDownlevel(")+")"),n}),r[t.olap.base._currIndex.Index].drilledItems.push(o),t.olap.base._isColDrilled=!1):h.length>0&&(t.olap.base._currIndex.axis==i||t.olap.base._currIndex.axis=="rows"&&!t.olap.base._isColDrilled)&&(u=this._getDrillQuery(h,u,r)),t.isNullOrUndefined(t.olap.base._currIndex.axis)||t.olap.base._currIndex.axis!="columns"||(t.olap.base._currIndex={})),u},_getDrillQuery:function(t,r,u){for(var s,e,h,o="",f=0;f<t.length;f++)if(t[f][t[f].length-1].indexOf(".children")>=0||t[f][t[f].length-1].indexOf("DrillDownlevel")>=0||(t[f][t[f].length-1]=t[f][t[f].length-1]+".children"),t[f].length!=u.length){for(s=n.map(u,function(n){if(n.fieldName!=i&&n.fieldName!=t[f][[t[f].length-1]].split(".").splice(0,2).join("."))return{uniqueName:"DrillDownLevel("+n.fieldName.trim()+")",fieldName:n.fieldName.trim()}}),e=0;e<s.length;e++)h=this._getItemPosition(u,s[e].fieldName)[0],t[f].toString().indexOf(s[e].fieldName)>=0||t[f].splice(h,0,s[e].uniqueName);o=o+""+(f>0?",":"")+"\n ("+t[f]+")"}else o=o+""+(f>0?",":"")+"\n ("+t[f].toString()+")\n";return"("+r+"),"+o},_getDimensionQuery:function(n){if(n.drillCellInfo!=i){var t="{("+n.drillCellInfo.uniqueName+")}";return delete n.drillCellInfo,t}return"DrillDownlevel(("+n.fieldName.trim()+"))"},_updateReport:function(i,r,u,f){u.drillCellInfo=n.extend({},r);u.drillCellInfo.uniqueName="("+u.drillCellInfo.uniqueName.trim()+".children)";var e={action:"drilldown",cellInfo:r};t.olap.base.getJSONData(e,f.model.dataSource,f)},_splitCellInfo:function(n){if(n)var t={hierarchyUniqueName:n.split("::")[1].split(".").splice(0,2).join("."),uniqueName:n.split("::")[0],levelUniqueName:n.split("::")[1],leveName:n.split("::")[2],parentUniqueName:n.split("::")[3]};return t},updateDrilledReport:function(r,u,f){var it=t.olap._mdxParser,c=null,e,p,w="",l="",k,h,v,o,y,tt;if(e=this._splitCellInfo(r.uniqueName),e.targetUName=r.uniqueName,e.previousElements="",p=n(u.target).parent().hasClass("rowheader")?f.model.dataSource.rows:n(u.target).parent().hasClass("colheader")?f.model.dataSource.columns:null,p.length>0){k=n.map(p,function(n,t){if(n.fieldName!=i&&n.fieldName.trim().toLowerCase()==e.hierarchyUniqueName.trim().toLowerCase())return{report:n,index:t}});c=k[0].report;e.itemPosition=k[0].index;e.cellIndex=r.index;c.drilledItems!=i?c.drilledItems:c.drilledItems=[];t.olap.base._currIndex={axis:n(u.target).parent().hasClass("rowheader")?"rows":"columns",Index:k[0].index};var a=e.hierarchyUniqueName,b="",w="",s="",g=n(u.target).parent(),d=g.attr("p").split(",")[0],nt=g.attr("p").split(",")[1];if(g.hasClass("rowheader"))for(b="rowheader",t.olap.base._isRowDrilled=!0,h=parseInt(d);h>=0;h--)!f.getJSONRecords()[parseInt(h*f._rowCount+parseInt(d))].Info.indexOf(a)>=0&&(s=f.getJSONRecords()[parseInt(h*f._rowCount+parseInt(nt))].Info,v=this._splitCellInfo(s),v&&(w=v.uniqueName+w),s==""||s.indexOf(a)>=0||(o=this._splitCellInfo(s),o.uniqueName=o.uniqueName.replace(/&/g,"&amp;"),l=o.uniqueName+">#>"+l,currReport=n.map(p,function(n,t){if(n.fieldName!=i&&n.fieldName.trim().toLowerCase()==o.hierarchyUniqueName.trim().toLowerCase())return t}),r.action!="collapse"&&(f.model.dataSource.rows[currReport[0]].drillCellInfo=o),a=o.hierarchyUniqueName));else for(b="colheader",t.olap.base._isColDrilled=!0,h=parseInt(nt);h>=0;h--)!f.getJSONRecords()[parseInt(d*f._rowCount+parseInt(h))].Info.indexOf(a)>=0&&(s=f.getJSONRecords()[parseInt(d*f._rowCount+parseInt(h))].Info,v=this._splitCellInfo(s),v&&(w=v.uniqueName+">#>"+w),s==""||s.indexOf(a)>=0||(o=this._splitCellInfo(s),o.uniqueName=o.uniqueName.replace(/&/g,"&amp;"),l=o.uniqueName+l,currReport=n.map(p,function(n,t){if(n.fieldName!=i&&n.fieldName.trim().toLowerCase()==o.hierarchyUniqueName.trim().toLowerCase())return t}),r.action!="collapse"&&(f.model.dataSource.columns[currReport[0]].drillCellInfo=o),a=o.hierarchyUniqueName));l+=e.uniqueName;e.previousElements=w.replace(/&amp;/g,"&");e.preRepItm=l.replace(/&amp;/g,"&");e.axis=b;r.action?r.action?(y=t.olap.base._getDrilledMemeber({item:e}),y.length&&t.olap.base._onDemandCollapse({drilledMembers:y},b)):(tt=n(r.drilledMember).clone(!0),t.olap.base._onDemandExpand({action:"drilldown",cellInfo:e,isExist:!0},r.drilledMember)):(y=t.olap.base._getDrilledMemeber({item:e}),y.length&&t.olap.base._onDemandCollapse({drilledMembers:y,action:"collapse"},b),t.olap._mdxParser._updateReport(c.drilledItems,e,c,f))}},_getSlicerMDX:function(t,r){for(var h,f=n(t)[0].filters,e="",o=this,s=r._fieldData,u=0;u<f.length;u++)h=n.grep(n(t)[0].columns,function(n){return o._getDimensionUniqueName(n.fieldName,s)==o._getDimensionUniqueName(f[u].fieldName,s)}).length>0,h||(h=n.grep(n(t)[0].rows,function(n){return o._getDimensionUniqueName(n.fieldName,s)==o._getDimensionUniqueName(f[u].fieldName,s)}).length>0),h||(f[u].fieldName!=i&&f[u].filterItems==i?e=e+(e!=""?"*":"")+"{"+this._getDimensionQuery(f[u])+"}":f[u].filterItems!=i&&(e=e+(e!=""?"*":"")+"{"+f[u].filterItems.values.toString()+"}"));return e!=""?"where ("+e.replace(/DrillDownlevel/g,"")+")":""},_getDimensionUniqueName:function(t,i){var u=i.hierarchy,r;return u?(r=n.map(u,function(n){if(n.id.toLowerCase()==t.toLowerCase())return n.pid}),r.length>0?r[0]:""):t.split(".")[0]},_getMeasuresQuery:function(t){var u=n(t)[0].values,f=[],e="",s="",r,o;return u.length>0&&(r=jQuery.map(u,function(n,t){if(n.measures!=i)return{measureElements:n.measures,Index:t,axisName:n.axis}}),o=r.length>0?n.Enumerable.From(r[0].measureElements).Select(function(n){return n.fieldName}).ToArray():null,o!=null?f.push({values:o,Index:r[0].Index}):f,s=u.axis),e=n.Enumerable.From(f).Select(function(n){return n.values.toString()}).ToArray(),e[0]!=""?"{"+e+"}":""},_getIncludefilterQuery:function(t,r,u){var l="FROM ["+r+"]",e="FROM ( SELECT (",o,s,v=u._fieldData,h=[],y="COLUMNS",c,a,f;for(o=n.Enumerable.From(t.rows).Where(function(n){return n.filterItems!=i}).Select(function(n){return n.filterItems.values}).ToArray(),s=n.Enumerable.From(t.columns).Where(function(n){return n.filterItems!=i}).Select(function(n){return n.filterItems.values}).ToArray(),f=0;f<t.filters.length;f++)c=t.filters,a=this,n.map(t.columns,function(n){a._getDimensionUniqueName(n.fieldName,v)==a._getDimensionUniqueName(c[f].fieldName,v)&&c[f].filterItems!=i&&s.push(c[f].filterItems.values)}),n.map(t.rows,function(n){a._getDimensionUniqueName(n.fieldName,v)==a._getDimensionUniqueName(c[f].fieldName,v)&&c[f].filterItems!=i&&o.push(c[f].filterItems.values)});if(t.enableAdvancedFilter){for(f=0;f<=t.columns.length-1;f++)t.columns[f].advancedFilter&&n.merge(h,this._getAdvancedFilterQuery(t.columns[f],e,y));for(f=0;f<=t.rows.length-1;f++)t.rows[f].advancedFilter&&n.merge(h,this._getAdvancedFilterQuery(t.rows[f],e,y))}for(f=0;f<=s.length-1;f++)e=f==0?e+"{"+s[f].toString()+"}":e+",{"+s[f].toString()+"}";for(s.length>0&&(e=o.length>0?e+" ) on COLUMNS ,(":e+" ) on COLUMNS "),f=0;f<=o.length-1;f++)e=f>0?e+",{"+o[f].toString()+"}":e+"{"+o[f].toString()+"}";return e=s.length>0&&o.length>0?e=e+") on ROWS ":s.length==0&&o.length>0?e+") on COLUMNS ":e,h.length>0&&(h=(s.length>0||o.length>0?e:"")+" "+h.join(" ")+" "+l+Array(h.length+1+s.length+o.length).join(")")),l=s.length==0&&o.length==0?l:e+l+")",h.length>0?h:l},_getAdvancedFilterQuery:function(i,r,u){var f=[],e=this;return n.map(i.advancedFilter,function(r){t.isNullOrUndefined(r.labelFilterOperator)&&r.labelFilterOperator==t.olap.LabelFilterOptions.None&&t.isNullOrUndefined(r.valueFilterOperator)&&r.valueFilterOperator==t.olap.ValueFilterOptions.None||f.push("FROM (SELECT Filter("+n.trim(r.name)+".AllMembers, "+e._getAdvancedFilterCondtions(i.fieldName,r.advancedFilterType==t.olap.AdvancedFilterType.LabelFilter||t.isNullOrUndefined(r.advancedFilterType)?r.labelFilterOperator:r.valueFilterOperator,r.values,r.advancedFilterType,r.measure)+")) on "+u)}),f},_getAdvancedFilterCondtions:function(n,i,r,u,f){var e="",u=t.isNullOrUndefined(u)?"label":u;switch(i.toLowerCase()){case"equals":e="("+(u!="value"?n+'.CurrentMember.member_caption ="'+r[0]+'"':f+" = "+r[0]);break;case"notequals":e="("+(u!="value"?n+'.CurrentMember.member_caption &lt;&gt;"'+r[0]+'"':f+" &lt;&gt;"+r[0]);break;case"contains":e="( InStr (1,"+n+'.CurrentMember.member_caption,"'+r[0]+'")&gt;0';break;case"notcontains":e="( InStr (1,"+n+'.CurrentMember.member_caption,"'+r[0]+'")=0';break;case"beginswith":e="( Left ("+n+".CurrentMember.member_caption,"+r[0].length+')="'+r[0]+'"';break;case"notbeginswith":e="( Left ("+n+".CurrentMember.member_caption,"+r[0].length+')&lt;&gt;"'+r[0]+'"';break;case"endswith":e="( Right ("+n+".CurrentMember.member_caption,"+r[0].length+')="'+r[0]+'"';break;case"notendswith":e="( Right ("+n+".CurrentMember.member_caption,"+r[0].length+')&lt;&gt;"'+r[0]+'"';break;case"greaterthan":e="("+(u!="value"?n+'.CurrentMember.member_caption &gt;"'+r[0]+'"':f+" &gt;"+r[0]+"");break;case"greaterthanorequalto":e="("+(u!="value"?n+'.CurrentMember.member_caption &gt;="'+r[0]+'"':f+" &gt;="+r[0]+"");break;case"lessthan":e="("+(u!="value"?n+'.CurrentMember.member_caption &lt;"'+r[0]+'"':f+" &lt;"+r[0]+"");break;case"lessthanorequalto":e="("+(u!="value"?n+'.CurrentMember.member_caption &lt;="'+r[0]+'"':f+" &lt;="+r[0]+"");break;case"between":e="("+(u!="value"?n+'.CurrentMember.member_caption &gt;="'+r[0]+'"AND '+n+'.CurrentMember.member_caption &lt;="'+r[1]+'"':f+" &gt;="+r[0]+" AND "+f+"&lt;="+r[1]);break;case"notbetween":e="("+(u!="value"?n+'.CurrentMember.member_caption &gt;="'+r[0]+'"OR '+n+'.CurrentMember.member_caption &lt;="'+r[1]+'"':f+" &gt;="+r[0]+" OR "+f+"&lt;="+r[1]);break;default:e="( InStr (1,"+n+'.CurrentMember.member_caption,"'+r[0]+'")&gt;0'}return e},_getItemPosition:function(t,r){return n.map(t,function(n,t){if(n.fieldName!=i&&n.fieldName.trim()==r.trim())return t})}};t.olap.SortOrder={None:"none",Ascending:"ascending",Descending:"descending"};t.olap.AdvancedFilterType={LabelFilter:"label",ValueFilter:"value"};t.olap.ValueFilterOptions={None:"none",Equals:"equals",NotEquals:"notequals",GreaterThan:"greaterthan",GreaterThanOrEqualTo:"greaterthanorequalto",LessThan:"lessthan",LessThanOrEqualTo:"lessthanorequalto",Between:"between",NotBetween:"notbetween"};t.olap.LabelFilterOptions={None:"none",BeginsWith:"beginswith",NotBeginsWith:"notbeginswith",EndsWith:"endswith",NotEndsWith:"notendswith",Contains:"contains",NotContains:"notcontains",Equals:"equals",NotEquals:"notequals",GreaterThan:"greaterthan",GreaterThanOrEqualTo:"greaterthanorequalto",LessThan:"lessthan",LessThanOrEqualTo:"lessthanorequalto",Between:"between",NotBetween:"notbetween"};t.olap.AxisName={Row:"rows",Column:"columns"}})(jQuery,Syncfusion)});
