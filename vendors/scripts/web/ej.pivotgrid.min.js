/*!
*  filename: ej.pivotgrid.min.js
*  version : 12.3
*  Copyright Syncfusion Inc. 2001 - 2014. All rights reserved.
*  Use of this code is subject to the terms of our license.
*  A copy of the current license can be obtained at any time by e-mailing
*  licensing@syncfusion.com. Any infringement will be prosecuted under
*  applicable laws. 
*/
(function(n){typeof define=="function"&&define.amd?define(["./../common/ej.core.min","./../common/ej.data.min","./../common/ej.touch.min","./ej.button.min","./ej.waitingpopup.min","./ej.pivotpager.min","./ej.pivotanalysis.base.min","./ej.treeview.min","./ej.olap.base.min"],n):n()})(function(){(function(n,t,r){t.olap=t.olap||{};t.widget("ejPivotGrid","ej.PivotGrid",{_rootCSS:"e-pivotgrid",element:null,model:null,_requiresID:!0,validTags:["div","span"],defaults:{url:"",cssClass:"",jsonRecords:"",currentReport:"",layout:"normal",analysisMode:"olap",operationalMode:"clientmode",filterType:"filterType",enablePivotFieldList:!0,enableGroupingBar:!1,enableDeferUpdate:!1,enableJSONRendering:!1,enableVirtualScrolling:!1,enableCellContext:!1,enableRTL:!1,enableToolTip:!0,enableToolTipAnimation:!0,enableCellSelection:!1,enableConditionalFormatting:!1,enableColumnGrandTotal:!0,enableRowGrandTotal:!0,enableGrandTotal:!0,enableCollapseByDefault:!1,enableCellDoubleClick:!1,enableDrillThrough:!1,isResponsive:!1,hyperlinkSettings:{enableValueCellHyperlink:!1,enableRowHeaderHyperlink:!1,enableColumnHeaderHyperlink:!1,enableSummaryCellHyperlink:!1},serviceMethodSettings:{initialize:"InitializeGrid",drillDown:"DrillGrid",exportPivotGrid:"Export",paging:"Paging",fetchMembers:"FetchMembers",nodeStateModified:"NodeStateModified",nodeDropped:"NodeDropped",filtering:"Filtering",sorting:"Sorting",deferUpdate:"DeferUpdate",memberExpand:"MemberExpanded",writeBack:"WriteBack"},customObject:{},locale:"en-US",dataSource:{data:null,enableAdvancedFilter:!1,columns:[],cube:"",catalog:"",rows:[],values:[],filters:[]},collapsedMembers:null,cellSelection:null,valueCellHyperlinkClick:null,rowHeaderHyperlinkClick:null,columnHeaderHyperlinkClick:null,summaryCellHyperlinkClick:null,beforeServiceInvoke:null,afterServiceInvoke:null,drillThrough:null,drillSuccess:null,cellContext:null,load:null,renderComplete:null,renderFailure:null,renderSuccess:null,cellDoubleClick:null,applyFieldCaption:null,beforePivotEnginePopulate:null},dataTypes:{serviceMethodSettings:"data",customObject:"data"},observables:["layout","enableCellContext","hyperlinkSettings.enableValueCellHyperlink","hyperlinkSettings.enableRowHeaderHyperlink","hyperlinkSettings.enableColumnHeaderHyperlink","hyperlinkSettings.enableSummaryCellHyperlink"],layout:t.util.valueFunction("layout"),enableCellContext:t.util.valueFunction("enableCellContext"),enableValueCellHyperlink:t.util.valueFunction("hyperlinkSettings.enableValueCellHyperlink"),enableRowHeaderHyperlink:t.util.valueFunction("hyperlinkSettings.enableRowHeaderHyperlink"),enableColumnHeaderHyperlink:t.util.valueFunction("hyperlinkSettings.enableColumnHeaderHyperlink"),enableSummaryCellHyperlink:t.util.valueFunction("hyperlinkSettings.enableSummaryCellHyperlink"),locale:t.util.valueFunction("locale"),getOlapReport:function(){return this._olapReport},setOlapReport:function(n){this._olapReport=n},getJSONRecords:function(){return this._JSONRecords},setJSONRecords:function(t){this._JSONRecords=n.parseJSON(t)},_init:function(){this._initPrivateProperties();this._load()},_destroy:function(){n(this.element).next().length>0&&n(this.element).next()[0].className=="pGridTooltip"&&n(this.element).next().remove();this.element.empty().removeClass("e-pivotgrid"+this.model.cssClass);this._ogridWaitingPopup!=r&&this._ogridWaitingPopup._destroy()},_initPrivateProperties:function(){this._id=this.element.attr("id");this._olapReport="";this._JSONRecords=null;this._drillCaption="";this._drillAction="";this._startDrilldown=!1;this._pagerObj=null;this._seriesPageCount=null;this._categPageCount=null;this._seriesCurrentPage=1;this._categCurrentPage=1;this._drillHeaders=[];this._collapsedRowHeaders=[];this._isDragging=!1;this._droppedClass="";this._dataModel="";this._ascdes="";this._filterUpdate=[];this._pivotRow=[];this._pivotColumn=[];this._pivotCalculation=[];this._pivotFilter=[];this._pivotTableFields=[];this._schemaData=null;this._ogridWaitingPopup=null;this._oriX=null;this._oriY=null;this._startPosCell=null;this._maxViewLoading=null;this._formattingArrayClone=[];this._removedItems=[];this._mdformattingArray=[];this._defaultStyleSCell=[];this._defaultStyleVCell=[];this._list=[];this._list.push("Add New");this._rowCount=0;this._dialogTitle="";this._selectedField="";this._selectedAxis="";this._isUpdateRequired=!1;this._isMembersFiltered=!1;this._selectedCell=null;this._onholdKey="";this._primaryCellPos="";this._currentReportItems=[];this._rowHeader=[];this._colHeader=[];this._editorFlag=!0;this._dimension},_load:function(){var r={action:"initialize",element:this.element,customObject:this.model.customObject},i,u;if(this._trigger("load",r),this.element.addClass(this.model.cssClass),this._dataModel=this.model.dataSource.cube!=""?"XMLA":"",typeof oclientWaitingPopup!="undefined"&&oclientWaitingPopup!=null?(this.model.customObject=oclientProxy.model.customObject,n("#"+oclientProxy._id+"_maxView")[0]?(n("#"+oclientProxy._id+"_maxView").ejWaitingPopup({showOnInit:!0}),this._maxViewLoading=("#"+oclientProxy._id+"_maxView").data("ejWaitingPopup")):oclientWaitingPopup.show()):typeof oclientWaitingPopup=="undefined"&&(n("#"+this._id).ejWaitingPopup({showOnInit:!0}),this._ogridWaitingPopup=n("#"+this._id).data("ejWaitingPopup")),this.model.beforeServiceInvoke!=null&&this._trigger("beforeServiceInvoke",{action:"initialize",element:this.element,customObject:this.model.customObject}),i=JSON.stringify(this.model.customObject),this.model.enableJSONRendering==!0){this._renderControlSuccess(this.model.jsonRecords);return}if(this.model.dataSource.data==null&&this.model.url==""&&this._dataModel==""){this.renderControlFromJSON(null);this._ogridWaitingPopup.hide();return}this.model.dataSource.data==null&&this.model.url!=""||this.model.dataSource.data!=null&&this.model.url!=""&&this.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode?(this.model.operationalMode=t.PivotGrid.OperationalMode.ServerMode,this.model.enableVirtualScrolling&&(this.model.layout=t.PivotGrid.Layout.NoSummaries),this.element[0]!=null&&this.element.parents().find(".controlPanel").length>0&&this.layout()!=""&&this.layout()!=t.PivotGrid.Layout.Normal?this.doAjaxPost("POST",this.model.url+"/"+this.model.serviceMethodSettings.initialize,JSON.stringify({action:"initializeGrid",currentReport:this.model.currentReport,gridLayout:this.layout(),customObject:i}),this._renderControlSuccess):this.element[0]!=null&&this.element.parents().find(".controlPanel").length>0?this.doAjaxPost("POST",this.model.url+"/"+this.model.serviceMethodSettings.initialize,JSON.stringify({action:"initializeGrid",currentReport:this.model.currentReport,customObject:i}),this._renderControlSuccess):this.layout()!=""&&this.layout()!=t.PivotGrid.Layout.Normal?this.doAjaxPost("POST",this.model.url+"/"+this.model.serviceMethodSettings.initialize,JSON.stringify({action:"initializeGrid",gridLayout:this.layout(),enablePivotFieldList:this.model.enablePivotFieldList,customObject:i}),this._renderControlSuccess):this.doAjaxPost("POST",this.model.url+"/"+this.model.serviceMethodSettings.initialize,JSON.stringify({action:"initializeGrid",enablePivotFieldList:this.model.enablePivotFieldList,customObject:i}),this._renderControlSuccess)):(this.model.operationalMode=t.PivotGrid.OperationalMode.ClientMode,this._dataModel=="XMLA"?u=t.olap.base.getJSONData({action:"initialLoad"},this.model.dataSource,this):(this._setCaptions(),this._populatePivotGrid()))},_setCaptions:function(){n.each(this.model.dataSource.rows,function(n,t){t.fieldCaption==r&&(t.fieldCaption=t.fieldName)});n.each(this.model.dataSource.columns,function(n,t){t.fieldCaption==r&&(t.fieldCaption=t.fieldName)});n.each(this.model.dataSource.filters,function(n,t){t.fieldCaption==r&&(t.fieldCaption=t.fieldName)});n.each(this.model.dataSource.values,function(n,t){t.fieldCaption==r&&(t.fieldCaption=t.fieldName)})},refreshFieldCaption:function(n,t,i){var r;if(i.indexOf("row")>=0)for(r=0;r<this.model.dataSource.rows.length;r++)n==this.model.dataSource.rows[r].fieldName&&(this.model.dataSource.rows[r].fieldCaption=t);else if(i.indexOf("calc")>=0)for(r=0;r<this.model.dataSource.values.length;r++)n==this.model.dataSource.values[r].fieldName&&(this.model.dataSource.values[r].fieldCaption=t);else if(i.indexOf("col")>=0)for(r=0;r<this.model.dataSource.columns.length;r++)n==this.model.dataSource.columns[r].fieldName&&(this.model.dataSource.columns[r].fieldCaption=t);else for(r=0;r<this.model.dataSource.filters.length;r++)n==this.model.dataSource.filters[r].fieldName&&(this.model.dataSource.filters[r].fieldCaption=t);for(r=0;r<this._pivotTableFields.length;r++)n==this._pivotTableFields[r].name&&(this._pivotTableFields[r].caption=t)},refreshPivotGrid:function(){this._dataModel=="Pivot"?(this.getOlapReport()&&(this.model.dataSource.rows&&(this.model.dataSource.rows=this.getOlapReport().rows),this.model.dataSource.columns&&(this.model.dataSource.columns=this.getOlapReport().columns),this.model.dataSource.filters&&(this.model.dataSource.filters=this.getOlapReport().filters),this.model.dataSource.values&&(this.model.dataSource.values=this.getOlapReport().values)),this._populatePivotGrid()):this._dataModel=="XMLA"&&t.olap.base.getJSONData({action:"initialLoad"},this.model.dataSource,this)},_populatePivotGrid:function(){var u,f,h,s,i,e,o;for(this._trigger("beforePivotEnginePopulate",{pivotObject:this}),u=t.PivotAnalysis.pivotEnginePopulate(this.model),this._dataModel="Pivot",this.setJSONRecords(JSON.stringify(u.json)),this.setOlapReport(u.report),this._pivotTableFields=u.treeviewData,f=n.each(this._pivotTableFields,function(n,t){t.caption==r&&(t.caption="")}),this._trigger("applyFieldCaption",f),h=[this.model.dataSource.rows,this.model.dataSource.columns,this.model.dataSource.filters,this.model.dataSource.values],s=[].concat.apply([],h),i=0;i<this._pivotTableFields.length;i++){for(e=0;e<s.length;e++)(this._pivotTableFields[i].caption==r||this._pivotTableFields[i].caption=="")&&s[e].fieldName==this._pivotTableFields[i].name&&(this._pivotTableFields[i].caption=s[e].fieldCaption);for(o=0;o<f.length;o++)(this._pivotTableFields[i].caption==r||this._pivotTableFields[i].caption=="")&&f[o].name==this._pivotTableFields[i].name&&(this._pivotTableFields[i].caption=f[o].caption);(this._pivotTableFields[i].caption==r||this._pivotTableFields[i].caption=="")&&(this._pivotTableFields[i].caption=this._pivotTableFields[i].name)}this._createGroupingBar(u.report);this.renderControlFromJSON(u.json);this._ogridWaitingPopup.hide();this._trigger("renderSuccess",this);this._schemaData!=null&&pschemaDesignerWaitingPopup.hide()},_setFirst:!0,_setModel:function(n){for(var t in n)switch(t){case"OlapReport":this.setOlapReport(n[t]);break;case"JsonData":this.setOlapReport(n[t]);break;case"RefreshOlapGrid":this.element.renderControlFromJSON(n[t]);break;case"layout":this._load();break;case"customObject":this.model.customObject=n[t];break;case"enableCellContext":this._load();break;case"enableValueCellHyperlink":this._load();break;case"enableRowHeaderHyperlink":this._load();break;case"enableColumnHeaderHyperlink":this._load();break;case"enableSummaryCellHyperlink":this._load();break;case"locale":this._load()}},_wireEvents:function(){this.model.enableCellSelection&&(this._on(this.element,"mousedown touchstart",".value",this._initCellSelection),this._on(this.element,"click",".colheader,.rowheader",this._headerClickCellSelection));this.enableCellContext()==!0&&(document.addEventListener?(document.removeEventListener("contextmenu",this._cellContext,!1),document.addEventListener("contextmenu",this._cellContext,!1)):(document.detachEvent("oncontextmenu",this._cellContext),document.attachEvent("oncontextmenu",this._cellContext)));this._on(this.element,"mouseover",".pivotButton",t.proxy(function(i){this._isDragging&&(this.element.append(t.buildTag("span.dropIndicator dropIndicatorActive")[0].outerHTML),i.target.className.indexOf("pivotButton")>=0?this.element.find(".dropIndicator").css("top",n(i.target).position().top-20).css("left",n(i.target).position().left-3):this.element.find(".dropIndicator").css("top",n(i.target).parents(".pivotButton").position().top-20).css("left",n(i.target).parents(".pivotButton").position().left-3))},this));this._on(this.element,"mouseleave",".pivotButton",t.proxy(function(){this._isDragging&&this.element.find(".dropIndicator").removeClass("dropIndicatorActive")},this));this.drillDownHandler=n.proxy(this._drillDown,this);this.addHyperlinkHandler=n.proxy(this._addHyperlink,this);this.removeHyperlinkHandler=n.proxy(this._removeHyperlink,this);this.model.enableCellSelection&&(n(document).bind("click",this._clearSelection),n(document).bind("keyup",this._endCellSelection),n(document).bind("keydown",this._startCellSelection));this._on(this.element,"mouseover",this._dataModel=="Olap"?".value .cellValue, .rowheader .cellValue, .colheader .cellValue":".value .cellValue, .rowheader .cellValue, .colheader .cellValue, .summary .cellValue",this.addHyperlinkHandler);this._on(this.element,"mouseleave",this._dataModel=="Olap"?".value, .rowheader, .colheader":".value .cellValue, .rowheader .cellValue, .colheader .cellValue, .summary .cellValue",this.removeHyperlinkHandler);this._on(this.element,"click",this._dataModel=="Olap"?".value .cellValue, .rowheader .cellValue, .colheader .cellValue":".value .cellValue, .rowheader .cellValue, .colheader .cellValue, .summary .cellValue",function(t){if(t.target.className.indexOf("hyperlink")!=-1){var i=n(t.target.parentElement).attr("p"),r=this.getJSONRecords()[parseInt(parseInt(i.split(",")[0])*this._rowCount+parseInt(i.split(",")[1]))].Info,u={cellValue:t.target.innerHTML,cellPosition:i,cellType:t.target.parentElement.className.split(" ")[0],uniqueName:r.split("::")[0],args:t,rawdata:r};this._dataModel=="Pivot"&&t.target.parentElement.className.indexOf("summary")>=0||t.target.parentElement.className.indexOf("summary value")>=0?this._trigger("summaryCellHyperlinkClick",{element:this.element,customObject:this.model.customObject,args:t}):t.target.parentElement.className.indexOf("value")>=0?this._trigger("valueCellHyperlinkClick",{element:this.element,customObject:this.model.customObject,args:t}):t.target.parentElement.className.indexOf("rowheader")>=0?this._trigger("rowHeaderHyperlinkClick",{element:this.element,customObject:this.model.customObject,args:t}):t.target.parentElement.className.indexOf("colheader")>=0&&this._trigger("columnHeaderHyperlinkClick",{element:this.element,customObject:this.model.customObject,args:t});t.target.parentElement.className.indexOf("value")>=0&&this.model.enableDrillThrough&&this._drillThroughCellClick(t)}});this._on(this.element,"click",this._dataModel=="Pivot"?".rowheader, .colheader, .summary":".rowheader, .colheader",function(t){var i,f,o,e,s,r,h,u;if(this.model.enableCellSelection&&!(n(t.target).hasClass("cellValue")&&n(t.target).hasClass("hyperlinkHeaderCell")))if(i=n(t.target).hasClass("cellValue")?t.target.parentElement:t.target,t.shiftKey){if(window.getSelection().removeAllRanges(),n(this.element).find(".selected").removeClass("selected"),f=n(this._selectedCell).attr("p"),o=n(i).attr("p"),(n(i).hasClass("rowheader")||n(i).attr("role")=="rowheader")&&(n(this._selectedCell).hasClass("rowheader")||n(this._selectedCell).attr("role")=="rowheader"))for(r=Math.min(f.split(",")[1],o.split(",")[1]);r<=Math.max(f.split(",")[1],o.split(",")[1]);r++)this.element.find("[p='"+f.split(",")[0]+","+r+"']").addClass("selected");if((n(i).hasClass("colheader")||n(i).attr("role")=="columnheader")&&(n(this._selectedCell).hasClass("colheader")||n(this._selectedCell).attr("role")=="columnheader"))for(r=Math.min(f.split(",")[0],o.split(",")[0]);r<=Math.max(f.split(",")[0],o.split(",")[0]);r++)this.element.find("[p='"+r+","+f.split(",")[1]+"']").addClass("selected");if(e=n(this.element).find(".selected"),e.length>0){for(s=[],r=0;r<e.length;r++)h=n(e[r]).attr("p"),u=this.getJSONRecords()[parseInt(parseInt(h.split(",")[0])*this._rowCount+parseInt(h.split(",")[1]))],u.Value=n(e[r]).text().trim(),this._dataModel=="Pivot"&&(u.Field=this._getFieldName(e[r])),s.push(u);this._trigger("cellSelection",{JSONRecords:s})}}else t.ctrlKey||n(this.element).find(".selected").removeClass("selected"),(n(i).hasClass("colheader")||n(i).hasClass("rowheader")||n(i).attr("role")=="rowheader"||n(i).attr("role")=="columnheader")&&(t.ctrlKey?n(i).toggleClass("selected"):n(i).addClass("selected"),this._selectedCell=i,this._primaryCellPos=n(i).attr("p"),u=this.getJSONRecords()[parseInt(parseInt(this._primaryCellPos.split(",")[0])*this._rowCount+parseInt(this._primaryCellPos.split(",")[1]))],u.Value=n(i).text().trim(),this._dataModel=="Pivot"&&(u.Field=this._getFieldName(i)),t.ctrlKey||this._trigger("cellSelection",{JSONRecords:[u]}))});typeof oclientProxy!="undefined"?oclientProxy.model.enableDeferUpdate||this._on(this.element,"click",".expand, .collapse",t.proxy(this._drillDown,this)):this._on(this.element,"click",".expand, .collapse",t.proxy(this._drillDown,this));this._on(this.element,"mouseover",".colheader, .rowheader, .expand, .collapse",function(t){if(t.target.className.indexOf("expand")>-1&&!n(t.target).hasClass("header-hover-expand"))n(t.target).addClass("header-hover-expand");else if(t.target.className.indexOf("collapse")>-1&&!n(t.target).hasClass("header-hover-collapse"))n(t.target).addClass("header-hover-collapse");else if((t.target.className.indexOf("expand")<0||t.target.className.indexOf("collapse")<0)&&n(t.target).children("span").length>0){var i=n(t.target).children("span")[0];!n(i).hasClass("header-hover-expand")&&i.className.indexOf("expand")>-1?n(i).addClass("header-hover-expand"):!n(i).hasClass("header-hover-collapse")&&i.className.indexOf("collapse")>-1&&n(i).addClass("header-hover-collapse")}});this._on(this.element,"mouseleave",".colheader, .rowheader, .expand, .collapse",function(){this.element.find(".expand, .collapse").removeClass("header-hover-expand header-hover-collapse")});this.model.enableToolTip&&(this._on(this.element,"mouseover",".value",this._applyToolTip),this._on(this.element,"mouseleave",".value",function(){this.model.enableToolTipAnimation?n("#"+this._id+"_gridTooltip").hide("slow"):n("#"+this._id+"_gridTooltip").hide()}));this.model.enableDrillThrough&&n.proxy(this._addHyperlink,this);this._on(this.element,"click",".filter",t.proxy(this._onFilterBtnClick,this));this._on(this.element,"click",".sorting",t.proxy(this._onSortBtnClick,this));this._on(this.element,"click",".removeBtn",t.proxy(this._removePvtBtn,this));this._on(this.element,"click",".ascOrder, .descOrder",t.proxy(this._sortDimensionElement,this));this._on(this.element,"mouseover",".pvtBtn",function(t){n(t.target.parentElement).addClass("e-btn e-select")});this._on(this.element,"mouseleave",".pvtBtn",function(t){n(t.target.parentElement).removeClass("e-btn e-select");n(t.target).removeClass("hoverBtn")});this._on(this.element,"mouseover",".pivotButton",function(t){t.target.title=t.target.textContent;n(t.target).find("button").addClass("hoverBtn")});this._on(this.element,"mouseleave",".pivotButton",function(t){n(t.target).find("button").removeClass("hoverBtn")});this._on(this.element,"mouseover",".filter,.sorting,.removeBtn",function(t){n(t.target.parentElement).find("button").addClass("hoverBtn")});this._on(this.element,"mouseleave",".filter,.sorting,.removeBtn",function(t){n(t.target.parentElement).find("button").removeClass("hoverBtn")})},_unWireEvents:function(){this._off(this.element,"click",".expand, .collapse");this._off(this.element,"dblclick",".value, .summary");this._off(this.element,"mouseover",".colheader, .rowheader, .expand, .collapse");this._off(this.element,"mouseleave",".colheader, .rowheader, .expand, .collapse");this._off(this.element,"mouseover",this._dataModel=="Olap"?".value, .rowheader, .colheader":".value, .rowheader, .colheader, .summary",this.addHyperlinkHandler);this._off(this.element,"mouseleave",this._dataModel=="Olap"?".value, .rowheader, .colheader":".value, .rowheader, .colheader, .summary",this.removeHyperlinkHandler);this._off(this.element,"click",this._dataModel=="Olap"?".value, .rowheader, .colheader":".value, .rowheader, .colheader, .summary");this._off(this.element,"mouseover",".value");this._off(this.element,"mouseleave",".value");this._off(this.element,"mousedown touchstart",".value");this._off(this.element,"mouseup touchend",".value");this._off(this.element,"click",".filter");this._off(this.element,"click",".sorting");this._off(this.element,"click",".removeBtn");this._off(this.element,"mouseover",".pvtBtn");this._off(this.element,"mouseleave",".pvtBtn");n(document).unbind("keyup",this._endCellSelection);n(document).unbind("keydown",this._startCellSelection);n(document).unbind("click",this._clearSelection)},_getFieldName:function(i){var r,u,f;return n(i).hasClass("colheader")||n(i).attr("role")=="columnheader"?(r=parseInt(n(i).attr("p").split(",")[1]),u=this.model.operationalMode==t.PivotGrid.OperationalMode.ClientMode?this.model.dataSource.columns:JSON.parse(this.getOlapReport()).PivotColumns,r<u.length?this.model.operationalMode==t.PivotGrid.OperationalMode.ClientMode?u[r].fieldName:u[r].FieldName:i.textContent):n(i).hasClass("rowheader")||n(i).attr("role")=="rowheader"?(f=parseInt(n(i).attr("p").split(",")[0]),this.model.operationalMode==t.PivotGrid.OperationalMode.ClientMode?this.model.dataSource.rows[f].fieldName:JSON.parse(this.getOlapReport()).PivotRows[f].FieldName):void 0},_clearSelection:function(t){n(t.target).parents(".pivotGridTable").length==0&&n(this.element).find(".selected").removeClass("selected")},_startCellSelection:function(i){var f,e,u,o,r;if(this._onholdKey!="Control"&&!t.isNullOrUndefined(this._selectedCell))if(i.preventDefault(),this._onholdKey==""&&(this._onholdKey=i.which.toString()=="16"?"Shift":i.which.toString()=="17"?"Control":""),i.which=="40"){for(f=n(this._selectedCell).attr("p"),e=parseInt(f.split(",")[1])+this._selectedCell.rowSpan;t.isNullOrUndefined(u)&&e<this._rowCount;)r=n(this.element).find("[p='"+f.split(",")[0]+","+e+"']")[0],!t.isNullOrUndefined(r)&&n(r).css("display")!="none"&&n(n(r).parents("tr")[0]).css("display")!="none"&&(n(r).hasClass("rowheader")||n(r).attr("role")=="rowheader"||n(r).hasClass("colheader")||n(r).attr("role")=="columnheader")&&(u=r),e++;t.isNullOrUndefined(u)||this._selectCells("Down",u)}else if(i.which=="38"){for(f=n(this._selectedCell).attr("p"),e=parseInt(f.split(",")[1])-1;t.isNullOrUndefined(u)&&e>=0;)r=n(this.element).find("[p='"+f.split(",")[0]+","+e+"']")[0],!t.isNullOrUndefined(r)&&n(r).css("display")!="none"&&n(n(r).parents("tr")[0]).css("display")!="none"&&(n(r).hasClass("rowheader")||n(r).attr("role")=="rowheader"||n(r).hasClass("colheader")||n(r).attr("role")=="columnheader")&&(u=r),e--;if(t.isNullOrUndefined(u)&&this._onholdKey!="Shift"&&(n(this._selectedCell).hasClass("colheader")||n(this._selectedCell).attr("role")=="columnheader"))for(column=parseInt(f.split(",")[0])-1;column>0&&t.isNullOrUndefined(u);column--)for(row=parseInt(f.split(",")[1]-1);row>=0&&t.isNullOrUndefined(u);row--)r=n(this.element).find("[p='"+column+","+row+"']")[0],!t.isNullOrUndefined(r)&&n(r).css("display")!="none"&&n(n(r).parents("tr")[0]).css("display")!="none"&&(n(r).hasClass("colheader")||n(r).attr("role")=="columnheader")&&(u=r);t.isNullOrUndefined(u)||this._selectCells("Up",u)}else if(i.which=="39"){for(f=n(this._selectedCell).attr("p"),e=parseInt(f.split(",")[0])+this._selectedCell.colSpan;t.isNullOrUndefined(u)&&e<Math.ceil(this.getJSONRecords().length/this._rowCount);)r=n(this.element).find("[p='"+e+","+f.split(",")[1]+"']")[0],!t.isNullOrUndefined(r)&&n(r).css("display")!="none"&&n(n(r).parents("tr")[0]).css("display")!="none"&&(n(r).hasClass("rowheader")||n(r).attr("role")=="rowheader"||n(r).hasClass("colheader")||n(r).attr("role")=="columnheader")&&(u=r),e++;t.isNullOrUndefined(u)||this._selectCells("Right",u)}else if(i.which=="37"){for(var f=n(this._selectedCell).attr("p"),e=parseInt(f.split(",")[0])-1,u=n(this.element).find("[p='"+(parseInt(f.split(",")[0])-1)+","+f.split(",")[1]+"']")[0];t.isNullOrUndefined(u)&&e>=0;)r=n(this.element).find("[p='"+e+","+f.split(",")[1]+"']")[0],!t.isNullOrUndefined(r)&&n(r).css("display")!="none"&&n(n(r).parents("tr")[0]).css("display")!="none"&&(n(r).hasClass("rowheader")||n(r).attr("role")=="rowheader"||n(r).hasClass("colheader")||n(r).attr("role")=="columnheader")&&(u=r),e--;if(t.isNullOrUndefined(u)&&this._onholdKey!="Shift"&&(n(this._selectedCell).hasClass("rowheader")||n(this._selectedCell).attr("role")=="rowheader"))for(o=parseInt(f.split(",")[1])-1;t.isNullOrUndefined(u)&&o>0;)r=n(this.element).find("[p='"+parseInt(f.split(",")[0]-1)+","+o+"']")[0],!t.isNullOrUndefined(r)&&n(r).css("display")!="none"&&n(n(r).parents("tr")[0]).css("display")!="none"&&(n(r).hasClass("rowheader")||n(r).attr("role")=="rowheader")&&(u=r),o--;t.isNullOrUndefined(u)||this._selectCells("Left",u)}},_endCellSelection:function(i){var r,e,u,o,f;if(!t.isNullOrUndefined(this._selectedCell)&&(i.preventDefault(),(i.which==16||i.which==17)&&(this._onholdKey="",r=n(this.element).find(".selected"),r.length>0))){for(e=[],u=0;u<r.length;u++)o=n(r[u]).attr("p"),f=this.getJSONRecords()[parseInt(parseInt(o.split(",")[0])*this._rowCount+parseInt(o.split(",")[1]))],f.Value=n(r[u]).text().trim(),this._dataModel=="Pivot"&&(f.Field=this._getFieldName(r[u])),e.push(f);this._trigger("cellSelection",{JSONRecords:e})}},_selectCells:function(t,i){var f,r,o,u,s,e,h;if(this._onholdKey=="Shift")((t=="Up"||t=="Down")&&(n(i).hasClass("rowheader")||n(i).attr("role")=="rowheader")||(t=="Right"||t=="Left")&&(n(i).hasClass("colheader")||n(i).attr("role")=="columnheader"))&&(f=t=="Up"||t=="Down"?1:0,(t=="Up"||t=="Left")&&parseInt(n(i).attr("p").split(",")[f])>=parseInt(this._primaryCellPos.split(",")[f])||(t=="Right"||t=="Down")&&parseInt(n(i).attr("p").split(",")[f])<=parseInt(this._primaryCellPos.split(",")[f])?n(this._selectedCell).removeClass("selected"):n(i).attr("p")!="0,0"&&n(i).addClass("selected"));else if(n(i).attr("p")!="0,0"&&(this.element.find(".selected").removeClass("selected"),n(i).addClass("selected"),this._primaryCellPos=n(i).attr("p"),r=n(this.element).find(".selected"),r.length>0)){for(o=[],u=0;u<r.length;u++)s=n(r[u]).attr("p"),e=this.getJSONRecords()[parseInt(parseInt(s.split(",")[0])*this._rowCount+parseInt(s.split(",")[1]))],e.Value=n(r[u]).text().trim(),this._dataModel=="Pivot"&&(e.Field=this._getFieldName(r[u])),o.push(e);this._trigger("cellSelection",{JSONRecords:o})}h=t=="Up"||t=="Down"?!n(this._selectedCell).hasClass("colheader")&&n(this._selectedCell).attr("role")!="columnheader":!n(this._selectedCell).hasClass("rowheader")&&n(this._selectedCell).attr("role")!="rowheader";n(i).attr("p")!="0,0"&&(this._onholdKey!="Shift"||h)&&(this._selectedCell=i)},_onSortBtnClick:function(i){var f,u,r,o,e,h;if(this._isUpdateRequired=!0,n(i.target).toggleClass("descending"),this.model.operationalMode==t.PivotGrid.OperationalMode.ClientMode){var c=n(i.target).siblings(".pvtBtn").attr("fieldName"),l=n(i.target).siblings(".pvtBtn").text(),a=this.model.dataSource[n(i.target).siblings(".pvtBtn").attr("axis").toLowerCase()],s=n.grep(a,function(n){return n.fieldName==c&&n.fieldCaption==l}),v=i.target.className.indexOf("descending")>=0?t.PivotAnalysis.SortOrder.Descending:t.PivotAnalysis.SortOrder.Ascending;for(r=0;r<s.length;r++)s[r].sortOrder=v;this._populatePivotGrid()}else{for(f=this._ascdes.split("##"),u=0,r=0;r<f.length;r++)f[r]==n(n(i.target).siblings()[1]).text()&&(u=1);classNames=i.target.className;isDescending=new RegExp("descending");isDescending.test(classNames)?u==0&&(this._ascdes+=n(n(i.target).siblings()[1]).text()+"##"):u==1&&(this._ascdes=this._ascdes.replace(n(n(i.target).siblings()[1]).text()+"##",""));e=JSON.stringify(this.model.customObject);try{o=JSON.parse(this.getOlapReport()).Report}catch(y){o=this.getOlapReport()}this.model.beforeServiceInvoke!=null&&this._trigger("beforeServiceInvoke",{action:"sorting",element:this.element,customObject:this.model.customObject});e=JSON.stringify(this.model.customObject);h=JSON.stringify({action:"sorting",sortedHeaders:this._ascdes,currentReport:o,customObject:e});this._ogridWaitingPopup=this.element.data("ejWaitingPopup");t.isNullOrUndefined(this._ogridWaitingPopup)||this._ogridWaitingPopup.show();this.model.enableDeferUpdate?t.isNullOrUndefined(this._ogridWaitingPopup)||this._ogridWaitingPopup.hide():this.doAjaxPost("POST",this.model.url+"/"+this.model.serviceMethodSettings.sorting,h,this._sortingSuccess)}},calculateCellWidths:function(){var f={rowHeight:0,columnWidths:[]},r,t,u,i;if(r=this.getJSONRecords()!=null?this.getJSONRecords().length/this._rowCount:0,t=1,u=!1,r>0)for(f.rowHeight=this.element.find("tbody tr:visible").length>0?this.element.find("tbody tr:visible").outerHeight():0,i=0;i<r&&t<=r;i++)n(this.element.find("th[p^="+i+"]:visible")).each(function(){if(n(this).length>0&&n(this).attr("colspan")==t&&n(this).attr("p").split(",")[0]==i)return f.columnWidths.push(n(this).outerWidth()),i+=t-1,t=1,u=!0,!1;u=!1}),u||t==r?t=1:(i--,t++);return f},_deferUpdate:function(){var i,r,n,u;if(!this._isUpdateRequired)return!1;this._isUpdateRequired=!1;try{i=JSON.parse(this.getOlapReport()).Report}catch(f){i=this.getOlapReport()}for(r="",n=0;n<this._filterUpdate.length;n++)r+=this._filterUpdate[n]+"%%";u=JSON.stringify({action:"deferUpdate",sortedHeaders:this._ascdes,filterParams:r,currentReport:i});this.doAjaxPost("POST",this.model.url+"/"+this.model.serviceMethodSettings.deferUpdate,u,this._renderControlSuccess);this._filterUpdate=[];this._ogridWaitingPopup=this.element.data("ejWaitingPopup");t.isNullOrUndefined(this._ogridWaitingPopup)||this._ogridWaitingPopup.show()},_dialogBtnClick:function(i){var s,p,h,f,u,d,a,k,g,v,nt;if(this._onPreventPanelClose(),this.element.find(".e-dialog, .clientDialog").hide(),i.model.text.toLowerCase()=="cancel"||!this._isMembersFiltered)return t.isNullOrUndefined(this._schemaData)||this._schemaData.element.find(".schemaNoClick").removeClass("freeze").removeAttr("style"),!1;if(this._isUpdateRequired=!0,this.model.operationalMode==t.PivotGrid.OperationalMode.ClientMode)s=[],p=[],this._dataModel!="XMLA"?(jQuery.each(this._memberTreeObj.element.find(":input.nodecheckbox:checked"),function(n,t){t.value!="All"&&s.push(t.value)}),jQuery.each(this._memberTreeObj.element.find(":input.nodecheckbox:not(:checked)"),function(n,t){p.push(t.value=t.value=="(blank)"?"":t.value)}),this._pivotFilterItems(s,p),this._populatePivotGrid()):(this._ogridWaitingPopup.show(),h=this._selectedField.toLocaleLowerCase(),this._currentReportItems=n.grep(this._currentReportItems,function(n){if(n.fieldName!=r&&n.fieldName.toLocaleLowerCase()!=h)return n}),this._memberTreeObj=this._updateTreeView(this),this._schemaData!=null&&(this._schemaData._memberTreeObj=this._memberTreeObj),this._currentReportItems.push({filterItems:this._memberTreeObj.dataSource(),fieldName:this._selectedField}),s=n.map(this._getSelectedNodes().split("::"),function(n){return{Id:n.split("||")[0],tag:n.split("||")[1],parentId:n.split("||")[2]}}),f=n.map(this.model.dataSource.columns,function(n){if(n.fieldName!=r&&n.fieldName.toLocaleLowerCase()==h)return n}),f.length==0&&(f=n.map(this.model.dataSource.rows,function(n){if(n.fieldName!=r&&n.fieldName.toLocaleLowerCase()==h)return n})),f.length==0&&(f=n.map(this.model.dataSource.filters,function(n){if(n.fieldName!=r&&n.fieldName.toLocaleLowerCase()==h)return n})),f.length>0&&(this._getUnSelectedNodes()!=""?(this.model.dataSource=this._clearDrilledItems(this.model.dataSource,{action:"filtering"}),f[0].advancedFilter=[],f[0].filterItems={filterType:"include",values:this._removeSelectedNodes(s)},this.element.find(".pivotButton:contains('"+this._selectedField+"') .filter").addClass("filtered"),this._schemaData!=null&&this._schemaData._tableTreeObj.element.find("li[tag='"+this._selectedField+"'] .filter").length==0&&this._schemaData._tableTreeObj.element.find("li[tag='"+this._selectedField+"'] div:first .e-text").after(t.buildTag("span.e-icon",{display:"none"}).addClass("filter")[0].outerHTML)):(delete f[0].filterItems,this._schemaData!=null&&this._schemaData._tableTreeObj.element.find("li[tag='"+this._selectedField+"'] .filter").remove())),this.getJSONData({action:"filtering"},this.model.dataSource,this));else{var tt="",w,c=this._dataModel=="Olap"?tt=this._getUnSelectedNodes()+"FILTERED"+this._getSelectedNodes(this._dataModel=="Olap"?this._curFilteredAxis=="Slicers"?!0:!1:this._curFilteredAxis=="Filter"?!0:!1):this._memberTreeObj.element.find(":input:gt(0).nodecheckbox:not(:checked)"),y=!1,e=this._dataModel=="Olap"?c:this._curFilteredAxis+"::"+this._curFilteredText+"::FILTERED",o=this._curFilteredText,b=[],l={};if(w=this._getUnSelectedNodes()!=""?!0:!1,this._dataModel=="Pivot"){for(u=0;u<c.length;u++)b.push(n(c[u].parentElement).siblings("a").text());for(l[o]=b,t.isNullOrUndefined(this._tempFilterData)&&(this._tempFilterData=[]),u=0;u<this._tempFilterData.length;u++)t.isNullOrUndefined(this._tempFilterData[u][o])||(this._tempFilterData[u][o]=b,y=!0);if(y||this._tempFilterData.push(l),this._schemaData!=null&&(this._schemaData._tempFilterData=this._tempFilterData),t.isNullOrUndefined(this._curFilteredAxis)||this._curFilteredAxis!="")for(u=0;u<c.length;u++)e+="##"+n(c[u].parentElement).siblings("a").text()}else{for(l[this._curFilteredText.split(":")[1]]=e,t.isNullOrUndefined(this._tempFilterData)&&(this._tempFilterData=[]),u=0;u<this._tempFilterData.length;u++)t.isNullOrUndefined(this._tempFilterData[u][this._curFilteredText.split(":")[1]])||(this._tempFilterData[u]=l,y=!0);y||this._tempFilterData.push(l)}if(filteredBtn=this.model.layout=="excel"?this.element.find(".schemaFieldTree li:contains('"+this._curFilteredText+"')"):this.element.find("."+this._curFilteredAxis+" .pivotButton:contains("+this._curFilteredText+") .filterBtn"),this.model.layout==t.PivotGrid.Layout.Normal&&this._schemaData!=null){for(u=0;u<this._schemaData.element.find(".fieldTable").find("li").length;u++)this._dataModel=="Olap"?this._curFilteredText.split(":")[1]==n(this._schemaData.element.find(".fieldTable").find("li")[u]).attr("tag").replace(/\]/g,"").replace(/\[/g,"")&&(this._schemaData._selectedTreeNode=this._schemaData.element.find(".fieldTable").find("li")[u]):this._curFilteredText==this._schemaData.element.find(".fieldTable").find("li")[u].id&&(this._schemaData._selectedTreeNode=this._schemaData.element.find(".fieldTable").find("li")[u]);if(n(this._schemaData._selectedTreeNode).parents("li:eq(0)").children().children("span").hasClass("hierarchyCDB")&&(this._schemaData._selectedTreeNode=n(n(this._schemaData._selectedTreeNode).parents("li:eq(0)"))),w&&n(n(this._schemaData._selectedTreeNode)).find(".filter").length<=0?(d=t.buildTag("span.e-icon",{display:"none"}).addClass("filter")[0].outerHTML,n(n(this._schemaData._selectedTreeNode).find(".e-text")[0]).after(d)):w||n(this._schemaData._selectedTreeNode).find(".filter").remove(),this._curFilteredAxis=="")return!1}try{a=JSON.parse(this.getOlapReport()).Report}catch(it){a=this.getOlapReport()}if(this.model.beforeServiceInvoke!=null&&this._trigger("beforeServiceInvoke",{action:"filtering",element:this.element,customObject:this.model.customObject}),k=JSON.stringify(this.model.customObject),g=this.model.customObject!={}&&e!=""?JSON.stringify({action:"filtering",filterParams:e,sortedHeaders:this._ascdes,currentReport:a,customObject:k,gridLayout:this.model.layout}):this.model.customObject!={}?JSON.stringify({action:"filtering",currentReport:a,customObject:k,gridLayout:this.model.layout}):e!=""?JSON.stringify({action:"filtering",filterParams:e,sortedHeaders:this._ascdes,currentReport:a,gridLayout:this.model.layout}):JSON.stringify({action:"filtering"}),this._ogridWaitingPopup=this.element.data("ejWaitingPopup"),t.isNullOrUndefined(this._ogridWaitingPopup)||this._ogridWaitingPopup.show(),t.isNullOrUndefined(this._schemaData)||this._schemaData.element.find(".schemaNoClick").addClass("freeze").width(n(this._schemaData.element).width()).height(n(this._schemaData.element).height()).css({top:n(this._schemaData.element).offset().top,left:n(this._schemaData.element).offset().left}),this.model.enableDeferUpdate){if(this._filterUpdate.push(e),!t.isNullOrUndefined(this._tempFilterData))for(v=0;v<this._tempFilterData.length;v++)for(nt in this._tempFilterData[v])nt==o&&this._tempFilterData[v][o].length>0&&this.element.find("#pivotButton"+o).next().addClass("filtered");t.isNullOrUndefined(this._ogridWaitingPopup)||this._ogridWaitingPopup.hide();t.isNullOrUndefined(this._schemaData)||this._schemaData.element.find(".schemaNoClick").removeClass("freeze").removeAttr("style")}else this.doAjaxPost("POST",this.model.url+"/"+this.model.serviceMethodSettings.filtering,g,this._filterElementSuccess)}},_removeSelectedNodes:function(t){for(var i,u=n.extend([],t),f=0;f<t.length;f++)for(i=0;i<u.length;i++)u[i].Id==t[f].parentId&&u.splice(i,1);return n.map(u,function(n){if(n.tag!=""&&n.tag!=r)return n.tag.replace(/\&/g,"&amp;")})},_pivotFilterItems:function(i,r){var s=this.model.dataSource[this._selectedAxis=="Slicers"?"filters":this._selectedAxis.toLowerCase()],f=t.PivotAnalysis.getMembers(this._selectedField),u,o;jQuery.each(f,function(n,t){t!=null&&t.toString().replace(/^\s+|\s+$/gm,"")||jQuery.each(r,function(n,i){i.toString().replace(/^\s+|\s+$/gm,"")||(r[n]=t)})});var h=this._selectedField,c=this._dialogTitle,e=n.grep(s,function(n){return n.fieldName==h});for(u=0;u<e.length;u++)e[u].filterItems=i.length==f.length?null:{filterType:t.PivotAnalysis.FilterType.Exclude,values:r};this._schemaData!=null&&(r.length>0&&this._schemaData.element.find(".schemaFieldTree li:contains('"+this._selectedField+"')").find(".filter").length<=0?(o=t.buildTag("span.e-icon",{display:"none"}).addClass("filter")[0].outerHTML,this._schemaData.element.find(".schemaFieldTree li:contains('"+this._selectedField+"')").find(".e-text").after(o)):r.length==0&&this._schemaData.element.find(".schemaFieldTree li:contains('"+this._selectedField+"')").find(".filter").remove())},_getUnSelectedNodes:function(){var f=this.element.find(".editorTreeView")[0],r="",i=n(f).find(":input.nodecheckbox:not(:checked)"),u,t;if(this._dataModel!="XMLA")for(t=0;t<i.length;t++)n(i[t].parentElement).find("span:nth-child(1)").attr("class").indexOf("e-chk-act")>-1||n(i[t].parentElement).attr("aria-checked")=="mixed"||(u=n(i[t]).parents("li:eq(0)"),r+="::"+u[0].id+"||"+n(u).attr("tag"));else for(t=0;t<this._memberTreeObj.dataSource().length;t++)this._memberTreeObj.dataSource()[t].checkedStatus==!1&&(r+="::"+this._memberTreeObj.dataSource()[t].parentId+"||"+this._memberTreeObj.dataSource()[t].tag);return r},_getSelectedNodes:function(i){var o,f,e,h,c,s,r,u;if(this._dataModel=="XMLA"){for(f="",r=0;r<this._memberTreeObj.dataSource().length;r++)this._memberTreeObj.dataSource()[r].checkedStatus==!0&&(f+="::"+this._memberTreeObj.dataSource()[r].id+"||"+this._memberTreeObj.dataSource()[r].tag+"||"+this._memberTreeObj.dataSource()[r].parentId);return f}if(i){for(this.element.find(".editorTreeView").length>0?o=this.element.find(".editorTreeView")[0].childNodes[0]:t.isNullOrUndefined(this._schemaData)||(o=this._memberTreeObj.element[0].childNodes[0]),f=[],e=n(o).children(),r=0;r<e.length;r++){if(u=e[r],h={caption:n(u.firstChild).find("a").text(),parentId:u.parentElement.parentElement.className.indexOf("editorTreeView")>-1?"None":n(u).parents()[1].id,id:u.id,checked:n(u).find(":input.nodecheckbox")[0].checked||n(u).find("span:nth-child(1)").attr("class").indexOf("e-chk-indeter")>-1,expanded:n(u.firstChild).find(".e-minus").length>0?!0:!1,childNodes:[],tag:n(u).attr("tag")},n(u).find("ul:first").children().length>0)for(c=n(u).find("ul:first").children(),s=0;s<c.length;s++)h.childNodes.push(this._getNodeInfo(c[s]));f.push(h)}return JSON.stringify(f)}var o=n(".editorTreeView"),f="",e=n(o).find(":input.nodecheckbox");for(r=0;r<e.length;r++)(e[r].checked||n(e[r].parentElement).attr("aria-checked")=="mixed")&&(u=n(e[r]).parents("li:eq(0)"),f+="::"+u[0].id+"||"+n(u).attr("tag"));return f},_getNodeInfo:function(t){var u={caption:n(t.firstChild).find("a").text(),parentId:t.parentElement.parentElement.className.indexOf("editorTreeView")>-1?"None":n(t).parents()[1].id,id:t.id,checked:n(t).find(":input.nodecheckbox")[0].checked||n(t).find("span:nth-child(1)").attr("class").indexOf("e-chk-indeter")>-1,expanded:n(t.firstChild).find(".e-minus").length>0?!0:!1,childNodes:[],tag:n(t).attr("tag")},r,i;if(n(t).find("ul:first").children().length>0)for(r=n(t).find("ul:first").children(),i=0;i<r.length;i++)u.childNodes.push(this._getNodeInfo(r[i]));return u},_createErrorDialog:function(i,r){var u,f,e;this._errorDialog=r;u=t.buildTag("div#preventDiv.errorDlg").css({width:n("body").width()+"px",height:n("body").height()+"px",position:"absolute",top:n("body").offset().top+"px",left:n("body").offset().left+"px","z-index":10})[0].outerHTML;this.element.find(".e-pivotgrid").append(u);this.element.find(".errorDialog").length==0&&(f=t.buildTag("div.errorDialog#ErrorDialog",t.buildTag("div.warningImg")[0].outerHTML+t.buildTag("div.warningContent action:",r+"--"+i)[0].outerHTML+t.buildTag("div",t.buildTag("button#ErrOKBtn.errOKBtn","OK")[0].outerHTML)[0].outerHTML).attr("title",this._getLocalizedLabels("Warning"))[0].outerHTML,this.element.append(f),this.element.find(".errorDialog").ejDialog({target:"#"+this._id,enableResize:!1,width:"400px"}),e=this.element.find(".errorDialog").data("ejDialog"),n("#"+e._id+"_wrapper").css({left:"50%",top:"50%"}),this.element.find(".errOKBtn").ejButton({type:t.ButtonType.Button,click:t.proxy(this._errOKBtnClick,this)}))},_errOKBtnClick:function(){this._errorDialog!="nodeCheck"||t.isNullOrUndefined(this._schemaData)||t.isNullOrUndefined(this._schemaData._selectedTreeNode)||this._schemaData._tableTreeObj.uncheckNode(this._schemaData._selectedTreeNode);this._onPreventPanelClose();this._ogridWaitingPopup.hide();this.element.children(".e-dialog").remove()},_getLevelInfo:function(t,i){var r=n.map(n(i).find("row"),function(i){if(parseInt(n(i).children("LEVEL_TYPE").text())!="1"&&n(i).children("HIERARCHY_UNIQUE_NAME").text().toLowerCase()!="[measures]"&&n(i).find("HIERARCHY_UNIQUE_NAME").text()==t.hierarchy)return{value:n(i).find("LEVEL_UNIQUE_NAME").text(),text:n(i).find("LEVEL_CAPTION").text()}});this.pivotGridObj._currentReportItems.push({fieldName:t.hierarchy,dropdownData:r})},_createAdvanceFilterTag:function(n){var r="",i=t.buildTag("li.e-separator").css("margin-left","29px")[0].outerHTML;return n.action=="valueFiltering"?r=t.buildTag("ul.filterElementTag#valueFilterBtn",t.buildTag("li",t.buildTag("a",this._getLocalizedLabels("ValueFilters"))[0].outerHTML+t.buildTag("ul.elements",t.buildTag("li.clearFilter",t.buildTag("a",t.buildTag("span.e-clrFilter").addClass("e-icon")[0].outerHTML+this._getLocalizedLabels("ClearFilter")).addClass("e-icon")[0].outerHTML)[0].outerHTML+i+t.buildTag("li.equals",t.buildTag("a",this._getLocalizedLabels("Equals"))[0].outerHTML)[0].outerHTML+t.buildTag("li.notequals",t.buildTag("a",this._getLocalizedLabels("NotEquals"))[0].outerHTML)[0].outerHTML+i+t.buildTag("li.greaterthan",t.buildTag("a",this._getLocalizedLabels("GreaterThan"))[0].outerHTML)[0].outerHTML+t.buildTag("li.greaterthanorequalto",t.buildTag("a",this._getLocalizedLabels("GreaterThanOrEqualTo"))[0].outerHTML)[0].outerHTML+t.buildTag("li.lessthan",t.buildTag("a",this._getLocalizedLabels("LessThan"))[0].outerHTML)[0].outerHTML+t.buildTag("li.lessthanorequalto",t.buildTag("a",this._getLocalizedLabels("LessThanOrEqualTo"))[0].outerHTML)[0].outerHTML+i+t.buildTag("li.between",t.buildTag("a",this._getLocalizedLabels("Between"))[0].outerHTML)[0].outerHTML+t.buildTag("li.notbetween",t.buildTag("a",this._getLocalizedLabels("NotBetween"))[0].outerHTML)[0].outerHTML)[0].outerHTML)[0].outerHTML)[0].outerHTML:n.action=="labelFiltering"?r=t.buildTag("ul.filterElementTag#labelFilterBtn",t.buildTag("li",t.buildTag("a",this._getLocalizedLabels("LabelFilters"))[0].outerHTML+t.buildTag("ul.elements",t.buildTag("li.clearFilter",t.buildTag("a",t.buildTag("span.e-clrFilter").addClass("e-icon")[0].outerHTML+this._getLocalizedLabels("ClearFilter"))[0].outerHTML)[0].outerHTML+i+t.buildTag("li.equals",t.buildTag("a",this._getLocalizedLabels("Equals"))[0].outerHTML)[0].outerHTML+t.buildTag("li.notequals",t.buildTag("a",this._getLocalizedLabels("NotEquals"))[0].outerHTML)[0].outerHTML+i+t.buildTag("li.beginswith",t.buildTag("a",this._getLocalizedLabels("BeginsWith"))[0].outerHTML)[0].outerHTML+t.buildTag("li.notbeginswith",t.buildTag("a",this._getLocalizedLabels("NotBeginsWith"))[0].outerHTML)[0].outerHTML+t.buildTag("li.endswith",t.buildTag("a",this._getLocalizedLabels("EndsWith"))[0].outerHTML)[0].outerHTML+t.buildTag("li.notendswith",t.buildTag("a",this._getLocalizedLabels("NotEndsWith"))[0].outerHTML)[0].outerHTML+i+t.buildTag("li.contains",t.buildTag("a",this._getLocalizedLabels("Contains"))[0].outerHTML)[0].outerHTML+t.buildTag("li.notcontains",t.buildTag("a",this._getLocalizedLabels("NotContains"))[0].outerHTML)[0].outerHTML+i+t.buildTag("li.greaterthan",t.buildTag("a",this._getLocalizedLabels("GreaterThan"))[0].outerHTML)[0].outerHTML+t.buildTag("li.greaterthanorequalto",t.buildTag("a",this._getLocalizedLabels("GreaterThanOrEqualTo"))[0].outerHTML)[0].outerHTML+t.buildTag("li.lessthan",t.buildTag("a",this._getLocalizedLabels("LessThan"))[0].outerHTML)[0].outerHTML+t.buildTag("li.lessthanorequalto",t.buildTag("a",this._getLocalizedLabels("LessThanOrEqualTo"))[0].outerHTML)[0].outerHTML)[0].outerHTML)[0].outerHTML)[0].outerHTML:n.action=="clearFilter"?r=t.buildTag("div.clearSorting",t.buildTag("span.e-clrSort","",{padding:"0px 10px 0px 4px"}).addClass("e-icon")[0].outerHTML+t.buildTag("span.clearSortText","Clear Sorting",{padding:"5px 0px"})[0].outerHTML)[0].outerHTML+t.buildTag("div.clearAllFilters",t.buildTag("span.e-clrFilter","",{padding:"0px 10px 0px 4px"}).addClass("e-icon")[0].outerHTML+t.buildTag("span.clearFltrText",'Clear Filter From "'+n.selectedLevel.text+'"',{padding:"5px 0px"})[0].outerHTML)[0].outerHTML:n.action=="sort"&&(r=t.buildTag("div#sortDiv.sortDiv",t.buildTag("li#ascOrder.ascOrder",t.buildTag("span.ascImage").addClass("e-icon")[0].outerHTML+this._getLocalizedLabels("Sort")+" A to Z")[0].outerHTML+t.buildTag("li#descOrder.descOrder",t.buildTag("span.descImage").addClass("e-icon")[0].outerHTML+this._getLocalizedLabels("Sort")+" Z to A")[0].outerHTML)[0].outerHTML),r},_sortDimensionElement:function(i,r){if(t.isNullOrUndefined(r)?this.element.find(".e-dialog, .clientDialog").remove():r.element.find(".e-dialog, .clientDialog").remove(),this._onPreventPanelClose(),n(i.target).find(".selectedSort").length==0){var u=this._selectedField;n(i.target).hasClass("descOrder")?(this.model.dataSource.columns=n.map(this.model.dataSource.columns,function(n){return n.fieldName.toLowerCase()==u.toLowerCase()&&(n.sortOrder=t.olap.SortOrder.Descending),n}),this.model.dataSource.rows=n.map(this.model.dataSource.rows,function(n){return n.fieldName.toLowerCase()==u.toLowerCase()&&(n.sortOrder=t.olap.SortOrder.Descending),n})):(this.model.dataSource.columns=n.map(this.model.dataSource.columns,function(n){return n.fieldName.toLowerCase()==u.toLowerCase()&&(n.sortOrder=t.olap.SortOrder.Ascending),n}),this.model.dataSource.rows=n.map(this.model.dataSource.rows,function(n){return n.fieldName.toLowerCase()==u.toLowerCase()&&(n.sortOrder=t.olap.SortOrder.Ascending),n}));this._ogridWaitingPopup.show();t.olap.base.getJSONData({action:"sorting"},this.model.dataSource,this)}},_createDialog:function(i,r){var it=t.buildTag("div#preventDiv").css({width:n("body").width()+"px",height:n("body").height()+"px",position:"absolute",top:n("body").offset().top+"px",left:n("body").offset().left+"px","z-index":10})[0].outerHTML,e,s,l,d,c,o,a,v,u,g,nt,tt;n("body").append(it);e=this._dataModel=="XMLA"&&this.model.dataSource.enableAdvancedFilter&&this._getReportItem(this._selectedField).axis!="filters"&&this._getReportItem(this._selectedField).item.length>0?!0:!1;this.element.find(".e-dialog, .clientDialog").remove();var h,f,y="",p="",w="",b="",k="";h=this._selectedField;e&&(f=n.map(this._currentReportItems,function(n){if(n.fieldName==h)return n.dropdownData}),f.length==0&&(l=this._getConnectionInfo(this.model.dataSource.data),d='<Envelope xmlns="http://schemas.xmlsoap.org/soap/envelope/"><Header/><Body><Discover xmlns="urn:schemas-microsoft-com:xml-analysis"><RequestType>MDSCHEMA_LEVELS<\/RequestType><Restrictions><RestrictionList><CATALOG_NAME>'+this.model.dataSource.catalog+"<\/CATALOG_NAME><CUBE_NAME>"+this.model.dataSource.cube+"<\/CUBE_NAME><\/RestrictionList><\/Restrictions><Properties><PropertyList><Catalog>"+this.model.dataSource.catalog+"<\/Catalog> <LocaleIdentifier>"+l.LCID+"<\/LocaleIdentifier> <\/PropertyList><\/Properties><\/Discover><\/Body><\/Envelope>",this.doAjaxPost("POST",l.url,{XMLA:d},this._getLevelInfo,null,{pvtGridObj:this,action:"loadFieldElements",hierarchy:this._selectedField}),f=n.map(this._currentReportItems,function(n){if(n.fieldName==h)return n.dropdownData})),p=this._createAdvanceFilterTag({action:"sort",fieldName:h}),w=t.buildTag("div.ddlGroupWrap","Select field:"+t.buildTag("input#GroupLabelDrop.groupLabelDrop").attr("type","text")[0].outerHTML,{})[0].outerHTML,b=this._createAdvanceFilterTag({action:"valueFiltering"}),k=this._createAdvanceFilterTag({action:"labelFiltering"}),y=this._createAdvanceFilterTag({action:"clearFilter",selectedLevel:f.length>0?f[0]:""}));var rt=t.buildTag("div#EditorDiv.editorDiv",w+p+y+t.buildTag("div",k+b+t.buildTag("div.memberEditorDiv",t.buildTag("div#editorTreeView.editorTreeView")[0].outerHTML)[0].outerHTML)[0].outerHTML)[0].outerHTML+"<\/br>",ut=t.buildTag("div",t.buildTag("button#OKBtn.dialogOKBtn",this._getLocalizedLabels("OK"))[0].outerHTML+t.buildTag("button#CancelBtn.dialogCancelBtn",this._getLocalizedLabels("Cancel"))[0].outerHTML,{float:"right",margin:"-5px "+(e?" 15px ":" 0px ")+" 6px 0px"})[0].outerHTML,ft=t.buildTag("div#clientDialog.clientDialog",rt+ut,{opacity:"1"}).attr("title",i)[0].outerHTML,r=JSON.parse(r);for(u=0;u<r.length;u++)r[u].name!=null&&r[u].name.toString().replace(/^\s+|\s+$/gm,"")||(r[u].name="(blank)",r[u].id="(blank)");if(!t.isNullOrUndefined(this._tempFilterData)){for(u=0;u<this._tempFilterData.length;u++)t.isNullOrUndefined(this._tempFilterData[u][i])||(c=this._tempFilterData[u][i]);if(!t.isNullOrUndefined(c))for(u=0;u<c.length;u++)for(o=0;o<r.length;o++)c[u]==r[o].name&&(r[o].checkedStatus=!1)}for(n(ft).appendTo("#"+this._id),this.element.find(".editorTreeView").ejTreeView({showCheckbox:!0,loadOnDemand:!0,height:n(".memberEditorDiv").height(),fields:{id:"id",text:"name",isChecked:"checkedStatus",hasChild:"hasChildren",dataSource:r}}),e&&(s=this.element.find("[tag*='"+this._selectedField+"']").offset(),this.element.find(".filterElementTag").ejMenu({menuType:t.MenuType.NormalMenu,width:"70%",orientation:t.Orientation.Vertical,click:t.proxy(this._filterElementClick,this)}),this.element.find(".groupLabelDrop").ejDropDownList({width:"99%",dataSource:f,fields:{id:"id",text:"text",value:"value"},change:t.proxy(this._groupLabelChange,this)}),a=this.element.find(".groupLabelDrop").data("ejDropDownList"),a.selectItemByText(a.model.dataSource[0].text),this.element.find(".memberEditorDiv").addClass("advancedFilter"),this.element.find(".clearAllFilters").click(t.proxy(this._clearAllFilters,this)),this.element.find(".clearSorting").click(t.proxy(this._clearSorting,this))),v=this.element.find(".editorTreeView").find("li"),u=0;u<v.length;u++)v[u].setAttribute("tag",r[u].tag);this.element.find(".dialogOKBtn, .dialogCancelBtn").ejButton({type:t.ButtonType.Button,click:t.proxy(this._dialogBtnClick,this)});this._dialogOKBtnObj=this.element.find(".dialogOKBtn").data("ejButton");this._memberTreeObj=this.element.find(".editorTreeView").data("ejTreeView");g=this.element.find(".editorTreeView li:gt(0)");nt=n(g).find(":input.nodecheckbox:not(:checked)");nt.length>0&&(tt=n(this._memberTreeObj.element.find("li:first")).find("div .e-chkbox-small > span > span:eq(0)"),n(tt).removeClass("e-chk-activeicon").addClass("e-chk-indetericon"));this.element.find(".clientDialog").ejDialog({width:265,target:"#"+this._id,enableResize:!1,close:this._onPreventPanelClose});e&&(t.isNullOrUndefined(s)||this.element.find("#clientDialog_wrapper").css({left:s.left+50,top:s.top}),this.element.find(".clientDialog").css("padding","0px").parents().find(".e-titlebar").remove());this._memberTreeObj.model.nodeCheck=t.proxy(this._onNodeCheckChanges,this);this._memberTreeObj.model.nodeUncheck=t.proxy(this._onNodeCheckChanges,this);this._dataModel=="XMLA"&&(this._memberTreeObj.model.beforeExpand=t.proxy(this._onBeforeNodeExpand,this));this._dataModel=="Olap"&&(this._memberTreeObj.model.nodeClick=t.proxy(this._onNodeExpand,this));this._memberTreeObj.element.find(".e-plus").length==0&&this._memberTreeObj.element.find(".e-item").css("padding","0px");this._isMembersFiltered=!1;this._unWireEvents();this._wireEvents();this.element.find(".e-dialog .e-close").click(function(){var i=n(this).parents(".e-pivotgrid").data("ejPivotGrid");t.isNullOrUndefined(i._schemaData)||i._schemaData.element.find(".schemaNoClick").removeClass("freeze").removeAttr("style")})},_clearSorting:function(t){if(n(t.target).parent().attr("disabled")=="disabled")return!1;var u=this.model.dataSource,f=this._selectedField.toLowerCase(),i=n.map(u.columns,function(n){if(n.fieldName!=r&&n.fieldName.toLowerCase()==f)return n});i.length==0&&(i=n.map(u.rows,function(n){if(n.fieldName!=r&&n.fieldName.toLowerCase()==f)return n}));i.length>0&&delete i[0].sortOrder;this.model.dataSource=u;this.element.find(".e-dialog").remove();this._schemaData!=null&&this._schemaData.element.find(".e-dialog").remove();this._ogridWaitingPopup.show();this.getJSONData({action:"clearSorting"},this.model.dataSource,this)},_clearAllFilters:function(t){if(n(t.target).parent().attr("disabled")=="disabled")return!1;var u=this.model.dataSource,f=this._selectedField.toLowerCase(),i=n.map(u.columns,function(n){if(n.fieldName!=r&&n.fieldName.toLowerCase()==f)return n});i.length==0&&(i=n.map(u.rows,function(n){if(n.fieldName!=r&&n.fieldName.toLowerCase()==f)return n}));i.length>0&&(delete i[0].advancedFilter,delete i[0].filterItems);this._currentReportItems=n.grep(this._currentReportItems,function(n){if(n.fieldName!=r&&n.fieldName.toLocaleLowerCase()!=f)return n});this.model.dataSource=u;this.element.find(".e-dialog").remove();this._schemaData!=null&&(this._schemaData._tableTreeObj.element.find("li[tag ='"+this._selectedField+"'] .filter").remove(),this._schemaData.element.find(".e-dialog").remove());this._ogridWaitingPopup.show();this.getJSONData({action:"advancedfiltering"},this.model.dataSource,this)},_groupLabelChange:function(n){var r=this.element.hasClass("e-pivotschemadesigner")?this.model.pivotControl:this,l=this.element.find(".groupLabelDrop").length>0?this.element.find(".groupLabelDrop").data("ejDropDownList"):[],u=r._getAdvancedFiltervalue(r._selectedField,l.getSelectedValue()),o=this.element.find("#valueFilterBtn").data("ejMenu"),s=this.element.find("#labelFilterBtn").data("ejMenu"),h=r._getReportItem(r._selectedField).item,f=t.buildTag("span.filterState").addClass("e-icon")[0].outerHTML,c=t.buildTag("span.activeFilter").addClass("e-icon")[0].outerHTML,i,e;o.disableItem("Clear Filter");s.disableItem("Clear Filter");i=r._getReportItem(r._selectedField);i.item&&(i=i.item,i[0].sortOrder&&i[0].sortOrder!=t.olap.SortOrder.None?(e=i.length>0&&i[0].sortOrder==t.olap.SortOrder.Descending?"desc":"asc",t.isNullOrUndefined(e)||e=="asc"?this.element.find(".clientDialog .ascImage").addClass("selectedSort"):this.element.find(".clientDialog .descImage").addClass("selectedSort")):this.element.find(".clearSorting").css("opacity","0.5").attr("disabled","disabled"));this.element.find(".clearAllFilters").css("opacity","0.5").attr("disabled","disabled");this.element.find(".filterState,.activeFilter").remove();this.element.find(".clearFltrText").text(this._getLocalizedLabels("ClearFilter")+' from "'+n.text+'"');u.length>0?(u[0].advancedFilterType==t.olap.AdvancedFilterType.LabelFilter?(this.element.find("#labelFilterBtn a:eq(0)").append(f),this.element.find("#labelFilterBtn .clearFilter").css("opacity","1").removeAttr("disabled"),this.element.find("#labelFilterBtn ."+u[0].labelFilterOperator+" a").append(c),s.enableItem("Clear Filter")):(this.element.find("#valueFilterBtn a:eq(0)").append(f),this.element.find("#valueFilterBtn .clearFilter").css("opacity","1").removeAttr("disabled"),this.element.find("#valueFilterBtn ."+u[0].valueFilterOperator+" a").append(c),o.enableItem("Clear Filter")),this.element.find(".clearAllFilters").css("opacity","1").removeAttr("disabled")):h.length>0&&h[0].filterItems&&(this.element.find(".memberEditorDiv").before(f),this.element.find(".filterState").css({position:"absolute"},{float:"left"}),this.element.find(".clearAllFilters").css("opacity","1").removeAttr("disabled"))},_getAdvancedFiltervalue:function(t,i){var u=this._getReportItem(t).item,f=[];return u.length>0&&u[0].advancedFilter&&(f=n.map(u[0].advancedFilter,function(n){if(n.name!=r&&n.name.toLocaleLowerCase()==i.toLowerCase())return n})),f},_filterElementClick:function(i,u){var o,v,l,p,w,s,a,b,k,d,nt;if(this._onPreventPanelClose(),!n(i.element).parent().hasClass("filterElementTag")){if(o=this._selectedField,this._filterAction=n(i.element).parents(".filterElementTag")[0].textContent.indexOf("Label Filters")>-1?"labelFiltering":"valueFiltering",v=this.element.find(".groupLabelDrop").length>0?this.element.find(".groupLabelDrop").data("ejDropDownList"):u.element.find(".groupLabelDrop").data("ejDropDownList"),this._selectedLevelUniqueName=v.getSelectedValue(),this.element.find(".e-dialog, .filterDialog, #preventDiv").remove(),this._schemaData!=null&&this._schemaData.element.find(".e-dialog").remove(),n.trim(i.text)==n.trim(this._getLocalizedLabels("ClearFilter"))){var g=this._selectedLevelUniqueName.toLowerCase(),y=[],f=n.map(this.model.dataSource.columns,function(n){if(n.fieldName!=r&&n.fieldName.toLowerCase()==o.toLowerCase())return n});return f.length==0&&(f=n.map(this.model.dataSource.rows,function(n){if(n.fieldName!=r&&n.fieldName.toLowerCase()==o.toLowerCase())return n})),f.length>0&&(f[0].advancedFilter&&(y=n.map(f[0].advancedFilter,function(n){if(n.name!=r&&n.name.toLowerCase()!=g)return n})),f[0].advancedFilter=y,this._schemaData&&(f[0].advancedFilter.length==0&&this._schemaData._tableTreeObj.element.find("li[tag ='"+o+"'] div:eq(0) .filter").remove(),this._schemaData._tableTreeObj.element.find("li[tag='"+this._selectedLevelUniqueName+"'] div:eq(0) .filter").remove())),this._ogridWaitingPopup.show(),this.getJSONData({action:"advancedfiltering"},this.model.dataSource,this),!1}var h,c,e=this._getAdvancedFiltervalue(o,this._selectedLevelUniqueName);if(e=n(i.element).find(".activeFilter").length>0&&e.length>0?e[0].values:[""],this._filterAction=="labelFiltering")h=t.buildTag("table.labelfilter",t.buildTag("tr",t.buildTag("td",this._getLocalizedLabels("LabelFilterLabel")).attr("colspan","2")[0].outerHTML)[0].outerHTML+t.buildTag("tr",t.buildTag("td","<input type='text' id='filterOptions' class='filterOptions' style='width:220px'/>")[0].outerHTML+t.buildTag("td","<input type='text' id='filterValue1' value='"+e[0]+"' style='display:inline; width:190px; height:19px;'/><\/br>")[0].outerHTML)[0].outerHTML)[0].outerHTML,c=[{option:"equals",value:this._getLocalizedLabels("Equals")},{option:"not equals",value:this._getLocalizedLabels("NotEquals")},{option:"begins with",value:this._getLocalizedLabels("BeginsWith")},{option:"not begins with",value:this._getLocalizedLabels("NotBeginsWith")},{option:"ends with",value:this._getLocalizedLabels("EndsWith")},{option:"not ends with",value:this._getLocalizedLabels("NotEndsWith")},{option:"contains",value:this._getLocalizedLabels("Contains")},{option:"notcontains",value:this._getLocalizedLabels("NotContains")},{option:"greater than",value:this._getLocalizedLabels("GreaterThan")},{option:"greater than or equal to",value:this._getLocalizedLabels("GreaterThanOrEqualTo")},{option:"less than",value:this._getLocalizedLabels("LessThan")},{option:"less than or equal to",value:this._getLocalizedLabels("LessThanOrEqualTo")},];else if(this._filterAction=="valueFiltering"){for(l=[],w=n(i.element).hasClass("between")||n(i.element).hasClass("notbetween")?"4":"3",s=0;s<this.model.dataSource.values[0].measures.length;s++)a=this.model.dataSource.values[0].measures[s],l.push({option:a.fieldCaption,value:a.fieldName});p=t.buildTag("td","<input type='text' id='filterMeasures' class='filterMeasures' />").attr("width","180px")[0].outerHTML+t.buildTag("td","<input type='text' id='filterOptions' class='filterOptions'/>").attr("width","180px")[0].outerHTML+t.buildTag("td","<input type='text' id='filterValue1' value='"+e[0]+"' class='filterValues' style='display:inline'/>"+(w=="4"?"<span> and <\/span><input type='text' id='filterValue2' value='"+(e[1]!=r?e[1]:"")+"' class='filterValues' style='display:inline' /> <\/br>":"<\/br>"))[0].outerHTML;h=t.buildTag("table.valuefilter",t.buildTag("tr",t.buildTag("td",this._getLocalizedLabels("ValueFilterLabel")).attr("colspan",i.text=="Between"?"4":"3")[0].outerHTML)[0].outerHTML+t.buildTag("tr",p)[0].outerHTML)[0].outerHTML;c=[{option:"equals",value:this._getLocalizedLabels("Equals")},{option:"not equals",value:this._getLocalizedLabels("NotEquals")},{option:"greater than",value:this._getLocalizedLabels("GreaterThan")},{option:"greater than or equal to",value:this._getLocalizedLabels("GreaterThanOrEqualTo")},{option:"less than",value:this._getLocalizedLabels("LessThan")},{option:"less than or equal to",value:this._getLocalizedLabels("LessThanOrEqualTo")},{option:"between",value:this._getLocalizedLabels("Between")},{option:"not between",value:this._getLocalizedLabels("NotBetween")}]}b=t.buildTag("div",t.buildTag("button#filterDlgOKBtn.dialogOKBtn","OK")[0].outerHTML+t.buildTag("button#filterDlgCancelBtn.dialogCancelBtn","Cancel")[0].outerHTML,{float:"right",margin:"8px 0 6px"})[0].outerHTML;k=t.buildTag("div#filterDialog.filterDialog",h+b,{opacity:"1"}).attr("title",(this._filterAction=="labelFiltering"?"Label Filter(":"Value Filter(")+this._selectedLevelUniqueName.split(".")[2].replace(/\[/g,"").replace(/\]/g,"")+")").attr("tag",this._dialogTitle)[0].outerHTML;n(k).appendTo("#"+this._id);this.element.find(".filterDialog").ejDialog({enableResize:!1,width:"auto",content:"#"+this._id});this.element.find(".filterOptions").ejDropDownList({dataSource:c,width:this._filterAction=="labelFiltering"?"220px":"180px",height:"25px",fields:{text:"value",value:"option"},change:t.proxy(this._filterOptionChanged,this)});d=this.element.find(".filterOptions").data("ejDropDownList");d.setSelectedText(i.text);this._filterAction=="valueFiltering"&&(this.element.find(".filterMeasures").ejDropDownList({dataSource:l,width:"180px",height:"25px",fields:{text:"option",value:"value"}}),this._measureDDL=this.element.find(".filterMeasures").data("ejDropDownList"),this.model.dataSource.values[0].measures.length>0&&this._measureDDL.setSelectedText(this.model.dataSource.values[0].measures[0].fieldCaption));nt=this.element.find("#filterDialog").data("ejDialog");this.element.find("#filterDlgOKBtn").ejButton({click:t.proxy(this._filterElementOkBtnClick,this)});this.element.find("#filterDlgCancelBtn").ejButton({click:function(){n(".e-dialog").hide()}})}},_filterOptionChanged:function(t){var i=this.element.find(".filterValuesTd")[0];t.value.toLowerCase().indexOf("between")>=0&&n(i).html("<input type='text' id='filterValue1' class='filterValues' style='display:inline'/> <span>and<\/span> <input type='text' id='filterValue2' class='filterValues' style='display:inline' /> <\/br>");t.value.toLowerCase().indexOf("between")<0&&n(i).html("<input type='text' id='filterValue1' class='filterValues' style='display:inline'/>")},_filterElementOkBtnClick:function(){var s=this.element.find(".filterOptions")[0].value,u=[this.element.find("#filterValue1")[0].value],o,f=[],e=this._selectedField,a,i;if(this._filterAction=="valueFiltering"){if(o=this._measureDDL.getSelectedValue(),!(!isNaN(parseFloat(u[0]))&&isFinite(u[0]))||o=="")return;this.element.find("#filterValue2")[0]!=r?","+u.push(this.element.find("#filterValue2")[0].value):u}if(this.element.find(".e-dialog").remove(),this._schemaData){var h=t.buildTag("span.filter").addClass("e-icon")[0].outerHTML,c=this._schemaData._tableTreeObj.element.find("li[tag='"+this._selectedLevelUniqueName+"'] div:eq(0)"),l=this._schemaData._tableTreeObj.element.find("li[tag ='"+e+"'] div:eq(0)");c.find(".filter").length==0&&c.append(h);l.find(".filter").length===0&&l.append(h)}a=this._selectedLevelUniqueName.toLowerCase();i=n.map(this.model.dataSource.columns,function(n){if(n.fieldName!=r&&n.fieldName.toLocaleLowerCase()==e.toLowerCase())return n});i.length==0&&(i=n.map(this.model.dataSource.rows,function(n){if(n.fieldName!=r&&n.fieldName.toLocaleLowerCase()==e.toLowerCase())return n}));i.length>0&&(delete i[0].filterItems,i[0].advancedFilter&&(f=n.map(i[0].advancedFilter,function(n){if(n.name!=r&&n.name.toLocaleLowerCase()!=a)return n})),this._filterAction.toLowerCase()=="labelfiltering"?f.push({name:this._selectedLevelUniqueName,labelFilterOperator:s.replace(/ /g,""),advancedFilterType:t.olap.AdvancedFilterType.LabelFilter,values:u}):f.push({name:this._selectedLevelUniqueName,valueFilterOperator:s.replace(/ /g,""),advancedFilterType:t.olap.AdvancedFilterType.ValueFilter,values:u,measure:o}),this._currentReportItems=n.grep(this._currentReportItems,function(n){if(n.fieldName!=e)return n}),i[0].advancedFilter=f);this._ogridWaitingPopup.show();this.getJSONData({action:"advancedfiltering"},this.model.dataSource,this)},_onNodeCheckChanges:function(i){if(this._isMembersFiltered=!0,(i.value=="(All)"||i.value=="All")&&i.type=="nodeUncheck")this._memberTreeObj.model.nodeCheck="",this._memberTreeObj.model.nodeUncheck="",this.element.find(".editorTreeView").ejTreeView("unCheckAll"),this._memberTreeObj.model.nodeCheck=t.proxy(this._onNodeCheckChanges,this),this._memberTreeObj.model.nodeUncheck=t.proxy(this._onNodeCheckChanges,this),this._dialogOKBtnObj.disable();else if((i.value=="(All)"||i.value=="All")&&i.type=="nodeCheck")this._memberTreeObj.model.nodeCheck="",this._memberTreeObj.model.nodeUncheck="",this.element.find(".editorTreeView").ejTreeView("checkAll"),n(this._memberTreeObj.element.find("li:first")).find("div .e-chkbox-small > span > span:eq(0)").removeClass("e-chk-indetericon"),this._memberTreeObj.model.nodeCheck=t.proxy(this._onNodeCheckChanges,this),this._memberTreeObj.model.nodeUncheck=t.proxy(this._onNodeCheckChanges,this),this._dialogOKBtnObj.enable();else if(i.value!="(All)"){var r=this._memberTreeObj.element.find(":input:gt(0).nodecheckbox:not(:checked)"),u=n(this._memberTreeObj.element.find("li:first")).find("div .e-chkbox-small > span > span:eq(0)");r.length==0||r.length==1&&r[0].id[r[0].id.length-1]==0?(n(u).parent().removeClass("e-chk-inact").removeClass("e-chk-ind").addClass("e-chk-act"),u.removeClass("e-chk-indetericon").addClass("e-chk-activeicon")):i.type=="nodeCheck"&&r.length==1&&r[0].id[r[0].id.length-1]==0?u.removeClass("e-chk-indetericon").addClass("e-chk-activeicon"):r.length>0&&u.removeClass("e-chk-activeicon").addClass("e-chk-indetericon");this._dialogOKBtnObj.enable();i.type=="nodeUncheck"&&r.length+1==this._memberTreeObj.element.find("li").length&&(u.removeClass("e-chk-activeicon").removeClass("e-chk-indetericon"),this._dialogOKBtnObj.disable())}},_fetchMemberSuccess:function(n){n[0]!=r&&n.length>0?(this._currentMembers=n[0].Value,n[1]!=null&&n[1]!=r&&(this.model.customObject=n[1].Value)):n.d!=r&&n.d.length>0?(this._currentMembers=n.d[0].Value,n.d[1]!=null&&n.d[1]!=r&&(this.model.customObject=n.d[1].Value)):n!=r&&n.length>0?(this._currentMembers=n.EditorTreeInfo,n!=null&&n!=r&&(this.model.customObject=n.customObject)):n!=r&&(this._currentMembers=n.EditorTreeInfo);this._ogridWaitingPopup.hide();this._createDialog(this._dialogHead,this._currentMembers);this.model.afterServiceInvoke!=null&&this._trigger("afterServiceInvoke",{action:"fetchMembers",element:this.element,customObject:this.model.customObject})},_filterElementSuccess:function(n){n[0]!=r?n[2]!=null&&n[2]!=r&&(this.model.customObject=n[2].Value):n.d!=r?n.d[2]!=null&&n.d[2]!=r&&(this.model.customObject=n.d[2].Value):n.customObject!=null&&n.customObject!=r&&(this.model.customObject=n.customObject);this.model.afterServiceInvoke!=null&&this._trigger("afterServiceInvoke",{action:"filtering",element:this.element,customObject:this.model.customObject});this._renderControlSuccess(n)},_sortingSuccess:function(n){n[0]!=r?n[2]!=r&&n.length>0&&(this.model.customObject=n[2].Value):n.d!=r&&n.d.length>0?n.d[2]!=null&&n.d[2]!=r&&(this.model.customObject=n.d[2].Value):n!=r&&n.length>0&&n.customObject!=null&&n.customObject!=r&&(this.model.customObject=n.customObject);this.model.afterServiceInvoke!=null&&this._trigger("afterServiceInvoke",{action:"sorting",element:this.element,customObject:this.model.customObject});this._renderControlSuccess(n)},_onNodeExpand:function(i){var u=i.event.originalEvent!=r&&i.event.originalEvent.target!=r?i.event.originalEvent.target:i.event.target,e="",v=n(u).parents("li").first().children().find("li").length,c,s,h,o,l,f,a;if(u!=r&&u.className!=r&&u.className!=""&&u.className.indexOf("e-plus")>-1&&v==0){n(u).removeClass("e-plus").addClass("e-load");c=n(u).parent().find("input.e-checkbox").prop("checked");h=n(u).parents("li").first().attr("tag");this.pNode=u;try{s=JSON.parse(this.model.pivotControl!=r?this.model.pivotControl.getOlapReport():this.getOlapReport()).Report}catch(y){s=this.model.pivotControl!=r?this.model.pivotControl.getOlapReport():this.getOlapReport()}for(o=this.element.find(".pivotButton"),f=0;f<o.length>0;f++)n(o[f]).attr("tag").indexOf(t.isNullOrUndefined(this._curFilteredText)?this._schemaData._curFilteredText:this._curFilteredText)>-1&&n(o[f]).attr("tag").split(":")[1].length==(t.isNullOrUndefined(this._curFilteredText)?this._schemaData._curFilteredText.length:this._curFilteredText.length)?e=n(o[f]).attr("tag"):n(o[f]).attr("tag").indexOf(t.isNullOrUndefined(this._curFilteredText)?this._schemaData._curFilteredText:this._curFilteredText)>-1&&(l=n(o[f]).attr("tag"));e=e==""?l:e;e=e.split(":")[1];this.model.beforeServiceInvoke!=null&&this._trigger("beforeServiceInvoke",{action:"memberExpanded",element:this.element,customObject:this.model.customObject});a=JSON.stringify(this.model.customObject);this.doAjaxPost("POST",this.model.url+"/"+this.model.serviceMethodSettings.memberExpand,JSON.stringify({action:"memberExpanded",checkedStatus:c,parentNode:n(u).parents("li")[0].id,tag:h,cubeName:JSON.parse(this._olapReport).CurrentCube+"##"+e,currentReport:s,customObject:a}),this._fetchChildNodeSuccess)}},_fetchChildNodeSuccess:function(i){var u,f,e;i.length>1&&i[0]!=r?(u=JSON.parse(i[0].Value),i[1]!=null&&i[1]!=r&&(this.model.customObject=i[1].Value)):i.d!=r?(u=JSON.parse(i.d[0].Value),i.d[1]!=null&&i.d[1]!=r&&(this.model.customObject=i.d[1].Value)):(u=JSON.parse(i.ChildNodes),i.customObject!=null&&i.customObject!=r&&(this.model.customObject=i.customObject));e={id:"id",parentId:"pid",hasChild:"hasChildren",text:"name",isChecked:"checkedStatus"};f=n(this.pNode).parents("li").length>1?n(this.pNode).parents("li").first():n(this.pNode).parents("li");n(n(f).find("input.nodecheckbox")[0]).ejCheckBox({checked:!1});!t.isNullOrUndefined(this._memberTreeObj)&&this._editorFlag?this._memberTreeObj._createSubNodesWhenLoadOnDemand(u,this.pNode,e):t.isNullOrUndefined(this._schemaData._memberTreeObj)||this._schemaData._memberTreeObj._createSubNodesWhenLoadOnDemand(u,this.pNode,e);n.each(n(f).children().find("li"),function(n,t){t.setAttribute("tag",u[n].tag)});this.model.afterServiceInvoke!=null&&this._trigger("afterServiceInvoke",{action:"memberExpanded",element:this.element,customObject:this.model.customObject});t.isNullOrUndefined(this._schemaData)||this.element.find(".schemaNoClick").removeClass("freeze").removeAttr("style")},_onBeforeNodeExpand:function(i){var u=i.targetElement,c=this.model.dataSource.cube,l=this.model.dataSource.catalog,p=this.model.dataSource.data,a=this._generateChildMembers,v=n(i.currentElement).find("li").length,f=!1,s,h,e;if(v==0){var o=this._selectedElement!=r?this._selectedElement:this._selectedField,y=n(u).parents("li:eq(0)").attr("id"),w=n.map(this._currentReportItems,function(i){i.fieldName!=o||t.isNullOrUndefined(i.filterItems)||n.map(i.filterItems,function(n){n.parentId!=r&&n.parentId==y.replace(/\]*\]/g,"-").replace(/\[*\[/g,"-")&&(f=!0)})});i.isChildLoaded=f?!0:!1;f||(n(u).parents("li:eq(0)").attr("tag")==r&&(s=n.map(this._currentReportItems,function(n){if(n.fieldName==o)return n})[0],n.map(s.filterItems,function(t){t.id==n(u).parents("li:eq(0)").attr("id")&&n(u).parents("li:eq(0)").attr("tag",t.tag)})),h=n(u).parents("li:eq(0)").attr("tag").replace(/\&/g,"&amp;"),this.pNode=i.currentElement,parsedMDX="select {"+h+".children} dimension properties CHILDREN_CARDINALITY on 0 from ["+c+"]",e=this._getConnectionInfo(this.model.dataSource.data),pData='<Envelope xmlns="http://schemas.xmlsoap.org/soap/envelope/"> <Header><\/Header> <Body> <Execute xmlns="urn:schemas-microsoft-com:xml-analysis"> <Command> <Statement> '+parsedMDX+" <\/Statement> <\/Command> <Properties> <PropertyList> <Catalog>"+l+"<\/Catalog><LocaleIdentifier>"+e.LCID+"<\/LocaleIdentifier> <\/PropertyList> <\/Properties> <\/Execute> <\/Body> <\/Envelope>",this.doAjaxPost("POST",e.url,{XMLA:pData},a,null,{action:"nodeExpand"}))}},_updateTreeView:function(t){for(var o,f,e,u,i=0;i<t.element.find(".editorTreeView").find("li").length;i++)for(u=0;u<t._memberTreeObj.dataSource().length;u++)if(t.element.find(".editorTreeView").find("li")[i].id==t._memberTreeObj.dataSource()[u].id&&(n(t.element.find(".editorTreeView").find("li")[i]).find("span:first").attr("aria-checked")=="mixed"||n(t.element.find(".editorTreeView").find("li")[i]).find("span:first").attr("aria-checked")=="true")){t._memberTreeObj.dataSource()[u].checkedStatus=!0;break}else if(t.element.find(".editorTreeView").find("li")[i].id==t._memberTreeObj.dataSource()[u].id&&n(t.element.find(".editorTreeView").find("li")[i]).find("span:first").attr("aria-checked")=="false"){t._memberTreeObj.dataSource()[u].checkedStatus=!1;break}for(i=0;i<t._memberTreeObj.dataSource().length;i++)if(o=!1,t._memberTreeObj.dataSource()[i].checkedStatus==!0){for(u=0;u<t._memberTreeObj.dataSource().length;u++)if(t._memberTreeObj.dataSource()[u].hasOwnProperty("parentId")&&t._memberTreeObj.dataSource()[u].parentId==t._memberTreeObj.dataSource()[i].id&&t._memberTreeObj.dataSource()[u].checkedStatus==!0){o=!0;break}if(!o)for(f=0;f<t._memberTreeObj.dataSource().length;f++)t._memberTreeObj.dataSource()[f].hasOwnProperty("parentId")&&t._memberTreeObj.dataSource()[f].parentId==t._memberTreeObj.dataSource()[i].id&&(t._memberTreeObj.dataSource()[f].checkedStatus=!0)}else if(t._memberTreeObj.dataSource()[i].checkedStatus==!1)for(e=0;e<t._memberTreeObj.dataSource().length;e++)t._memberTreeObj.dataSource()[e].hasOwnProperty("parentId")&&t._memberTreeObj.dataSource()[e].parentId==t._memberTreeObj.dataSource()[i].id&&(t._memberTreeObj.dataSource()[e].checkedStatus=!1);for(i=0;i<t.element.find(".editorTreeView").find("li").length;i++)if(n(t.element.find(".editorTreeView").find("li")[i]).attr("tag")==null||r)for(u=0;u<t._memberTreeObj.dataSource().length;u++)if(n(t.element.find(".editorTreeView").find("li")[i])[0].id==t._memberTreeObj.dataSource()[u].id){n(t.element.find(".editorTreeView").find("li")[i]).attr("tag",t._memberTreeObj.dataSource()[u].tag);break}return t._memberTreeObj},_generateChildMembers:function(t,i){for(var f,e=n(i).find("Axis:eq(0) Tuple"),u=[],r=0;r<e.length;r++){var o=n(n(i).find("Axis:eq(0) Tuple:eq("+r+")").children().children()[0]).text(),s=n(n(i).find("Axis:eq(0) Tuple:eq("+r+")").children()).find("Caption").text(),h={hasChildren:n(e[r]).find("CHILDREN_CARDINALITY").text()!="0",checkedStatus:!1,id:o.replace(/\]*\]/g,"-").replace(/\[*\[/g,"-"),name:s,tag:o};u.push(h)}parentNode=n(this.pivotGridObj.pNode).parents("li").length>1?n(this.pivotGridObj.pNode).parents("li").first():n(this.pivotGridObj.pNode).parents("li");this.pivotGridObj.pNode.find(".e-load").removeClass("e-load");n(n(parentNode).find("input.nodecheckbox")[0]).ejCheckBox({checked:!1});this.pivotGridObj._memberTreeObj=n(".editorTreeView").data("ejTreeView");this.pivotGridObj._memberTreeObj.addNode(u,n(this.pivotGridObj.pNode));this._schemaData!=null&&(this._schemaData._memberTreeObj=this._memberTreeObj);f=this.pivotGridObj._selectedField;this.pivotGridObj._currentReportItems=n.grep(this.pivotGridObj._currentReportItems,function(n){if(n.fieldName!=f)return n});this.pivotGridObj._currentReportItems.push({filterItems:this.pivotGridObj._memberTreeObj.dataSource(),fieldName:f});n.each(this.pivotGridObj.pNode.find("li"),function(n,t){t.setAttribute("tag",u[n].tag)})},_generateMembers:function(i,r){var o=n(r).find("Axis:eq(0) Tuple"),f=[],s={},u,e,h;for(f.push({id:"All",name:"All",checkedStatus:!0,tag:""}),u=0;u<o.length;u++)e=n(n(r).find("Axis:eq(0) Tuple:eq("+u+")").children().children()[0]).text(),h=n(n(r).find("Axis:eq(0) Tuple:eq("+u+")").children().children()[1]).text(),s={hasChildren:n(o[u]).find("CHILDREN_CARDINALITY").text()!="0",checkedStatus:!0,id:e.replace(/\]*\]/g,"-").replace(/\[*\[/g,"-"),name:h,tag:e},f.push(s);t.isNullOrUndefined(this.pivotGridObj)||(this.pivotGridObj._ogridWaitingPopup.hide(),this.pivotGridObj._fetchMemberSuccess({EditorTreeInfo:JSON.stringify(f)}))},_onFilterBtnClick:function(i){var u,f,e,o,r,h,s,c;if(this._editorFlag=!0,this.model.operationalMode==t.PivotGrid.OperationalMode.ClientMode)this._dataModel=="XMLA"?(u=this._selectedField=n(i.currentTarget.parentNode).attr("tag").split(":")[1],this._dialogHead=n(i.currentTarget.parentNode).text(),f=n.map(this._currentReportItems,function(n){if(n.fieldName==u)return n.filterItems}),f.length>0?this._fetchMemberSuccess({EditorTreeInfo:JSON.stringify(f)}):(this._ogridWaitingPopup.show(),parsedMDX="select {"+u+".children} dimension properties CHILDREN_CARDINALITY on 0 from ["+n.trim(this.model.dataSource.cube)+"]",e=this._getConnectionInfo(this.model.dataSource.data),pData='<Envelope xmlns="http://schemas.xmlsoap.org/soap/envelope/"> <Header><\/Header> <Body> <Execute xmlns="urn:schemas-microsoft-com:xml-analysis"> <Command> <Statement> '+parsedMDX+" <\/Statement> <\/Command> <Properties> <PropertyList> <Catalog>"+this.model.dataSource.catalog+"<\/Catalog> <LocaleIdentifier>"+e.LCID+"<\/LocaleIdentifier> <\/PropertyList> <\/Properties> <\/Execute> <\/Body> <\/Envelope>",this.doAjaxPost("POST",e.url,{XMLA:pData},this._generateMembers,null,{action:"fetchMembers"}))):(o=n(i.target).siblings(".pvtBtn").attr("fieldName"),r=n(i.target).siblings(".pvtBtn").text(),this._selectedAxis=n(i.target).siblings(".pvtBtn").attr("axis"),h=this._getTreeViewData(o,r,this._selectedAxis),this._dialogTitle=r,this._dialogHead=r,this._selectedField=o,this._fetchMemberSuccess({EditorTreeInfo:JSON.stringify(h)}));else{this._curFilteredAxis=i.target.parentElement.attributes.tag.value.split(":")[0];this._curFilteredText=this._dataModel=="Olap"?i.target.parentElement.attributes.tag.value:n(n(i.target).siblings()[1]).text();this._dialogTitle=this._dataModel=="Olap"?i.target.parentElement.attributes.tag.value:n(n(i.target).siblings()[1]).text();this._dialogHead=this._dataModel=="Olap"?i.target.parentElement.title:n(n(i.target).siblings()[1]).text();try{s=JSON.parse(this.getOlapReport()).Report}catch(l){s=this.getOlapReport()}this._ogridWaitingPopup.show();t.isNullOrUndefined(this._schemaData)||this._schemaData.element.find(".schemaNoClick").addClass("freeze").width(n(this._schemaData.element).width()).height(n(this._schemaData.element).height()).css({top:n(this._schemaData.element).offset().top,left:n(this._schemaData.element).offset().left});this.model.beforeServiceInvoke!=null&&this._trigger("beforeServiceInvoke",{action:"fetchMembers",element:this.element,customObject:this.model.customObject});c=JSON.stringify(this.model.customObject);eventArgs=JSON.stringify({action:"fetchMembers",headerTag:this._dialogTitle,sortedHeaders:this._ascdes,currentReport:s,customObject:c});this.doAjaxPost("POST",this.model.url+"/"+this.model.serviceMethodSettings.fetchMembers,eventArgs,this._fetchMemberSuccess)}},_getTreeViewData:function(i,u,f){var c=this.model.dataSource[f=="Slicers"?"filters":f.toLowerCase()],s=n.grep(c,function(n){return n.fieldName==i})[0],o=t.PivotAnalysis.getMembers(i),h=[{id:"All",name:"All",checkedStatus:!0}],e;if(s.filterItems!=null&&s.filterItems!=r)for(e=0;e<o.length;e++)h.push({id:o[e],name:o[e],checkedStatus:s.filterItems.filterType==t.PivotAnalysis.FilterType.Include?n.inArray(o[e]!=null?o[e].toString():o[e],s.filterItems.values)>=0:n.inArray(o[e]!=null?o[e].toString():o[e],s.filterItems.values)<0});else for(e=0;e<o.length;e++)h.push({id:o[e],name:o[e],checkedStatus:!0});return h},_applyToolTip:function(t){var f,s,i,e="",u,p,h,v,l,c,o,a,y;if(valueCell="",u=n(t.target).hasClass("cellValue")?t.target.parentElement:t.target,i=n(u).hasClass("summary")?n(u).siblings("th").hasClass("rowheader")?n(u).parent("tr").find(".rowheader").last().attr("p"):n(u).parent("tr").find(".summary").attr("p"):n(u).parent("tr").find(".rowheader").last().attr("p"),i!=null)if(i[0]==0&&parseInt(i.split(",")[0])!=null)i==this.getJSONRecords()[parseInt(parseInt(i.split(",")[0])*this._rowCount+parseInt(i.split(",")[1]))].Index&&(s=this.getJSONRecords()[parseInt(parseInt(i.split(",")[0])*this._rowCount+parseInt(i.split(",")[1]))].Value);else while(i[0]>=0)i==this.getJSONRecords()[parseInt(parseInt(i.split(",")[0])*this._rowCount+parseInt(i.split(",")[1]))].Index&&(f=this.getJSONRecords()[parseInt(parseInt(i.split(",")[0])*this._rowCount+parseInt(i.split(",")[1]))].Value,i=parseInt(i.split(",")[0])-1+","+parseInt(i.split(",")[1])),s=s?f+"-"+s:f;for(p=n(u).closest("tbody").prev().children("tr:last").length!=0?n(u).closest("tbody").prev().children("tr:last").children("th").attr("p")!=r?n(u).closest("tbody").prev().children("tr:last").children("th").attr("p")[2]:-1:-1,h=n(u).attr("p"),h!=r&&h==this.getJSONRecords()[parseInt(parseInt(h.split(",")[0])*this._rowCount+parseInt(h.split(",")[1]))].Index&&(v=parseInt(h.split(",")[0])),l=0;l<=p;l++)c=v+","+l,v!=null&&c==this.getJSONRecords()[parseInt(parseInt(c.split(",")[0])*this._rowCount+parseInt(c.split(",")[1]))].Index&&(f=this.getJSONRecords()[parseInt(parseInt(c.split(",")[0])*this._rowCount+parseInt(c.split(",")[1]))].Value,e==""?e=f:f!=""&&(e=e+"-"+f));n("#"+this._id+"_gridTooltip").remove();o=n(u).position();n("#"+this._id).append('<div id="'+this._id+'_gridTooltip" class="pGridTooltip"><\/div>');n("#"+this._id+"_gridTooltip").append('<p id="value" class="tooltipText">'+this._getLocalizedLabels("ToolTipValue")+": "+(n(u).text()?n(u).text():"No Value")+"<\/p>");n("#"+this._id+"_gridTooltip").append('<p id="row" class="tooltipText">'+this._getLocalizedLabels("ToolTipRow")+": "+(s==r||this._rowCount==1?"No value":s)+"<\/p>");n("#"+this._id+"_gridTooltip").append('<p id="column" class="tooltipText">'+this._getLocalizedLabels("ToolTipColumn")+": "+(e==r||e==""?"No value":e)+"<\/p>");a=0;a=typeof oclientProxy!="undefined"?n("#"+this._id).parent().position().left+oclientProxy.element.find(".gridContainer").width():n("#"+this._id).parent().position().left+n("#"+this._id).parent().width();y=o.left+n("#"+this._id+"_gridTooltip").width();n("#"+this._id+"_gridTooltip").css({left:(o.left>0?o.left:0)+(a-y<0?a-y-20:5),top:n(this.element).height()-o.top<100?o.top-n("#"+this._id+"_gridTooltip").outerHeight()-2:o.top+40});this.model.enableToolTipAnimation?n("#"+this._id+"_gridTooltip").show("fast"):n("#"+this._id+"_gridTooltip").show();this.model.enableRTL?(n("#"+this._id+"_gridTooltip p").addClass("e-rtl"),n("#"+this._id+"_gridTooltip p").css("text-align","right")):(n("#"+this._id+"_gridTooltip p").removeClass("e-rtl"),n("#"+this._id+"_gridTooltip p").css("text-align","left"));typeof oclientProxy!="undefined"&&oclientProxy.controlPlacement()=="tile"&&n("#"+this._id+"_gridTooltip").css("position","absolute")},_applyVScrolling:function(){var s,h=n(this.element).find(".virtualScrollGrid"),i,e,r,o;if(this._seriesPageCount>1){var a=this,u=function(){return Math.round(a.element.find(".vScrollPanel").position().top)+1},c=n(this.element).find(".vScrollPanel");c.height(n(h).height());c.html(t.buildTag("div.vScrollThumb")[0].outerHTML);i=c.find(".vScrollThumb");i.height(Math.max(Math.ceil(n(h).height()/this._seriesPageCount),15));e=c.height()-i.height()-2;i.offset({top:u()+(this._seriesCurrentPage-1)*(e/(this._seriesPageCount-1))});n(".vScrollPanel").bind("mousewheel DOMMouseScroll",function(t){var r=n(this).parents(".e-pivotgrid").data("ejPivotGrid"),f,o;n("body").on("mousewheel DOMMouseScroll",function(n){return n.preventDefault(),n.stopPropagation(),!1});initThumbPos=i.position().top-u();f=r._seriesCurrentPage;movedDistance=t.originalEvent.wheelDelta<0||t.originalEvent.detail>0?t.target.offsetParent.offsetTop+10:-t.target.offsetParent.offsetTop-10;r.element.find(".seriesPageIndicator").removeClass("inActive").css({top:i.position().top,left:i.position().left+20});f=r._seriesCurrentPage;window.navigator.userAgent.indexOf("MSIE ")>-1?n(document).on("selectstart",function(n){n.preventDefault()}):window.getSelection().removeAllRanges();movedDistance>0&&initThumbPos+movedDistance<=e||movedDistance<0&&initThumbPos+movedDistance>=0?o=initThumbPos+movedDistance+u():initThumbPos+movedDistance>e?o=u()+e:initThumbPos+movedDistance<0?o=u():"";i.offset({top:o});f=Math.ceil((i.position().top-u())/(e/r._seriesPageCount))==0?1:Math.ceil((i.position().top-u())/(e/r._seriesPageCount));f>r._seriesPageCount&&(f=r._seriesPageCount);r.element.find(".seriesPageIndicator").css({top:i.position().top});r.element.find(".series_CurrentPage").html(f);f!=r._seriesCurrentPage&&(r._seriesCurrentPage=f,clearTimeout(s),s=setTimeout(function(){r.refreshPagedPivotGrid("series",r._seriesCurrentPage)},250))});n(i).bind("mousedown touchstart",function(t){var r=n(this).parents(".e-pivotgrid").data("ejPivotGrid"),s,f,o;n(this).addClass("dragging");s=t.pageY-u();f=i.position().top-u();r.element.find(".seriesPageIndicator").removeClass("inActive").css({top:i.position().top,left:i.position().left+20});o=r._seriesCurrentPage;n(document).bind("mousemove touchmove",function(t){if(window.navigator.userAgent.indexOf("Trident")>-1)n(document).on("selectstart",function(n){n.preventDefault()});else window.getSelection().removeAllRanges();var h=t.pageY-u()-s;h>0&&f+h<=e?i.offset({top:f+h+u()}):h<0&&f+h>=0?i.offset({top:f+h+u()}):f+h>e?i.offset({top:u()+e}):f+h<0&&i.offset({top:u()});o=Math.floor((Math.round(i.position().top)-u())/(e/r._seriesPageCount))==0?1:Math.floor((Math.round(i.position().top)-u())/(e/r._seriesPageCount));r.element.find(".seriesPageIndicator").css({top:i.position().top});r.element.find(".series_CurrentPage").html(o)});n(document).bind("mouseup touchend",function(){n(document).off("selectstart");n(this).unbind("mousemove touchmove").unbind("mouseup touchend");n(i).removeClass("dragging");o!=r._seriesCurrentPage?(r._seriesCurrentPage=o,r.refreshPagedPivotGrid("series",r._seriesCurrentPage)):r.element.find(".seriesPageIndicator").addClass("inActive")})})}if(this._categPageCount>1){var a=this,f=function(){return Math.round(a.element.find(".hScrollPanel").position().left)+1},l=n(this.element).find(".hScrollPanel");l.width(n(h).width());l.html(t.buildTag("div.hScrollThumb")[0].outerHTML);r=l.find(".hScrollThumb");r.width(Math.max(Math.ceil(n(h).width()/this._categPageCount),15));o=l.width()-r.width()-2;r.offset({left:f()+(this._categCurrentPage-1)*(o/(this._categPageCount-1))});n(".hScrollPanel").bind("mousewheel DOMMouseScroll",function(t){var i=n(this).parents(".e-pivotgrid").data("ejPivotGrid"),u;n("body").on("mousewheel DOMMouseScroll",function(n){return n.preventDefault(),n.stopPropagation(),!1});initThumbPos=r.position().left-f();currentPage=i._categCurrentPage;movedDistance=t.originalEvent.wheelDelta<0||t.originalEvent.detail>0?t.target.offsetParent.offsetLeft+10:-t.target.offsetParent.offsetLeft-10;i.element.find(".categPageIndicator").removeClass("inActive").css({left:r.position().left,top:r.position().top+20});window.navigator.userAgent.indexOf("MSIE ")>-1?n(document).on("selectstart",function(n){n.preventDefault()}):window.getSelection().removeAllRanges();movedDistance>0&&initThumbPos+movedDistance<=o||movedDistance<0&&initThumbPos+movedDistance>=0?u=initThumbPos+movedDistance+f():initThumbPos+movedDistance>o?u=f()+o:initThumbPos+movedDistance<0?u=f():"";r.offset({left:u});currentPage=currentPage=Math.ceil((r.position().left-f())/(o/i._categPageCount))==0?1:Math.ceil((r.position().left-f())/(o/i._categPageCount));i.element.find(".categPageIndicator").css({left:r.position().left});i.element.find(".categ_CurrentPage").html(currentPage);currentPage!=i._categCurrentPage&&(i._categCurrentPage=currentPage,clearTimeout(s),s=setTimeout(function(){i.refreshPagedPivotGrid("categ",i._categCurrentPage)},250))});n(r).bind("mousedown touchstart",function(t){var i=n(this).parents(".e-pivotgrid").data("ejPivotGrid"),s,u,e;n(this).addClass("dragging");s=t.pageX-f();u=r.position().left-f();i.element.find(".categPageIndicator").removeClass("inActive").css({left:r.position().left,top:r.position().top+20});e=i._categCurrentPage;n(document).bind("mousemove touchmove",function(t){if(window.navigator.userAgent.indexOf("Trident")>-1)n(document).on("selectstart",function(n){n.preventDefault()});else window.getSelection().removeAllRanges();var h=t.pageX-f()-s;h>0&&u+h<=o?r.offset({left:u+h+f()}):h<0&&u+h>=0?r.offset({left:u+h+f()}):u+h>o?r.offset({left:f()+o}):u+h<0&&r.offset({left:f()});e=Math.floor((Math.round(r.position().left)-f())/(o/i._categPageCount))==0?1:Math.floor((Math.round(r.position().left)-f())/(o/i._categPageCount));i.element.find(".categPageIndicator").css({left:r.position().left});i.element.find(".categ_CurrentPage").html(e)});n(document).bind("mouseup touchend",function(){n(document).off("selectstart");n(this).unbind("mousemove touchmove").unbind("mouseup touchend");n(r).removeClass("dragging");e!=i._categCurrentPage?(i._categCurrentPage=e,i.refreshPagedPivotGrid("categ",i._categCurrentPage)):i.element.find(".categPageIndicator").addClass("inActive")})})}n("body").off("mousewheel DOMMouseScroll")},_getLocalizedLabels:function(n){return t.PivotGrid.Locale[this.locale()][n]===r?t.PivotGrid.Locale["en-US"][n]:t.PivotGrid.Locale[this.locale()][n]},_drillDown:function(i){var e,o,r,s,u,l,f,v;if(this._dataModel=="XMLA"){this._ogridWaitingPopup=this.element.data("ejWaitingPopup");this._ogridWaitingPopup.show();var h=n(i.target).parent().attr("p"),c=this.getJSONRecords()[parseInt(parseInt(h.split(",")[0])*this._rowCount+parseInt(h.split(",")[1]))].Info,a="";return c=c.replace(/&/g,"&amp;"),a=n(i.target).parent().hasClass("rowheader")?"rowheader":"colheader",n(i.target).hasClass("collapse")?this.updateDrilledReport({uniqueName:c,index:h,action:"collapse"},i,this):this.updateDrilledReport({uniqueName:c,index:h},i,this),!1}if(this.element.find(".e-dialog").remove(),!this.model.enableDeferUpdate){this._dataModel!="Pivot"&&this._off(this.element,"click",".expand, .collapse");this._dataModel=="Pivot"&&this.element.find(".colheader, .rowheader, .value").removeClass("e-droppable");e=i.target.className;this._startDrilldown=!0;e=e.split(" ");e[0]=="expand"?this._drillAction="drilldown":e[0]=="collapse"&&(this._drillAction="drillup");this.model.beforeServiceInvoke!=null&&this._trigger("beforeServiceInvoke",{action:"drillDown",element:this.element,customObject:this.model.customObject});o=JSON.stringify(this.model.customObject);r=n(i.target).parent().attr("p");this._drillCaption=n.trim(n(i.target).parent().text());typeof oclientWaitingPopup!="undefined"&&oclientWaitingPopup!=null?n("#"+oclientProxy._id+"_maxView")[0]?(n("#"+oclientProxy._id+"_maxView").ejWaitingPopup({showOnInit:!0}),this._maxViewLoading=n("#"+oclientProxy._id+"_maxView").data("ejWaitingPopup")):oclientWaitingPopup.show():(this._ogridWaitingPopup=this.element.data("ejWaitingPopup"),this._ogridWaitingPopup.show());s=this.model.analysisMode=="relational"?this._drillHeaders.join("||"):this.getJSONRecords()[parseInt(parseInt(r.split(",")[0])*this._rowCount+parseInt(r.split(",")[1]))].Info;try{u=JSON.parse(this.getOlapReport()).Report}catch(y){u=this.getOlapReport()}this._dataModel=="Pivot"?(l=n(this.element).find("table").detach(),f=this._getFieldName(n(i.target).parent()[0]),n(i.target).hasClass("collapse")?(t.isNullOrUndefined(this.model.collapsedMembers)&&(this.model.collapsedMembers={}),t.isNullOrUndefined(this.model.collapsedMembers[f])?this.model.collapsedMembers[f]=[n(i.target).parent()[0].textContent]:this.model.collapsedMembers[f].push(n(i.target).parent()[0].textContent)):n(i.target).hasClass("expand")&&(this.model.collapsedMembers[f]=n.grep(this.model.collapsedMembers[f],function(t){return t!=n(i.target).parent()[0].textContent})),this._collapseMember(l,i.target),this.element.append(l),this._hideGrandTotal(),this.model.enableGroupingBar&&(tableWidth=n("#"+this._id).find(".pivotGridTable").width(),this.element.find(".groupingBarPivot .drag").width(tableWidth-5),cellWidth=n("#"+this._id).find(".pivotGridTable").find("th").width(),this.element.find(".groupingBarPivot .values").width(cellWidth-2),this.element.find(".groupingBarPivot .columns").width(tableWidth-cellWidth),this.element.find(".groupingBarPivot .valueColumn").width(tableWidth)),this._dataModel=="Pivot"&&this.element.find(".colheader, .rowheader, .value").addClass("e-droppable"),this._ogridWaitingPopup.hide(),v=i,this._trigger("renderSuccess",this),this.model.enableGroupingBar&&this._createFields("drilldown",n("#"+this._id).find(".pivotGridTable").width(),n("#"+this._id).find(".pivotGridTable th").outerWidth())):this.layout()!=""||this.layout()!="normal"?typeof oclientProxy!="undefined"?this.doAjaxPost("POST",this.model.url+"/"+this.model.serviceMethodSettings.drillDown,JSON.stringify({action:"drillDownGrid",cellPosition:r,currentReport:u,clientReports:oclientProxy.reports,headerInfo:s,layout:this.layout(),customObject:o}),this._drillDownSuccess):this.doAjaxPost("POST",this.model.url+"/"+this.model.serviceMethodSettings.drillDown,JSON.stringify({action:"drillDownGrid",cellPosition:r,currentReport:u,headerInfo:s,layout:this.layout(),customObject:o}),this._drillDownSuccess):typeof oclientProxy!="undefined"?this.doAjaxPost("POST",this.model.url+"/"+this.model.serviceMethodSettings.drillDown,JSON.stringify({action:"drillDownGrid",cellPosition:r,currentReport:u,clientReports:oclientProxy.reports,headerInfo:s,customObject:o}),this._drillDownSuccess):this.doAjaxPost("POST",this.model.url+"/"+this.model.serviceMethodSettings.drillDown,JSON.stringify({action:"drillDownGrid",cellPosition:r,currentReport:u,headerInfo:s,customObject:o}),this._drillDownSuccess)}},_collapseMember:function(t,i){var e=n(i).parent()[0],v=n(e).attr("p"),d=n(i).attr("tag")!=r?parseInt(n(i).attr("tag"))+e.rowSpan:e.rowSpan,b=n(i).attr("tag")!=r?parseInt(n(i).attr("tag"))+e.colSpan:e.colSpan,h=n(i).closest("tr")[0],ut=null,ft=null,g="false",et=0,nt,k,a,ot,s,tt,f,p,st,it,l,c,w,y,rt,o,u;if(e.className.indexOf("rowheader")>=0||e.className.indexOf("summary")>=0&&n(e).attr("role")=="rowheader")if(nt=!n(e).index()>0,n(i).attr("class").indexOf("collapse")>-1){for(f=0;f<d;f++){if(ut=n(h).next(),nt)n(h).css("display","none"),n(h).attr("tag",n(h).attr("tag")!=r?parseInt(n(h).attr("tag"))+1:1);else{for(a=e,y=0;y<=n(e).nextAll().length;y++)n(a).css("display","none").attr("hc",n(a).attr("hc")==r?1:parseInt(n(a).attr("hc"))+1),a=n(a).next();g="true"}h=ut;nt=!0}for(k=g=="true"?e.rowSpan-1:e.rowSpan,n(h).find("th").text(n(h).find("th").text().replace(" Total","")).prepend('<span class="expand e-icon" tag="'+d+":"+g+'">&nbsp;<\/span>'),s=n(h).prevAll().find("th:has(span):not(.summary)"),f=0;f<s.length;f++)parseInt(n(s[f]).attr("p").split(",")[0])<parseInt(v.split(",")[0])&&parseInt(n(s[f]).attr("p").split(",")[1])+s[f].rowSpan+(n(s[f]).find("span").attr("tag")!=r?parseInt(n(s[f]).find("span").attr("tag")):0)>=parseInt(v.split(",")[1])+d&&(s[f].rowSpan-=k,n(s[f]).find("span").attr("tag",n(s[f]).find("span").attr("tag")!=r?parseInt(n(s[f]).find("span").attr("tag"))+k:k))}else if(n(i).attr("class").indexOf("expand")>-1){for(f=parseInt(n(i).attr("tag").split(":")[0]);f>=0;f--)ft=n(h).prev(),n(h).attr("tag")==r||parseInt(n(h).attr("tag"))<=1?n(h).css("display","table-row"):et++,n(h).attr("tag")!=r&&(parseInt(n(h).attr("tag")-1)==0?n(h).removeAttr("tag"):n(h).attr("tag",parseInt(n(h).attr("tag"))-1)),h=ft;if(n(i).attr("tag").split(":")[1]=="true")for(a=n(t).find("th[p='"+parseInt(n(e).attr("p").split(",")[0])+","+(parseInt(n(e).attr("p").split(",")[1])-parseInt(n(i).attr("tag").split(":")[0]))+"']"),ot=n(a).nextAll().length,y=0;y<=ot;y++)n(a).attr("hc")==r||parseInt(n(a).attr("hc"))<=1?(n(a).removeAttr("hc"),n(a).attr("ch")==r&&n(a).css("display","")):n(a).attr("hc",parseInt(n(a).attr("hc"))-1),a=n(a).next();for(s=n(n(i).closest("tr")[0]).prevAll().find("th:has(span):not(.summary)"),tt=(n(i).attr("tag").split(":")[1]=="true"?parseInt(n(i).attr("tag").split(":")[0])-1:parseInt(n(i).attr("tag").split(":")[0]))-et,f=0;f<s.length;f++)parseInt(n(s[f]).attr("p").split(",")[0])<parseInt(v.split(",")[0])&&parseInt(n(s[f]).attr("p").split(",")[1])+s[f].rowSpan+(n(s[f]).find("span").attr("tag")!=r?parseInt(n(s[f]).find("span").attr("tag")):0)>=parseInt(v.split(",")[1])&&(s[f].rowSpan+=tt,n(s[f]).find("span").attr("tag")!=r&&n(s[f]).find("span").attr("tag",parseInt(n(s[f]).find("span").attr("tag"))-tt),parseInt(n(s[f]).find("span").attr("tag"))==0&&n(s[f]).find("span").removeAttr("tag"));n(e).text(n.trim(n(e).text())+" Total");n(e).prepend("<span style='margin-left:10px'><\/span>")}if(e.className.indexOf("colheader")>=0||e.className.indexOf("summary")>=0&&n(e).attr("role")=="columnheader")if(p=parseInt(v.split(",")[0]),st=n(t).find("tr"),n(i).attr("class").indexOf("collapse")>-1){for(u=0;u<b;u++){for(l=n(h).nextAll().find("th[p^='"+(u+p)+",']"),c=0;c<n(l).length;c++)n(l[c]).attr("hc",n(l[c]).attr("hc")!=r?parseInt(n(l[c]).attr("hc"))+1:1).css("display","none");(n(l[c]).attr("hc")==r||parseInt(n(l[c]).attr("hc"))<1)&&(n(t).find("td[p^='"+(u+p)+",']").css("display","none"),n(t).find("th[p^='0,']:not(.summary)").parent().find("td[p^='"+(u+p)+",']").attr("ch",1))}for(n(e).attr("hc",1).css("display","none"),n(e).next().text(n(e).text().replace(" Total","")).prepend('<span class="expand e-icon" tag="'+b+'">&nbsp;<\/span>'),o=n(h).prevAll().find("th:has(span):not(.summary)"),u=0;u<o.length;u++)parseInt(n(o[u]).attr("p").split(",")[1])<parseInt(v.split(",")[1])&&parseInt(n(o[u]).attr("p").split(",")[0])<=parseInt(v.split(",")[0])&&parseInt(n(o[u]).attr("p").split(",")[0])+o[u].colSpan+(n(o[u]).find("span").attr("tag")!=r?parseInt(n(o[u]).find("span").attr("tag")):0)>=parseInt(v.split(",")[0])+b&&(o[u].colSpan-=e.colSpan,n(o[u]).find("span").attr("tag",n(o[u]).find("span").attr("tag")!=r?parseInt(n(o[u]).find("span").attr("tag"))+e.colSpan:e.colSpan))}else if(n(i).attr("class").indexOf("expand")>-1){for(it=0,u=1;u<b;u++){for(l=n(h).nextAll().find("th[p^='"+(p-u)+",']"),c=0;c<n(l).length;c++)n(l[c]).attr("hc")==r||parseInt(n(l[c]).attr("hc"))==1?(n(l[c]).css("display",""),n(l[c]).removeAttr("hc")):parseInt(n(l[c]).attr("hc"))-1==0?n(l[c]).removeAttr("hc"):n(l[c]).attr("hc",parseInt(n(l[c]).attr("hc"))-1);if(n(l).last().attr("hc")==r)for(n(t).find("td[p^='"+(p-u)+",']").css("display",""),w=n(t).find("th[p^='0,']:not(.summary)").parent().find("td[p^='"+(p-u)+",']"),n(w).removeAttr("ch"),y=0;y<=n(w).length;y++)n(w[y]).attr("hc")!=r&&n(w[y]).css("display","none");else it++}for(n(e).prev().removeAttr("hc").css("display",""),rt=parseInt(n(i).attr("tag"))-it,o=n(h).prevAll().find("th:has(span):not(.summary)"),u=0;u<o.length;u++)parseInt(n(o[u]).attr("p").split(",")[1])<parseInt(v.split(",")[1])&&parseInt(n(o[u]).attr("p").split(",")[0])<parseInt(v.split(",")[0])&&parseInt(n(o[u]).attr("p").split(",")[0])+o[u].colSpan+(n(o[u]).find("span").attr("tag")!=r?parseInt(n(o[u]).find("span").attr("tag")):0)>=parseInt(v.split(",")[0])&&(o[u].colSpan+=rt,n(o[u]).find("span").attr("tag")!=r&&n(o[u]).find("span").attr("tag",parseInt(n(o[u]).find("span").attr("tag"))-rt),parseInt(n(o[u]).find("span").attr("tag"))==0&&n(o[u]).find("span").removeAttr("tag"));n(e).text(n.trim(n(e).text())+" Total");n(e).prepend("<span style='margin-left:10px'><\/span>")}},_drillThroughCellClick:function(t){var e,r=n(t.currentTarget.parentElement).attr("p"),a=n("#"+this._id).find("tbody").find('[p="'+parseInt(r.split(",")[0])+","+parseInt(r.split(",")[1])+'"]').closest("tbody").find("tr:first").find("th").length,o,u,c,s,f,h,l;for(i=0;i<a;i++)o=i+","+parseInt(r.split(",")[1]),u=this.getJSONRecords()[parseInt(parseInt(o.split(",")[0])*this._rowCount+parseInt(o.split(",")[1]))].Info.split("::")[0],u.indexOf("Measures")!=-1&&(e=u),this._rowHeader[i]=u;for(c=n("#"+this._id).find("tbody").find('[p="'+parseInt(r.split(",")[0])+","+parseInt(r.split(",")[1])+'"]').closest("tbody").prev().children("tr").length,i=0;i<c;i++)s=parseInt(r.split(",")[0])+","+i,f=this.getJSONRecords()[parseInt(parseInt(s.split(",")[0])*this._rowCount+parseInt(s.split(",")[1]))].Info.split("::")[0],f.indexOf("Measures")!=-1&&(e=f),this._colHeader[i]=f;for(j=0;j<n(this._fieldData)[0].measures.length;j++)e==n(this._fieldData)[0].measures[j].id&&(this.measureGrp=n(this._fieldData)[0].measures[j].pid);h=this._getConnectionInfo(this.model.dataSource.data);l='<Envelope xmlns="http://schemas.xmlsoap.org/soap/envelope/"><Header/><Body><Discover xmlns="urn:schemas-microsoft-com:xml-analysis"><RequestType>MDSCHEMA_MEASUREGROUP_DIMENSIONS<\/RequestType><Restrictions><RestrictionList><CATALOG_NAME>'+this.model.dataSource.catalog+"<\/CATALOG_NAME><CUBE_NAME>"+this.model.dataSource.cube+"<\/CUBE_NAME><MEASUREGROUP_NAME>"+this.measureGrp+"<\/MEASUREGROUP_NAME><\/RestrictionList><\/Restrictions><Properties><PropertyList><Catalog>"+this.model.dataSource.catalog+"<\/Catalog> <LocaleIdentifier>"+h.LCID+"<\/LocaleIdentifier><\/PropertyList><\/Properties><\/Discover><\/Body><\/Envelope>";this.doAjaxPost("POST",h.url,{XMLA:l},this._loadDimensionElements,null,{pvtGridObj:this,action:"loadMeasureElements"})},_generateTreeViewData:function(){var n={catalog:this.model.dataSource.catalog,cube:this.model.dataSource.cube,url:this.model.dataSource.data,request:"MDSCHEMA_DIMENSIONS"};this._getTreeData(n,this._loadDimensionElements,{pvtGridObj:this,action:"loadFieldElements"})},_dimensionsDetails:function(t,i){t.pvtGridObj._dimension=n(i).find("row")},_loadDimensionElements:function(t,i){var y,s,h,c,u,f,e;t.pvtGridObj._ogridWaitingPopup.show();var o,l={},a={},v=t.pvtGridObj._getConnectionInfo(t.pvtGridObj.model.dataSource.data);for(t.pvtGridObj.schemaTreeView=[],t.pvtGridObj.reportItemNames=[],y='<Envelope xmlns="http://schemas.xmlsoap.org/soap/envelope/"><Header/><Body><Discover xmlns="urn:schemas-microsoft-com:xml-analysis"><RequestType>MDSCHEMA_DIMENSIONS<\/RequestType><Restrictions><RestrictionList><CATALOG_NAME>'+t.pvtGridObj.model.dataSource.catalog+"<\/CATALOG_NAME><CUBE_NAME>"+t.pvtGridObj.model.dataSource.cube+"<\/CUBE_NAME><\/RestrictionList><\/Restrictions><Properties><PropertyList><Catalog>"+t.pvtGridObj.model.dataSource.catalog+"<\/Catalog> <LocaleIdentifier>"+v.LCID+"<\/LocaleIdentifier><\/PropertyList><\/Properties><\/Discover><\/Body><\/Envelope>",t.pvtGridObj.doAjaxPost("POST",v.url,{XMLA:y},t.pvtGridObj._dimensionsDetails,null,{pvtGridObj:t.pvtGridObj,action:"loadFieldElements"}),s=t.pvtGridObj._dimension,h=0;h<n(i).find("row").length;h++){if(c=n(n(i).find("row")[h]),u=c.find("DIMENSION_UNIQUE_NAME").text(),t.pvtGridObj.model.enableDrillThrough)for(f=0;f<s.length;f++)u==n(s[f]).find("DIMENSION_UNIQUE_NAME").text()&&(o=n(s[f]).find("DIMENSION_CAPTION").text());else o=c.find("DIMENSION_CAPTION").text();u.toLowerCase()=="[measures]"?a={hasChildren:!0,isSelected:!1,id:u,name:o,spriteCssClass:u.toLowerCase()=="[measures]"?"folderCDB e-icon":"dimensionCDB e-icon",tag:u}:!n(n(i).find("row")[0]).find("HIERARCHY_CAPTION").length>0&&(l={hasChildren:!0,isSelected:!1,id:u,name:o,spriteCssClass:"dimensionCDB e-icon",tag:u},t.pvtGridObj.schemaTreeView.push(l))}t.pvtGridObj.schemaTreeView.splice(0,0,a);e={catalog:t.pvtGridObj.model.dataSource.catalog,cube:t.pvtGridObj.model.dataSource.cube,url:t.pvtGridObj.model.dataSource.data,request:"MDSCHEMA_DIMENSIONS"};!t.pvtGridObj.model.enableDrillThrough||t.pvtGridObj._schemaData!=r&&t.pvtGridObj._schemaData.model.olap.showNamedSets?(e.request="MDSCHEMA_SETS",t.pvtGridObj._getTreeData(e,t.pvtGridObj._loadNamedSetElements,t)):(e.request="MDSCHEMA_HIERARCHIES",t.pvtGridObj._fieldData.hierarchySuccess==r?t.pvtGridObj._getTreeData(e,t.pvtGridObj._loadHierarchyElements,t):t.pvtGridObj._loadHierarchyElements(t,t.pvtGridObj._fieldData.hierarchySuccess))},_loadNamedSetElements:function(t,i){var f,u;t.pvtGridObj._ogridWaitingPopup.show();var s={catalog:t.pvtGridObj.model.dataSource.catalog,cube:t.pvtGridObj.model.dataSource.cube,url:t.pvtGridObj.model.dataSource.data,request:"MDSCHEMA_DIMENSIONS"},e=t.pvtGridObj.model.dataSource,o=n.map(e.rows,function(n){if(n.fieldName!=r)return n.fieldName});for(n.merge(o,n.map(e.columns,function(n){if(n.fieldName!=r)return n.fieldName})),n.merge(o,n.map(e.filters,function(n){if(n.fieldName!=r)return n.fieldName})),measureGroupItems=[],f=0;f<n(i).find("row").length;f++)u=n(n(i).find("row")[f]),n.inArray(u.find("DIMENSIONS").text().split(".")[0],measureGroupItems)>=0||(treeNodeElement={hasChildren:!0,isSelected:!1,pid:u.find("DIMENSIONS").text().split(".")[0],id:u.find("SET_DISPLAY_FOLDER").text()+"_"+u.find("DIMENSIONS").text().split(".")[0],name:u.find("SET_DISPLAY_FOLDER").text(),spriteCssClass:"folderCDB e-icon namedSets"},t.pvtGridObj.schemaTreeView.push(treeNodeElement),measureGroupItems.push(u.find("DIMENSIONS").text().split(".")[0])),treeNodeElement={hasChildren:!0,isSelected:n.inArray("["+n.trim(u.children("SET_NAME").text())+"]",o)>=0,pid:u.find("SET_DISPLAY_FOLDER").text()+"_"+u.find("DIMENSIONS").text().split(".")[0],id:"["+n.trim(u.children("SET_NAME").text()).replace(/\&/g,"&amp;")+"]",name:u.children("SET_CAPTION").text(),spriteCssClass:"namedSetCDB e-icon",tag:u.find("EXPRESSION").text()},t.pvtGridObj.schemaTreeView.push(treeNodeElement);s.request="MDSCHEMA_HIERARCHIES";t.pvtGridObj._fieldData.hierarchySuccess==r?t.pvtGridObj._getTreeData(s,t.pvtGridObj._loadHierarchyElements,t):t.pvtGridObj._loadHierarchyElements(t,t.pvtGridObj._fieldData.hierarchySuccess)},_loadHierarchyElements:function(t,i){var h,a,f;t.pvtGridObj._ogridWaitingPopup.show();var l={catalog:t.pvtGridObj.model.dataSource.catalog,cube:t.pvtGridObj.model.dataSource.cube,url:t.pvtGridObj.model.dataSource.data,request:"MDSCHEMA_DIMENSIONS"},o=t.pvtGridObj.model.dataSource,s=n.map(o.rows,function(n){if(n.fieldName!=r)return n.fieldName});for(n.merge(s,n.map(o.columns,function(n){if(n.fieldName!=r)return n.fieldName})),n.merge(s,n.map(o.filters,function(n){if(n.fieldName!=r)return n.fieldName})),h={},a="",f=0;f<n(i).find("row").length;f++){var u=n(n(i).find("row")[f]),c=u.find("DIMENSION_UNIQUE_NAME").text(),e=u.find("HIERARCHY_UNIQUE_NAME").text(),v=n.Enumerable.From(t.pvtGridObj.schemaTreeView).Where(function(n){return n.tag==c}).Select(function(n){return n}).ToArray();v.length>0&&c!=e&&(h={hasChildren:!0,isSelected:n.inArray(e,s)>=0,pid:c,id:e,name:u.find("HIERARCHY_CAPTION").text(),spriteCssClass:u.find("HIERARCHY_ORIGIN").text()!="2"&&u.find("HIERARCHY_ORIGIN").text()!="6"?"hierarchyCDB e-icon":"attributeCDB e-icon",tag:e},t.pvtGridObj.schemaTreeView.push(h))}l.request="MDSCHEMA_LEVELS";t.pvtGridObj._getTreeData(l,t.pvtGridObj._loadLevelElements,t)},_loadLevelElements:function(t,i){var r,i;t.pvtGridObj._ogridWaitingPopup.show();r=n.map(n(i).find("row"),function(t){if(parseInt(n(t).children("LEVEL_TYPE").text())!="1"&&n(t).children("HIERARCHY_UNIQUE_NAME").text().toLowerCase()!="[measures]")return treeNodeElement={hasChildren:!1,isChecked:!1,id:n(t).find("LEVEL_UNIQUE_NAME").text(),pid:n(t).find("HIERARCHY_UNIQUE_NAME").text(),name:n(t).find("LEVEL_CAPTION").text(),spriteCssClass:"level"+parseInt(n(t).children("LEVEL_NUMBER").text())+" e-icon",tag:n(t).find("LEVEL_UNIQUE_NAME").text()}});n.merge(t.pvtGridObj.schemaTreeView,r);!t.pvtGridObj.model.enableDrillThrough||t.pvtGridObj._fieldData.measureSuccess?t.pvtGridObj._fieldData.measureSuccess?t.pvtGridObj._loadMeasureElements(t,t.pvtGridObj._fieldData.measureSuccess):(i={catalog:t.pvtGridObj.model.dataSource.catalog,cube:t.pvtGridObj.model.dataSource.cube,url:t.pvtGridObj.model.dataSource.data,request:"MDSCHEMA_MEASURES"},t.pvtGridObj._getTreeData(i,t.pvtGridObj._loadMeasureElements,t)):t.pvtGridObj._createDrillThroughDialog(t.pvtGridObj,t.pvtGridObj.schemaTreeView)},_loadMeasureGroups:function(t){customArgs.pvtGridObj._fieldData.measuresGroups=n(t).find("row")},_loadMeasureElements:function(t,i){var e={catalog:t.pvtGridObj.model.dataSource.catalog,cube:t.pvtGridObj.model.dataSource.cube,url:t.pvtGridObj.model.dataSource.data,request:"MDSCHEMA_DIMENSIONS"},a=t.pvtGridObj.model.dataSource,v=n.map(a.values,function(n){if(n.measures!=r)return n.measures}),s,y,h,o,l;for(this.reportItemNames=n.map(v,function(n){if(n.fieldName!=r)return n.fieldName}),s=[],y="",t.pvtGridObj.model.locale!="en-US"&&(e={catalog:t.pvtGridObj.model.dataSource.catalog,cube:t.pvtGridObj.model.dataSource.cube,url:t.pvtGridObj.model.dataSource.data,request:"MDSCHEMA_MEASUREGROUPS"},t.pvtGridObj._getTreeData(e,this._loadMeasureGroups,{action:"loadFieldElements"})),o=0;o<n(i).find("row").length;o++){var c=n(n(i).find("row")[o]),u=c.children("MEASUREGROUP_NAME").text(),f=c.find("MEASURE_UNIQUE_NAME").text();n.inArray(u,s)>=0||(t.pvtGridObj.model.locale!="en-US"?(l=n.map(t.pvtGridObj._fieldData.measuresGroups,function(t){if(n(t).children("MEASUREGROUP_NAME").text()==u)return n(t).children("MEASUREGROUP_CAPTION").text()}),h=l.length>0?l[0]:u):h=u,treeNodeElement={hasChildren:!0,isChecked:!1,pid:"[Measures]",id:u,name:h,spriteCssClass:"measureGroupCDB e-icon",tag:u},t.pvtGridObj.schemaTreeView.push(treeNodeElement),s.push(u));treeNodeElement={hasChildren:!0,isSelected:n.inArray(f,t.pvtGridObj.reportItemNames)>=0,id:f,pid:u,name:c.children("MEASURE_CAPTION").text(),tag:f};t.pvtGridObj.schemaTreeView.push(treeNodeElement);n.inArray(f,t.pvtGridObj.reportItemNames)>=0&&t.pvtGridObj.reportItemNames.splice(t.pvtGridObj.reportItemNames.indexOf(f),1)}t.pvtGridObj._schemaData.model.olap.showKpi?(treeNodeElement={hasChildren:!0,isChecked:!1,id:"folderStruct",name:"KPI",spriteCssClass:"KPICDB folderCDB e-icon",tag:""},t.pvtGridObj.schemaTreeView.splice(1,0,treeNodeElement),e.request="MDSCHEMA_KPIS",t.pvtGridObj._getTreeData(e,this._loadKPIElements,t)):t.pvtGridObj._schemaData._createTreeView(this,t.pvtGridObj.schemaTreeView)},_loadKPIElements:function(t,i){for(var a=t.pvtGridObj.model.dataSource,f=this.reportItemNames,l=[],e=0;e<n(i).find("row").length;e++){var u=n(n(i).find("row")[e]),r=u.children("KPI_CAPTION").text(),o=u.children("KPI_goal").text(),s=u.children("KPI_STATUS").text(),h=u.children("KPI_TREND").text(),c=u.find("KPI_VALUE").text();n.inArray(u.children("KPI_NAME").text(),l)>=0||(treeNodeElement={hasChildren:!0,isChecked:!1,pid:"folderStruct",id:r,name:r,spriteCssClass:"measureGroupCDB e-icon",tag:r},t.pvtGridObj.schemaTreeView.push(treeNodeElement),l.push(r));treeNodeElement={hasChildren:!0,isSelected:n.inArray(o,f)>=0,id:o,pid:r,name:t.pvtGridObj._getLocalizedLabels("Goal"),spriteCssClass:"kpi",tag:o};t.pvtGridObj.schemaTreeView.push(treeNodeElement);treeNodeElement={hasChildren:!0,isSelected:n.inArray(s,f)>=0,id:s,pid:r,name:t.pvtGridObj._getLocalizedLabels("Status"),spriteCssClass:"kpi",tag:s};t.pvtGridObj.schemaTreeView.push(treeNodeElement);treeNodeElement={hasChildren:!0,isSelected:n.inArray(h,f)>=0,id:h,pid:r,name:t.pvtGridObj._getLocalizedLabels("Trend"),spriteCssClass:"kpi",tag:h};t.pvtGridObj.schemaTreeView.push(treeNodeElement);treeNodeElement={hasChildren:!0,isSelected:n.inArray(c,f)>=0,id:c,pid:r,name:t.pvtGridObj._getLocalizedLabels("Value"),spriteCssClass:"kpi",tag:c};t.pvtGridObj.schemaTreeView.push(treeNodeElement)}t.pvtGridObj._schemaData._createTreeView(this,t.pvtGridObj.schemaTreeView);delete t.pvtGridObj.reportItemNames;delete t.pvtGridObj.schemaTreeView},_createDrillThroughDialog:function(i,r){var e,u,o,f;r.shift();this.element.find(".e-dialog, .clientDialog").remove();var s=t.buildTag("label#",this._getLocalizedLabels("SelectHierarchy"))[0].outerHTML,h="<div class=cubeTable style='width:250px; overflow:auto'><div valign=\"bottom\">"+this._createHierarchyBrowser()+"<\/div><\/div>",c=t.buildTag("div#dropDlg.dropDlg",'<table class="outerTable"><tr><td>'+h+"<\/td><td>"+s+"<br><textarea id='hrSel' style='width:300px; height:300px; resize:none; margin:0px 5px 0 5px'><\/textarea><\/br><br><\/td><\/tr><\/table>")[0].outerHTML+"<\/br>",l=t.buildTag("div",t.buildTag("button#btnOK.dialogBtnOK",this._getLocalizedLabels("OK"))[0].outerHTML+t.buildTag("button#btnCancel.dialogBtnCancel",this._getLocalizedLabels("Cancel"))[0].outerHTML,{float:"right",margin:"-5px 0 6px"})[0].outerHTML,a=t.buildTag("div#clientDialog.clientDialog",c+l,{opacity:"1"}).attr("title","Hierarchy Selector")[0].outerHTML;for(n(a).appendTo("#"+this._id),n("#"+this._id+"_btnOK,#"+this._id+"_btnCancel").ejButton(),n("#"+this._id+"_btnOK,#"+this._id+"_btnCancel").css({margin:"0 0 0 10px",width:"30px"}),this.element.find(".clientDialog").ejDialog({width:600,target:"#"+this._id,enableResize:!1,close:this._onPreventPanelClose}),this.element.find(".cubeTreeViewHierarchy").ejTreeView({showCheckbox:!0,fields:{id:"id",parentId:"pid",text:"name",isChecked:"isSelected",spriteCssClass:"spriteCssClass",dataSource:r},allowDragAndDrop:!0,allowDropChild:!1,allowDropSibling:!1,enableRTL:this.model.enableRTL?!0:!1,dragAndDropAcrossControl:!0,nodeDropped:t.proxy(this._hierarchyNodeDropped,this)}),this._tableTreeObj=this.element.find(".cubeTreeViewHierarchy").data("ejTreeView"),this._tableTreeObj.element.find(".e-ul").css({width:"100%",height:"100%"}),this._tableTreeObj.element.find(".e-chkbox-wrap").remove(),e=this._tableTreeObj.element.find("li"),u=0;u<e.length;u++)o=r[u].tag,e[u].setAttribute("tag",o);this._tableTreeObj&&this._tableTreeObj.element.find("li").mouseover(t.proxy(function(t){n(t.target).parent().find(".measureGroupCDB, .dimensionCDB, .folderCDB").length>0&&n(t.target).css("cursor","default")},this));f=this;n("#btnOK").click(function(){var t=n("#hrSel").val();n(".e-dialog, .clientDialog, .drilltableDialog").remove();f._ogridWaitingPopup.show();f._createDrillThroughQuery(t);f._ogridWaitingPopup.hide()});n("#btnCancel").click(function(){n(".e-dialog, .clientDialog").remove();f._ogridWaitingPopup.hide()});this.model.enableRTL&&(n(".e-dialog").addClass("e-rtl"),n(".dialogBtnCancel").css("margin","0 -70px 0 0"))},_createHierarchyBrowser:function(){return t.buildTag("div.cdbHrHeader",t.buildTag("span",this._getLocalizedLabels("CubeDimensionBrowser"),{"padding-left":"5px","font-weight":"700"})[0].outerHTML,{width:"200px",height:"30px"})[0].outerHTML+t.buildTag("div.cubeBrowserHierarchy",t.buildTag("div.cubeTreeViewHierarchy")[0].outerHTML,{width:"200px",height:"300px",overflow:"auto"})[0].outerHTML},_hierarchyNodeDropped:function(t){var i,u,r;if(t.dropTarget.context.id=="hrSel"){for(i=t.droppedElementData.id,i=i.replace("[","[$"),u=0;u<n("#hrSel").val().split(",").length;u++)if(i==n("#hrSel").val().split(",")[u])return!1;r=this.element.find("#hrSel").val();r.length!=0?(r=r+","+i,this.element.find("#hrSel").val(r)):this.element.find("#hrSel").val(i)}},_createDrillThroughQuery:function(t){for(var r,h,e="",o="",s=this.measureGrp,u="",i="DRILLTHROUGH Select(",f=0;f<this._colHeader.length;f++)o+=o==""?this._colHeader[f]:","+this._colHeader[f];for(r=0;r<this._rowHeader.length;r++)e+=e==""?this._rowHeader[r]:","+this._rowHeader[r];i+=o+","+e+") on 0 from ["+this.model.dataSource.cube+"] RETURN";this._rowHeader=[];this._colHeader=[];n.map(n(this._fieldData)[0].measures,function(n){n.pid==s&&(u+=u==""?"["+s+"]."+n.id.split(".")[1]:",["+s+"]."+n.id.split(".")[1])});i+=t!=""?" "+u+","+t:" "+u;i=i.replace(/&/g,"&amp;");h=this._getConnectionInfo(this.model.dataSource.data);pData='<Envelope xmlns="http://schemas.xmlsoap.org/soap/envelope/"> <Header><\/Header> <Body> <Execute xmlns="urn:schemas-microsoft-com:xml-analysis"> <Command> <Statement> '+i+" <\/Statement> <\/Command> <Properties> <PropertyList> <Catalog>"+this.model.dataSource.catalog+"<\/Catalog> <\/PropertyList> <\/Properties><\/Execute> <\/Body> <\/Envelope>";this.doAjaxPost("POST",h.url,{XMLA:pData},this._generateDrillData,null,{pvtGridObj:this,action:"loadFieldElements"})},_generateDrillData:function(t,i){for(var e=n(i).find("row").children(),r=n.map(e,function(n){var t=parseFloat(n.textContent),i=n.tagName.replace(/_x005B_/g,"[").replace(/_x0020_/g," ").replace(/_x005D_/g,"]").replace(/_x0024_/g,"$").replace("].[","]-[");return'"'+i+'":'+t}),o=r[0],f="",u=0;u<r.length;u++){if(r[u]==o){f+=f==""?"[{"+r[u]:"}, {"+r[u];continue}f+=","+r[u]}f+="}]";t.pvtGridObj._trigger("drillThrough",{element:t.pvtGridObj.element,data:f})},_getTreeData:function(n,t,i){var r=this._getConnectionInfo(n.url),u='<Envelope xmlns="http://schemas.xmlsoap.org/soap/envelope/"><Header/><Body><Discover xmlns="urn:schemas-microsoft-com:xml-analysis"><RequestType>'+n.request+"<\/RequestType><Restrictions><RestrictionList><CATALOG_NAME>"+n.catalog+"<\/CATALOG_NAME><CUBE_NAME>"+n.cube+"<\/CUBE_NAME><\/RestrictionList><\/Restrictions><Properties><PropertyList><Catalog>"+n.catalog+"<\/Catalog><LocaleIdentifier>"+r.LCID+"<\/LocaleIdentifier> <\/PropertyList><\/Properties><\/Discover><\/Body><\/Envelope>";this.doAjaxPost("POST",r.url,{XMLA:u},t,null,i)},_addHyperlink:function(i){if(n(".hyperlinkValueCell")[0]&&n(n(".hyperlinkValueCell")[0]).removeClass("hyperlinkValueCell"),n(".hyperlinkHeaderCell")[0]&&n(n(".hyperlinkHeaderCell")[0]).removeClass("hyperlinkHeaderCell"),n(i.target).text()==""||n(i.target).text()==null)return!1;i.target.parentElement.className.trimLeft().split(" ")[0]=="value"&&(this.enableValueCellHyperlink()||this.model.enableDrillThrough)?n(i.target).addClass("hyperlinkValueCell"):n(i.target.parentElement).hasClass("summary value")&&this.enableSummaryCellHyperlink()?n(i.target).addClass("hyperlinkValueCell"):i.target.parentElement.className.split(" ")[0]=="rowheader"||this._dataModel=="Pivot"&&n(i.target.parentElement).attr("role")=="rowheader"?this._dataModel!="Pivot"||this.model.enableDeferUpdate?this.enableRowHeaderHyperlink()&&n(i.target).addClass("hyperlinkHeaderCell"):(fieldIndex=n(i.target.parentElement).attr("p").split(",")[0],this.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode&&JSON.parse(this.getOlapReport()).PivotRows[fieldIndex].EnableHyperlink?n(i.target).addClass("hyperlinkHeaderCell"):this.model.operationalMode==t.PivotGrid.OperationalMode.ClientMode&&this.model.dataSource.rows.length>0&&!t.isNullOrUndefined(this.model.dataSource.rows[fieldIndex].enableHyperlink)&&this.model.dataSource.rows[fieldIndex].enableHyperlink?n(i.target).addClass("hyperlinkHeaderCell"):this.enableRowHeaderHyperlink()&&n(i.target).addClass("hyperlinkHeaderCell")):(i.target.parentElement.className.split(" ")[0]=="colheader"||this._dataModel=="Pivot"&&n(i.target.parentElement).attr("role")=="columnheader")&&(this._dataModel!="Pivot"||this.model.enableDeferUpdate?this.enableColumnHeaderHyperlink()&&n(i.target).addClass("hyperlinkHeaderCell"):n(i.target.parentElement).hasClass("summary calc")||n(i.target.parentElement).hasClass("colheader calc")||(fieldIndex=n(i.target.parentElement).attr("p").split(",")[1],this.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode&&JSON.parse(this.getOlapReport()).PivotColumns[fieldIndex].EnableHyperlink?n(i.target).addClass("hyperlinkHeaderCell"):this.model.operationalMode==t.PivotGrid.OperationalMode.ClientMode&&!t.isNullOrUndefined(this.model.dataSource.columns[fieldIndex].enableHyperlink)&&this.model.dataSource.columns[fieldIndex].enableHyperlink?n(i.target).addClass("hyperlinkHeaderCell"):this.enableColumnHeaderHyperlink()&&n(i.target).addClass("hyperlinkHeaderCell")))},_removeHyperlink:function(t){n(t.target).removeClass("hyperlinkValueCell").removeClass("hyperlinkHeaderCell")},_cellContext:function(t){var r=n(t.target).parents(".e-pivotgrid").data("ejPivotGrid"),i=t.target||t.srcElement,u;if(r.enableCellContext()==!0&&n(i).parents("#"+r._id)[0]&&(u=n(i).attr("p"),u)){var u=n(i).attr("p"),f=r.getJSONRecords()[parseInt(parseInt(u.split(",")[0])*r._rowCount+parseInt(u.split(",")[1]))].Info,e={cellValue:i.innerHTML,cellPosition:u,cellType:i.className.split(" ")[0],role:n(i).attr("role"),uniqueName:f.split("::")[0],args:t,rawdata:f};e.cellType!=""&&r._trigger("cellContext",{args:e});t.target?t.preventDefault():window.event.returnValue=!1}},_initCellSelection:function(i){n("#"+this._id+" td,th").removeClass("highlighted");this._on(this.element,"mouseup touchend",".value",this._completeCellSelection);var r;_oriX=i.pageX;_oriY=i.pageY;r=i.target||window.event.srcElement;n(r).hasClass("cellValue")&&(r=r.parentElement);n(".value").addClass("selection");n("#"+this._id).append(t.buildTag("div.cellSelection#"+this._id+"_cellSelection","",{}));_startPosCell=n(r)[0].attributes.getNamedItem("p").value;this._on(this.element,"mousemove touchmove",".value, .cellSelection",this._cellSelection)},_headerClickCellSelection:function(t){var r=n(t.target).attr("class").indexOf("colheader")&&n(t.target).attr("class").indexOf("rowheader")==-1?n(t.target).attr("class").indexOf("cellValue")!=-1?n(t.target).parent():null:n(t.target),u,o;if(r!=null){n("#"+this._id+" td,th").removeClass("highlighted");var f,e,i;for(f=r.attr("role"),i=f=="columnheader"?r.attr("p").split(",")[0]:r.attr("p").split(",")[1],e=f=="columnheader"?r.attr("colspan"):r.attr("rowspan"),u=0;u<e;u++)f=="columnheader"?(n("#"+this._id+" [p^='"+(parseInt(u)+parseInt(i))+",']").addClass("highlighted"),n("#"+this._id+" [p^='"+(parseInt(u)+parseInt(i))+",'][role='columnheader']").each(function(t,i){(parseInt(i.attributes.p.value.split(",")[1])<=parseInt(r.attr("p").split(",")[1])||parseInt(i.attributes.colspan.value)>parseInt(r.attr("colspan")))&&n(i).removeClass("highlighted")})):(n("#"+this._id+" [p$=',"+(parseInt(u)+parseInt(i))+"']").addClass("highlighted"),n("#"+this._id+" [p$=',"+(parseInt(u)+parseInt(i))+"'][role='rowheader']").each(function(t,i){(parseInt(i.attributes.p.value.split(",")[0])<=parseInt(r.attr("p").split(",")[0])||parseInt(i.attributes.rowspan.value)>parseInt(r.attr("rowspan")))&&n(i).removeClass("highlighted")}));_startPosCell=f=="columnheader"?n("#"+this._id+" [p^='"+(0+parseInt(i))+",'].value").eq(0).attr("p"):n("#"+this._id+" [p$=',"+(0+parseInt(i))+"'].value").eq(0).attr("p");o=f=="columnheader"?n("#"+this._id+" [p^='"+(parseInt(e)-1+parseInt(i))+",']").eq(n("#"+this._id+" [p^='"+(parseInt(e)-1+parseInt(i))+",']").length-1):n("#"+this._id+" [p$=',"+(parseInt(e)-1+parseInt(i))+"']").eq(n("#"+this._id+" [p$=',"+(parseInt(e)-1+parseInt(i))+"']").length-1);this._completeCellSelection(o)}},_cellSelection:function(i){n("#"+this._id+"_gridTooltip").hide();i.pageX<_oriX?n("#"+this._id+"_cellSelection").css({left:i.pageX+2,width:_oriX-i.pageX}):n("#"+this._id+"_cellSelection").css({left:_oriX-6,width:i.pageX-_oriX});i.pageY<_oriY?n("#"+this._id+"_cellSelection").css({top:i.pageY,height:_oriY-i.pageY-7}):n("#"+this._id+"_cellSelection").css({top:_oriY+7,height:i.pageY-_oriY-11});n(".pivotGridTable").mouseleave(function(i){var r=n(i.target).parents(".e-pivotgrid").data("ejPivotGrid");t.isNullOrUndefined(i.toElement)||t.isNullOrUndefined(i.toElement.classList)||i.toElement.classList[0]!="e-pivotgrid"||(n("#"+r._id+"_cellSelection").remove(),n(".value").removeClass("selection"),r._off(r.element,"mouseup mouseend",".value"))})},_completeCellSelection:function(i){var w,e,v=[],tt=[],u,it=[],l,o,s,h,y,a,ut,p,c,k,g,ft,nt,et;for(this._off(this.element,"mousemove touchmove",".value"),n(".value").removeClass("selection"),w=n(i).hasClass("value")?i:i.target||window.event.srcElement,n(w).hasClass("cellValue")&&(w=w.parentElement),e=n(w)[0].attributes.getNamedItem("p").value,o=0,s=parseInt(_startPosCell.split(",")[1])<parseInt(e.split(",")[1])?parseInt(_startPosCell.split(",")[1]):parseInt(e.split(",")[1]);s<=(parseInt(_startPosCell.split(",")[1])>parseInt(e.split(",")[1])?parseInt(_startPosCell.split(",")[1]):parseInt(e.split(",")[1]));s++)if(this._dataModel=="Olap"||n("#"+this._id).find("td[p*=',"+s+"']").parent().is(":visible"))for(h=parseInt(_startPosCell.split(",")[0])<parseInt(e.split(",")[0])?parseInt(_startPosCell.split(",")[0]):parseInt(e.split(",")[0]);h<=(parseInt(_startPosCell.split(",")[0])>parseInt(e.split(",")[0])?parseInt(_startPosCell.split(",")[0]):parseInt(e.split(",")[0]));h++)if(this._dataModel=="Olap"||n("#"+this._id).find("[p*='"+h+",']").last("th").is(":Visible")){v[o]=this.getJSONRecords()[h*this._rowCount+s];var f,b="",rt,ot,d=0,st=0;if(u=n("#"+this._id).find("tbody").find('[p="'+h+","+s+'"]').parent("tr").find(".rowheader").last().attr("p"),u==r&&(u=n("#"+this._id).find("tbody").find('[p="'+h+","+s+'"]').parent("tr").find(".summary").first().attr("p")),rt=u,u!=null){while(u[0]>=0)u==this.getJSONRecords()[parseInt(parseInt(u.split(",")[0])*this._rowCount+parseInt(u.split(",")[1]))].Index&&(f=this.getJSONRecords()[parseInt(parseInt(u.split(",")[0])*this._rowCount+parseInt(u.split(",")[1]))].Value,this._dataModel=="Pivot"&&(f=n("#"+this._id).find("td[p*='"+h+","+s+"']").prevAll("th").children(".expand").length>0?f.replace("Total",""):f),u=parseInt(u.split(",")[0])-1+","+parseInt(u.split(",")[1])),b&&f!=""?b=f+"##"+b:f!=""&&(b=f);tt[o]=b}for(y="",ut=n("#"+this._id).find("td[p*='"+parseInt(v[o].Index.split(",")[0])+","+parseInt(v[o].Index.split(",")[1])+"']").closest("tbody").prev().children("tr:last").children("th").attr("p")[2],ot=ut,l=v[o].Index,l!=r&&l==this.getJSONRecords()[parseInt(parseInt(l.split(",")[0])*this._rowCount+parseInt(l.split(",")[1]))].Index&&(p=parseInt(l.split(",")[0])),c=0;c<=ut;c++){if(p!=null&&p+","+c==this.getJSONRecords()[parseInt(parseInt(p)*this._rowCount+c)].Index){if(a=this.getJSONRecords()[parseInt(parseInt(p)*this._rowCount+c)].Value,this._dataModel=="Pivot")for(k=p;k>=0;k--)if(n("#"+this._id).find("th[p*='"+k+","+c+"']").length>0){a=n("#"+this._id).find("th[p*='"+k+","+c+"']").find(".expand").length>0?a.replace("Total",""):a;break}y==""?y=a:a!=""&&(y=y+"##"+a)}it[o]=y}o++}if(this._dataModel=="Olap"){for(g=this.getJSONRecords()[parseInt(parseInt(rt.split(",")[0])*this._rowCount+parseInt(rt.split(",")[1]))].Info;g[0]>=0;)f=this.getJSONRecords()[parseInt(parseInt(g.split(",")[0])*this._rowCount+parseInt(g.split(",")[1]))].Info,(f.split("::")[0].indexOf("Measures")>0||f.split("::")[0].indexOf("MEASURES")>0)&&d++,u=parseInt(u.split(",")[0])-1+","+parseInt(u.split(",")[1]);if(ft=parseInt(l.split(",")[0]),d==0)for(nt=0;nt<=ot;nt++)ft!=null&&(et=this.getJSONRecords()[parseInt(parseInt(ft)*this._rowCount+nt)].Info),(et.split("::")[0].indexOf("Measures")>0||et.split("::")[0].indexOf("MEASURES")>0)&&st++}else measureCount=this.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode?JSON.parse(this.getOlapReport()).PivotCalculations.length:this.model.dataSource.values.length;args={JSONRecords:v,rowHeader:tt,columnHeader:it,measureCount:d>0?"Row:"+d:"Column:"+st};this._trigger("cellSelection",args);v=tt=it=[];n("#"+this._id+"_cellSelection").remove();this._on(this.element,"mousemove touchmove",".value",this._applyToolTip);this._off(this.element,"mouseup touchend",".value")},exportPivotGrid:function(n,i){var o,s,e,f,u;if(this.model.operationalMode==t.PivotGrid.OperationalMode.ClientMode)u={args:JSON.stringify({gridData:this.exportRecords,rowCount:this._rowCount,columnCount:Math.floor(this.getJSONRecords().length/this._rowCount),fileName:t.isNullOrUndefined(i)?"":i})},t.raiseWebFormsServerEvents?(o={model:this.model,originalEventType:n},s=u,t.raiseWebFormsServerEvents(n,o,s),setTimeout(function(){t.isOnWebForms=!0},1e3)):this.doPostBack(n,u);else{try{e=JSON.parse(this.getOlapReport()).Report}catch(h){e=this.getOlapReport()}this.element.find(".summary").length>0?f={valueCellColor:this.element.find(".value").css("color"),valueCellBGColor:this.element.find(".value").css("background-color"),summaryCellColor:this.element.find(".summary").css("color"),summaryCellBGColor:this.element.find(".summary").css("background-color")}:this.element.find(".value").length>0&&(f={valueCellColor:this.element.find(".value").css("color"),valueCellBGColor:this.element.find(".value").css("background-color")});u={args:JSON.stringify({exportOption:n,currentReport:e,layout:this.layout(),colorSettings:f!=r?JSON.stringify(f):""})};this.doPostBack(this.model.url+"/"+this.model.serviceMethodSettings.exportPivotGrid,u)}},_getFArrayfromMArray:function(n){var t={_formattingArrayClone:1,_defaultStyleSCell:2,_defaultStyleVCell:3,_removedItems:4}[n];for(i=0;i<this._mdformattingArray.length;i++)if(this._mdformattingArray[i][0]==this._id)return this._mdformattingArray[i][t];return[]},createConditionalDialog:function(){var l=t.buildTag("div#preventDiv").css({width:n("body").width()+"px",height:n("body").height()+"px",position:"absolute",top:n("body").offset().top+"px",left:n("body").offset().left+"px","z-index":10})[0].outerHTML,r,u,f,a,e,o,s,h,c;n("body").append(l);this.element.find(".e-dialog").remove();r=t.buildTag("div#"+this._id+"_clientDlg.clientDialog",{opacity:"1"})[0].outerHTML;f=this._getLocalizedLabels("ConditionalFormatting");var v=t.buildTag("label#"+this._id+"_conLbl.conditionLbl",this._getLocalizedLabels("Condition"))[0].outerHTML,y=t.buildTag("input#"+this._id+"_conType.conditionType","",{},{type:"text",tabindex:0,accesskey:"f"})[0].outerHTML,p=t.buildTag("label#"+this._id+"_editcond.editcondition",this._getLocalizedLabels("Editcondtion"))[0].outerHTML,w=t.buildTag("label#"+this._id+"_value1.value1",this._getLocalizedLabels("Value1"))[0].outerHTML,b=t.buildTag("label#"+this._id+"_value2.value2",this._getLocalizedLabels("Value2"))[0].outerHTML,k=t.buildTag("label#"+this._id+"_backcolorLbl.backcolorLbl",this._getLocalizedLabels("Backcolor"))[0].outerHTML,d=t.buildTag("label#"+this._id+"_bordercolorLbl.bordercolorLbl",this._getLocalizedLabels("Bordercolor"))[0].outerHTML,g=t.buildTag("label#"+this._id+"_borderrangeLbl.borderrangeLbl",this._getLocalizedLabels("Borderrange"))[0].outerHTML,nt=t.buildTag("label#"+this._id+"_borderstyleLbl.borderstyleLbl",this._getLocalizedLabels("Borderstyle"))[0].outerHTML,tt=t.buildTag("label#"+this._id+"_fStyleLbl.fStyleLbl",this._getLocalizedLabels("Fontstyle"))[0].outerHTML,it=t.buildTag("label#"+this._id+"_fSizeLbl.fSizeLbl",this._getLocalizedLabels("Fontsize"))[0].outerHTML,rt=t.buildTag("input#"+this._id+"_editCon.editconditionDropDown","",{},{type:"text",tabindex:1,accesskey:"e"})[0].outerHTML,a=t.buildTag("button#"+this._id+"_removeBtn.dialogremoveBtn e-icon","",{},{name:this._getLocalizedLabels("Remove")})[0].outerHTML,ut=t.buildTag("input#"+this._id+"_conFrom.conditionFrom","",{},{name:"inputVal",type:t.isMobile()?"number":"text",inputmode:t.isMobile()?"numeric":"",pattern:t.isMobile()?"[0-9]*":"",tabindex:2})[0].outerHTML,ft=t.buildTag("input#"+this._id+"_conTo.conditionTo","",{},{name:"inputVal",type:t.isMobile()?"number":"text",inputmode:t.isMobile()?"numeric":"",pattern:t.isMobile()?"[0-9]*":"",tabindex:3})[0].outerHTML,et=t.buildTag("input#"+this._id+"_backcolor.backcolor","",{},{type:"text",tabindex:4,accesskey:"b"})[0].outerHTML,ot=t.buildTag("input#"+this._id+"_bordercolor.bordercolor","",{},{type:"text",tabindex:5,accesskey:"c"})[0].outerHTML,st=t.buildTag("input#"+this._id+"_borderrange.borderrange","",{},{type:"text",tabindex:6,accesskey:"r"})[0].outerHTML,ht=t.buildTag("input#"+this._id+"_borderstyle.borderstyle","",{},{type:"text",tabindex:7,accesskey:"s"})[0].outerHTML,ct=t.buildTag("input#"+this._id+"_fStyle.fStyle","",{},{type:"text",tabindex:8,accesskey:"o"})[0].outerHTML,lt=t.buildTag("input#"+this._id+"_fSize.fSize","",{},{type:"text",tabindex:9,accesskey:"l"})[0].outerHTML,at=t.buildTag("div#"+this._id+"_conditionDlg.conditionDlg","<table class='conditionformatTbl'><tr><td>"+v+"<\/td><td>"+y+"<\/td><td>"+p+"<\/td><td>"+rt+"<\/td><td>"+a+"<\/td><\/tr><tr><td>"+w+"<\/td><td>"+ut+"<\/td><td>"+b+"<\/td><td>"+ft+"<\/td><\/tr><tr><td>"+k+"<\/td><td>"+et+"<\/td><td>"+g+"<\/td><td>"+st+"<\/td><\/tr><tr><td>"+d+"<\/td><td>"+ot+"<\/td><td>"+nt+"<\/td><td>"+ht+"<\/td><\/tr><tr><td>"+tt+"<\/td><td>"+ct+"<\/td><td>"+it+"<\/td><td>"+lt+"<\/td><\/tr><\/table>")[0].outerHTML;return u=at,s=t.buildTag("button#"+this._id+"_OKBtn.dialogOKBtn","",{},{name:this._getLocalizedLabels("OK")})[0].outerHTML,h=t.buildTag("button#"+this._id+"_CancelBtn.dialogCancelBtn","",{},{name:this._getLocalizedLabels("Cancel")})[0].outerHTML,dialogFooter=t.buildTag("div",s+h,{float:"right",margin:"20px 39px 6px"})[0].outerHTML,n("#"+this._id).after(r),n("#"+this._id+"_clientDlg").append(u+dialogFooter),n("#"+this._id+"_clientDlg").ejDialog({width:"auto",target:"#"+this._id,enableResize:!1,close:this._onPreventPanelClose}),n(".e-titlebar").prepend(t.buildTag("div",f,{display:"inline"})[0].outerHTML)[0],n("#"+this._id+"_OKBtn,#"+this._id+"_CancelBtn,#"+this._id+"_removeBtn").ejButton({type:t.ButtonType.Button}),n("#"+this._id+"_OKBtn,#"+this._id+"_CancelBtn").css({margin:"0 0 0 10px",width:"67px"}),n("#"+this._id+"_removeBtn").css({width:"29px",height:"29px"}),n("#"+this._id+"_conFrom,#"+this._id+"_conTo").css({width:"136px",height:"26px"}),n("#"+this._id+"_conditionDlg").css({margin:"13px 0 0 0"}),n("#"+this._id+"_editcond,#"+this._id+"_value2,#"+this._id+"_borderrangeLbl,#"+this._id+"_borderstyleLbl,#"+this._id+"_fSizeLbl").css({margin:"0 0 0 15px"}),n("#"+this._id+"_conTo").attr("disabled","disabled"),this.removeBtn=n("#"+this._id+"_removeBtn").data("ejButton"),e=n("#"+this._id+"_OKBtn").data("ejButton"),o=n("#"+this._id+"_CancelBtn").data("ejButton"),this.removeBtn.setModel({enabled:!1}),e.setModel({text:this._getLocalizedLabels("OK")}),o.setModel({text:this._getLocalizedLabels("Cancel")}),n("#"+this._id+"_conType").ejDropDownList({change:"_onActiveConditionChange",dataSource:["Lesser","Greater","Equal","Not Equal","Between","Not Between"],selectedIndices:[0],width:"142px",height:"30px"}),n("#"+this._id+"_editCon").ejDropDownList({change:"_onEditConditionChange",dataSource:this._list,selectedIndices:[0],width:"142px",height:"30px"}),n("#"+this._id+"_backcolor").ejDropDownList({dataSource:["AliceBlue","Black","Blue","Brown","Gold","Green","Lime","Maroon","Orange","Pink","Red","Violet","White","Yellow"],selectedIndices:[0],width:"142px",height:"30px"}),n("#"+this._id+"_bordercolor").ejDropDownList({dataSource:["AliceBlue","Black","Blue","Brown","Gold","Green","Lime","Maroon","Orange","Pink","Red","Violet","White","Yellow"],selectedIndices:[0],width:"142px",height:"30px"}),n("#"+this._id+"_borderrange").ejDropDownList({dataSource:["1","2","3","4","5","6","7","8","9"],selectedIndices:[0],width:"142px",height:"30px"}),n("#"+this._id+"_borderstyle").ejDropDownList({dataSource:["Solid","Dashed","Dotted","Double","Groove","Inset","Outset","Ridge","None"],selectedIndices:[0],width:"142px",height:"30px"}),n("#"+this._id+"_fStyle").ejDropDownList({dataSource:["Algerian","Arial","Bodoni MT","Britannic Bold","Cambria","Calibri","Courier New","DejaVu Sans","Forte","Gerogia","Impact","Segoe UI","Tahoma","Times New Roman","Verdana","None"],selectedIndices:[0],width:"142px",height:"30px"}),n("#"+this._id+"_fSize").ejDropDownList({dataSource:["12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30"],selectedIndices:[0],width:"142px",height:"30px"}),this.element.find("#"+this._id+"_conType").ejDropDownList("option","change",t.proxy(this._onActiveConditionChange,this)),this.element.find("#"+this._id+"_editCon").ejDropDownList("option","change",t.proxy(this._onEditConditionChange,this)),this.isNewFormat=!0,this._formattingArrayClone=this._getFArrayfromMArray("_formattingArrayClone"),this._removedItems=this._getFArrayfromMArray("_removedItems"),this.ddlEditCondition=n("#"+this._id+"_editCon").data("ejDropDownList"),this.ddlConditionType=n("#"+this._id+"_conType").data("ejDropDownList"),this.ddlFont=n("#"+this._id+"_fStyle").data("ejDropDownList"),this.ddlFontSize=n("#"+this._id+"_fSize").data("ejDropDownList"),this.ddlBackColor=n("#"+this._id+"_backcolor").data("ejDropDownList"),this.ddlBorderColor=n("#"+this._id+"_bordercolor").data("ejDropDownList"),this.ddlBorderStyle=n("#"+this._id+"_borderstyle").data("ejDropDownList"),this.ddlBorderWidth=n("#"+this._id+"_borderrange").data("ejDropDownList"),this.element.find("#"+this._id+"_conFrom,#"+this._id+"_conTo").keypress(function(t){return t.which==8||t.which==0?!0:t.which<45||t.which==45&&(t.target.value!=""||t.target.value.indexOf("-")>-1)||t.which>58?!1:t.which==46&&n(this).val().indexOf(".")!=-1||t.which==47?!1:void 0}),n("#"+this._id+"_OKBtn").click(function(){var t=n(this).parents(".e-pivotgrid").data("ejPivotGrid"),r,u,e,f;if(n("#"+t._id+"_conFrom").val()==""?alert("Enter Operand1"):n("#"+t._id+"_conTo").attr("disabled")||n("#"+t._id+"_conTo").val()!=""?(t._applyFormatting(),t._onPreventPanelClose()):alert("Enter Operand2"),t.isNewFormat){if(r=t.ddlEditCondition._selectedIndices[0],u=t._formattingArrayClone.length/10,u>0)for(i=u-1;i<u;i++){for(e=i,r=0;r<t._formattingArrayClone.length-1;r+=10)f="Format "+i,t._formattingArrayClone[r+9]!=f&&t._formattingArrayClone[r+9]=="Add New"&&(e=e+1,t._list.push(f));t._formattingArrayClone[r-1]=="Add New"&&(t._formattingArrayClone[r-1]=f)}t.isNewFormat=!0}else alert("The given value not matched"),t.isNewFormat=!0}),this.ddlEditCondition.getListData().length>1?(n("#"+this._id+"_editCon").ejDropDownList("enable"),n("#"+this._id+"_editcond").css("color","#000")):(n("#"+this._id+"_editCon").ejDropDownList("disable"),n("#"+this._id+"_editcond").css("color","#cbcbcb")),c=this._formattingArrayClone.length/10,c>0&&(this.ddlEditCondition.selectItemByText(this._formattingArrayClone[this._formattingArrayClone.length-1]),this._onEditConditionChange()),n("#"+this._id+"_removeBtn").click(function(){var t=n(this).parents(".e-pivotgrid").data("ejPivotGrid");t._removeFormatting()}),n("#"+this._id+"_CancelBtn").click(function(){var t=n(this).parents(".e-pivotgrid").data("ejPivotGrid");t.element.find(".e-dialog, .clientDialog").remove();t._onPreventPanelClose()}),!1},_onPreventPanelClose:function(){n("body").find("#preventDiv").remove();n(".e-pivotgrid").data("ejWaitingPopup")&&n(".e-pivotgrid").data("ejWaitingPopup").hide()},_onActiveConditionChange:function(t){t.selectedText=="Between"||t.selectedText=="Not Between"?n("#"+this._id+"_conTo").removeAttr("disabled"):(n("#"+this._id+"_conTo").attr("disabled","disabled"),n("#"+this._id+"_conTo").val(""))},_onEditConditionChange:function(){if(this.ddlEditCondition._selectedIndices[0]>0){this._formattingArrayClone=this._getFArrayfromMArray("_formattingArrayClone");var t=this.ddlEditCondition._selectedIndices[0]*10-10;this.ddlConditionType.selectItemByText(this._formattingArrayClone[t]);n("#"+this._id+"_conFrom").val(this._formattingArrayClone[t+1]);n("#"+this._id+"_conTo").val(this._formattingArrayClone[t+2]);this.ddlBackColor.selectItemByText(this._formattingArrayClone[t+3]);this.ddlBorderColor.selectItemByText(this._formattingArrayClone[t+4]);this.ddlBorderStyle.selectItemByText(this._formattingArrayClone[t+5]);this.ddlBorderWidth.selectItemByText(this._formattingArrayClone[t+6]);this.ddlFont.selectItemByText(this._formattingArrayClone[t+7]);this.ddlFontSize.selectItemByText(this._formattingArrayClone[t+8]);this.removeBtn.option("enabled",!0);this._onConditionTypeChange()}else this.removeBtn.option("enabled",!1),this._clearWindow()},_clearWindow:function(){n("#"+this._id+"_clientDlg").find("#"+this._id+"_conFrom,#"+this._id+"_conTo").val("");n("#"+this._id+"_conTo").disabled=!0},_onConditionTypeChange:function(){n("#"+this._id+"_conTo").disabled=!(this.ddlConditionType._selectedIndices[0]==4||this.ddlConditionType._selectedIndices[0]==5)},_removeFormatting:function(){var r,n,t;if(this.removeBtn.option("enabled")&&(j=0,this._removedItems=this._getFArrayfromMArray("_removedItems"),r=confirm("Are you sure you want to remove the selected format?"),r==!0)){for(n=this.ddlEditCondition._selectedIndices[0],n==1&&this.removeBtn.option("enabled",!1),this._removedItems[this._removedItems.length]=this.ddlEditCondition._selectedValue,this._list.pop(this.ddlEditCondition._selectedIndices[0]-1),n-1!=0?(this.ddlEditCondition._selectedIndices[0]=n-1,this.ddlEditCondition.selectItemByText(this._formattingArrayClone[n*10-11])):this._list.length>1?(this.ddlEditCondition._selectedIndices[0]=n,this.ddlEditCondition.selectItemByText(this._formattingArrayClone[n*10-1])):this.ddlEditCondition._selectedIndices[0]=n-1,i=(n-1)*10+0;i<=(n-1)*10+9;i++)this._formattingArrayClone[i]="N/A";for(t=this._formattingArrayClone,this._formattingArrayClone=[],i=0;i<t.length;i++)t[i]!="N/A"&&(this._formattingArrayClone[j]=t[i],j++);for(i=0;i<this._mdformattingArray.length;i++)this._mdformattingArray[i][0]==this._id&&(this._mdformattingArray[i][1]=this._formattingArrayClone,this._mdformattingArray[i][4]=this._removedItems);this._onEditConditionChange();this._clearGrid();this._applyFormatting();this.element.find(".e-dialog, .clientDialog").remove();this._onPreventPanelClose()}},_clearGrid:function(){var t=n(".pivotGridTable .value"),r;for(i=0;i<t.length;i++)r=!1,t[i].className.indexOf("value")>=-1?(this._defaultStyleVCell.length==0&&(this._defaultStyleVCell=this._defaultStyleSCell),n(t[i]).is(":visible")||(r=!0),n(t[i]).attr("style",this._defaultStyleVCell)):(this._defaultStyleSCell.length==0&&(this._defaultStyleSCell=this._defaultStyleVCell),n(t[i]).is(":visible")||(r=!0),n(t[i]).attr("style",this._defaultStyleSCell)),r&&n(t[i]).hide()},_applyFormatting:function(){var t,r,u;if(n("#"+this._id+"_conFrom").val()!=""){t=n(".pivotGridTable .value");u=!1;this._formattingArrayClone=this._getFArrayfromMArray("_formattingArrayClone");this._removedItems=this._getFArrayfromMArray("_removedItems");this._formattingArrayClone.length==0&&(u=!0);var f=n("#"+this._id+"_conFrom").val(),e=n("#"+this._id+"_conTo").val(),o=this.ddlConditionType._selectedValue,s=this.ddlBackColor._selectedValue,h=this.ddlBorderColor._selectedValue,c=this.ddlBorderWidth._selectedValue,a=this.ddlFont._selectedValue,v=this.ddlFontSize._selectedValue,y=this.ddlBorderStyle._selectedValue,p=this.ddlEditCondition._selectedValue;for(r=[this.ddlConditionType._selectedValue,f,e,this.ddlBackColor._selectedValue,this.ddlBorderColor._selectedValue,this.ddlBorderStyle._selectedValue,this.ddlBorderWidth._selectedValue,this.ddlFont._selectedValue,this.ddlFontSize._selectedValue,this.ddlEditCondition._selectedValue],i=9;i<=this._formattingArrayClone.length;i+=10)if(this.ddlEditCondition._selectedValue==this._formattingArrayClone[i])for(i=0;i<t.length;i++)t[i].style.display!="none"&&n(t[i]).removeAttr("style");if(j=0,l=0,cdnFmtLen=this._formattingArrayClone.length+10,!this.isDrillDown)if(this.ddlEditCondition._selectedIndices[0]==0)for(i=this._formattingArrayClone.length;i<cdnFmtLen;i++)this._formattingArrayClone[i]=r[l],l++;else if(cdnFmtLen=this.ddlEditCondition._selectedIndices[0]*10-10,this.ddlEditCondition._selectedIndices[0]>0)for(i=cdnFmtLen;i<cdnFmtLen+10;i++)this._formattingArrayClone[i]=r[l],l++;for(this.isDrillDown=!1,this._setDefaultStyle(),j=0,l=0,u&&(this._mdformattingArray[this._mdformattingArray.length]=[],this._mdformattingArray[this._mdformattingArray.length-1]=[this._id,this._formattingArrayClone,this._defaultStyleSCell,this._defaultStyleVCell,this._removedItems]),l=0;l<this._formattingArrayClone.length;l++){for(value=[],i=0;i<t.length;i++)value.length==0&&(value[value.length]=this._formattingArrayClone[l+1],value[value.length]=this._formattingArrayClone[l+2],value[value.length]=this._formattingArrayClone[l]),this._getResult(this._formattingArrayClone[l+1],this._formattingArrayClone[l+2],Number(n(t[i]).text().replace(/[^0-9\.]+/g,"")),this._formattingArrayClone[l])&&n(t[i]).text()!=""&&(t[i].style.backgroundColor=this._formattingArrayClone[l+3],t[i].style.borderColor=this._formattingArrayClone[l+4],t[i].style.borderStyle=this._formattingArrayClone[l+5],t[i].style.borderWidth=this._formattingArrayClone[l+6]+"px",t[i].style.fontFamily=this._formattingArrayClone[l+7],t[i].style.fontSize=this._formattingArrayClone[l+8]+"px");l+=9}this.element.find(".e-dialog, .clientDialog").remove()}},_getResult:function(n,t,i,r){switch(r){case"Lesser":return i<n;case"Greater":return i>n;case"Equal":if(i==n)return i;break;case"Not Equal":return i!=n;case"Between":return n<t&&i>n&&i<t||n>t&&i<n&&i>t||i==n&&i==t;case"Not Between":return!(n<t&&i>n&&i<t||n>t&&i<n&&i>t||i==n&&i==t)}},_setDefaultStyle:function(){var t=n(".pivotGridTable .value");if(this._defaultStyleSCell=this._getFArrayfromMArray("_defaultStyleSCell"),this._defaultStyleVCell=this._getFArrayfromMArray("_defaultStyleVCell"),this._defaultStyleVCell.length==0||this._defaultStyleSCell.length==0)for(j=0;j<t.length;j++)t[j].className.indexOf("value")>=-1&&this._defaultStyleVCell.length==0&&n(t[j]).attr("style")!=r?this._defaultStyleVCell=n(t[j]).attr("style"):t[j].className.indexOf("summary")>=-1&&this._defaultStyleSCell.length==0&&n(t[j]).attr("style")!=r&&(this._defaultStyleSCell=n(t[j]).attr("style"))},_renderControlSuccess:function(i){try{if(i[0]!=r&&i.length>0?(this.setJSONRecords(i[0].Value),this.setOlapReport(i[1].Value),i[2]!=null&&i[2]!=r&&i[2].Key=="PageSettings"&&(this.model.enableVirtualScrolling?(this._categPageCount=Math.ceil(JSON.parse(i[3].Value).Column/JSON.parse(i[2].Value).CategorialPageSize),this._seriesPageCount=Math.ceil(JSON.parse(i[3].Value).Row/JSON.parse(i[2].Value).SeriesPageSize),this._categCurrentPage=JSON.parse(i[2].Value).CategorialCurrentPage,this._seriesCurrentPage=JSON.parse(i[2].Value).SeriesPageSize):n(".e-pivotpager")[0]!=null&&n(".e-pivotpager")[0]!=r&&this._pagerObj.initPagerProperties(JSON.parse(i[3].Value),JSON.parse(i[2].Value)),i[4]!=null&&i[4]!=r&&(this.model.customObject=i[4].Value)),(i[2]!=null&&i[2]!=r&&i[2].Key!="PageSettings"||i[2]!=null&&i[2]!=r&&i[2].Key=="customobject")&&(this.model.customObject=i[2].Value)):i.d!=r&&i.d.length>0?(this.setJSONRecords(i.d[0].Value),this.setOlapReport(i.d[1].Value),i.d[2]!=null&&i.d[2]!=r&&i.d[2].Key=="PageSettings"&&(this.model.enableVirtualScrolling?(this._categPageCount=Math.ceil(JSON.parse(i.d[3].Value).Column/JSON.parse(i.d[2].Value).CategorialPageSize),this._seriesPageCount=Math.ceil(JSON.parse(i.d[3].Value).Row/JSON.parse(i.d[2].Value).SeriesPageSize),this._categCurrentPage=JSON.parse(i.d[2].Value).CategorialCurrentPage,this._seriesCurrentPage=JSON.parse(i.d[2].Value).SeriesCurrentPage):n(".e-pivotpager")[0]!=null&&n(".e-pivotpager")[0]!=r&&this._pagerObj.initPagerProperties(JSON.parse(i.d[3].Value),JSON.parse(i.d[2].Value)),i.d[4]!=null&&i.d[4]!=r&&(this.model.customObject=i.d[4].Value)),(i.d[2]!=null&&i.d[2]!=r&&i.d[2].Value=="PageSettings"||i.d[2]!=null&&i.d[2]!=r&&i.d[2].Key=="customobject")&&(this.model.customObject=i.d[2].Value)):!t.isNullOrUndefined(i)&&t.isNullOrUndefined(i.d)&&(i.PivotRecords!=r?(this.setJSONRecords(i.PivotRecords),this.setOlapReport(i.OlapReport),i.HeaderCounts!=r&&this.model.enableVirtualScrolling?(this._categPageCount=Math.ceil(JSON.parse(i.HeaderCounts).Column/JSON.parse(i.PageSettings).CategorialPageSize),this._seriesPageCount=Math.ceil(JSON.parse(i.HeaderCounts).Row/JSON.parse(i.PageSettings).SeriesPageSize),this._categCurrentPage=JSON.parse(i.PageSettings).CategorialCurrentPage,this._seriesCurrentPage=JSON.parse(i.PageSettings).SeriesCurrentPage):i.HeaderCounts!=r&&n(".e-pivotpager")[0]!=null&&n(".e-pivotpager")[0]!=r&&this._pagerObj.initPagerProperties(JSON.parse(i.HeaderCounts),JSON.parse(i.PageSettings))):i.JsonRecords!=r&&this.model.enableJSONRendering==!0?(this.setJSONRecords(JSON.stringify(i.JsonRecords)),this.setOlapReport(JSON.stringify(i.PivotReport))):i.JsonRecords!=r?(this.setJSONRecords(i.JsonRecords),this.setOlapReport(i.PivotReport)):i.JsonRecords==r&&(this.setJSONRecords(null),i.PivotReport&&this.setOlapReport(i.PivotReport),i.OlapReport&&this.setOlapReport(i.OlapReport)),i.customObject!=null&&i.customObject!=r&&(this.model.customObject=i.customObject)),this.getOlapReport()!=r&&this.getOlapReport()!=""&&this._dataModel=="")try{this._dataModel=JSON.parse(this.getOlapReport()).DataModel}catch(f){}this.model.enableGroupingBar==!0&&(report=JSON.parse(this.getOlapReport()),this._pivotTableFields=JSON.parse(report.ItemsProperties),this._createGroupingBar(report));this.model.afterServiceInvoke!=null&&this._trigger("afterServiceInvoke",{action:"initialize",element:this.element,customObject:this.model.customObject});this.getJSONRecords()!=null&&this.getJSONRecords().length>0?this.renderControlFromJSON(this.getJSONRecords()):this.renderControlFromJSON("");this.model.enableConditionalFormatting&&this._formattingArrayClone.length>0&&this._applyFormatting();typeof oclientWaitingPopup!="undefined"&&oclientWaitingPopup!=null?n("#"+oclientProxy._id+"_maxView")[0]&&this._maxViewLoading?this._maxViewLoading.hide():oclientWaitingPopup.hide():this._ogridWaitingPopup.hide();t.isNullOrUndefined(this._schemaData!=null)||this._schemaData.element.find(".schemaNoClick").removeClass("freeze").removeAttr("style")}catch(f){}var u={action:"initialize",customObject:this.model.customObject,element:this.element};this._hideGrandTotal();this._trigger("renderSuccess",u)},_hideGrandTotal:function(){if(this.model.enableRowGrandTotal&&this.model.enableGrandTotal||this._dataModel!="Pivot"||n("#"+this._id).find("tr:last").hide(),n("#"+this._id).find("tr:first th.summary").attr("p")!=r&&(!this.model.enableColumnGrandTotal||!this.model.enableGrandTotal)&&this._dataModel=="Pivot"){var t=n("#"+this._id).find("th.gtot[role^='columnheader']");for(cLen=0;cLen<t.length;cLen++)n("#"+this._id).find('th[p^="'+parseInt(n(t[cLen]).attr("p").split(",")[0])+',"]').hide(),n("#"+this._id).find('td[p^="'+parseInt(n(t[cLen]).attr("p").split(",")[0])+',"]').hide()}},_createGroupingBar:function(n){var i,r;if(this._pivotFilter=this._getLocalizedLabels("DragFieldHere"),this.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode){for(i=0;i<n.Filters.length;i++)if(n.PivotColumns.length>=1)for(r=0;r<n.PivotColumns.length;r++)n.Filters.length==0||t.isNullOrUndefined(n.Filters[i])||n.Filters[i].Tag!=n.PivotColumns[r].Tag||(n.Filters.splice(i,1),i=-1);for(i=0;i<n.Filters.length;i++)if(n.PivotRows.length>=1)for(r=0;r<n.PivotRows.length;r++)n.Filters.length==0||t.isNullOrUndefined(n.Filters[i])||n.Filters[i].Tag!=n.PivotRows[r].Tag||(n.Filters.splice(i,1),i=-1);for(i=0;i<n.Filters.length;i++)if(n.PivotCalculations.length>=1)for(r=0;r<n.PivotCalculations.length;r++)n.Filters.length==0||t.isNullOrUndefined(n.Filters[i])||n.Filters[i].Tag!=n.PivotCalculations[r].Tag||(n.Filters.splice(i,1),i=-1);filterTag=this._createPivotButtons(this._pivotFilter!=null&&n.Filters.length>1&&n.Filters[0].Tag==n.Filters[1].Tag?n.Filters.slice(1):n.Filters,"filter")}else filterTag=this._createPivotButtons(this._pivotFilter!=null&&n.filters.length>0?n.filters:"","filter");this._pivotFilter=filterTag;rowTag=this._createPivotButtons(this.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode?n.PivotRows:n.rows,"row");this._pivotRow=rowTag;columnTag=this._createPivotButtons(this.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode?n.PivotColumns:n.columns,"column");this._pivotColumn=columnTag;valueTag=this._createPivotButtons(this.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode?n.PivotCalculations:n.values,"values");this._pivotCalculation=valueTag;this._dataModel=="XMLA"&&n.values.length>0&&n.values[0].measures&&(n.values[0].axis=="columns"&&n.values[0].measures.length>0?this._pivotColumn=this._pivotColumn+this._createPivotButtons(this.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode?n.PivotColumns:[{fieldName:"Measures",fieldCaption:this._getLocalizedLabels("Measures")}],"column"):n.values[0].axis=="rows"&&n.values[0].measures.length>0&&(this._pivotRow=this._pivotRow+this._createPivotButtons(this.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode?n.PivotColumns:[{fieldName:"Measures",fieldCaption:this._getLocalizedLabels("Measures")}],"row")))},_createPivotButtons:function(i,u){var s=this._dataModel,c,o,v,f,a,y,e,p,w;if(!t.isNullOrUndefined(i)){if(c="",o=u=="column"?"Columns":u=="row"?"Rows":u=="filter"?"Slicers":"",this.model.operationalMode==t.PivotGrid.OperationalMode.ClientMode)for(o=u=="column"?"Columns":u=="row"?"Rows":u=="filter"?"filters":"values",o=="values"&&s=="XMLA"&&(i=n.map(i,function(n){return n.kpi||n.measures})),f=0;f<i.length;f++){var b=s=="XMLA"?"":t.PivotAnalysis.getMembers(i[f].fieldName),h=s=="XMLA"?i[f].filterItems!=null&&i[f].filterItems.values.length>0||!t.isNullOrUndefined(i[f].advancedFilter)&&i[f].advancedFilter.length>0?"filtered":"":i[f].filterItems!=null&&(i[f].filterItems.values.indexOf("All")>=0?i[f].filterItems.values.length-1:i[f].filterItems.values.length)<b.length?"filtered":"",l=s=="XMLA"?"":i[f].sortOrder==t.PivotAnalysis.SortOrder.Descending?"descending":"";c+=t.buildTag("span.pivotButton",t.buildTag("button.pvtBtn#pivotButton_"+i[f].fieldName||i[f],s=="XMLA"?i[f].fieldCaption==r?i[f].fieldName:i[f].fieldCaption||i[f]:n.grep(this._pivotTableFields,function(n){return n.name==i[f].fieldName})[0].caption||n.grep(this._pivotTableFields,function(n){return n.name==i[f]})[0].caption,{},{fieldName:i[f].fieldName,axis:o})[0].outerHTML+(s=="XMLA"&&(i[f].fieldName.toLowerCase()=="measures"||!t.isNullOrUndefined(i[f].isNamedSet)&&!i[f].isNamedSet)?"":t.buildTag("span.filter e-icon "+h)[0].outerHTML)+(s=="XMLA"?" ":t.buildTag("span.sorting e-icon "+l)[0].outerHTML)+t.buildTag("span.removeBtn e-icon")[0].outerHTML).attr("tag",o+":"+i[f].fieldName||i[f])[0].outerHTML}else for(o==""&&u=="values"&&(v=this.element.find(".pivotButton:contains('"+this._getLocalizedLabels("Measures")+"')").length>0?this.element.find(".pivotButton:contains('"+this._getLocalizedLabels("Measures")+"')").parent()[0].className.split(" ")[0]:"schemaColumn",o=v=="schemaColumn"||v=="columns"?"Columns":"Rows"),f=0;f<i.length;f++){for(a=this._ascdes.split("##"),y=0,l="",h="",e=0;e<a.length;e++)(this.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode&&a[e]==i[f].Tag||this.model.operationalMode==t.PivotGrid.OperationalMode.ClientMode&&a[e]==i[f])&&(y=1);if(y==1&&(l="descending"),!t.isNullOrUndefined(this._tempFilterData))for(e=0;e<this._tempFilterData.length;e++)for(p in this._tempFilterData[e])this._dataModel=="Pivot"?p==(this.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode?i[f].Tag:i[f])&&this._tempFilterData[e][i[f].Tag]!=""&&(h="filtered"):this._dataModel=="Olap"&&p==(this.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode?i[f].Tag:i[f])&&this._tempFilterData[e][i[f].Tag].indexOf("FILTERED")!=0&&(h="filtered");this.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode?(i[f].FieldHeader=i[f].FieldHeader=="Measures"?this._getLocalizedLabels("Measures"):i[f].FieldHeader,w=i[f].FieldHeader=="Measures"||i[f].Tag=="Measures"?"":t.buildTag("span.filter e-icon "+h)[0].outerHTML,c+=t.buildTag("span.pivotButton",t.buildTag("span.dropIndicator")[0].outerHTML+t.buildTag("button.pvtBtn#pivotButton"+i[f].FieldHeader||i[f].FieldName||i[f].Name||i[f].DimensionName,i[f].FieldHeader||i[f].FieldName||i[f].Name||i[f].DimensionName)[0].outerHTML+w+t.buildTag("span.sorting e-icon "+l)[0].outerHTML+t.buildTag("span.removeBtn e-icon")[0].outerHTML).attr("tag",o+":"+i[f].Tag)[0].outerHTML):c+=t.buildTag("span.pivotButton",t.buildTag("span.dropIndicator")[0].outerHTML+t.buildTag("button.pvtBtn#pivotButton"+i[f],i[f])[0].outerHTML+t.buildTag("span.filter e-icon "+h)[0].outerHTML+t.buildTag("span.sorting e-icon "+l)[0].outerHTML+t.buildTag("span.removeBtn e-icon")[0].outerHTML).attr("tag",o+":"+i[f])[0].outerHTML}return c}},_createFields:function(){var l,e,a,u,v,h,c,o,i,s,f,r;if(this.element.find(".groupingBarPivot").remove(),this.element.prepend(t.buildTag("div#groupingBarPivot.groupingBarPivot")[0].outerHTML),this.element.find(".groupingBarPivot").prepend(t.buildTag("div.valueColumn",t.buildTag("span.values","")[0].outerHTML+t.buildTag("span.columns","")[0].outerHTML,{width:"100%"})),this.element.find(".groupingBarPivot").prepend(t.buildTag("div.drag",t.buildTag("span","",{width:"5px",display:"inline-block"})[0].outerHTML+this._getLocalizedLabels("DragFieldHere"),{width:"100%"})[0].outerHTML),this._pivotFilter!=""&&this._pivotFilter!=null&&this.element.find(".drag").text(""),this.element.find(".drag").append(this._pivotFilter),this.element.find(".values").append(this._pivotCalculation),this.element.find(".columns").append(this._pivotColumn),this.element.find(".values .pivotButton").length==0&&this.element.find(".values").append(t.buildTag("span","",{width:"5px",display:"inline-block"})[0].outerHTML+this._getLocalizedLabels("ValueArea")),this.element.find(".columns .pivotButton").length==0&&this.element.find(".columns").append(t.buildTag("span","",{width:"5px",display:"inline-block"})[0].outerHTML+this._getLocalizedLabels("ColumnArea")),this._dataModel!="Pivot"&&this.element.find(".rows").length==0&&!t.isNullOrUndefined(this.getJSONRecords())&&this.getJSONRecords().length>0&&this.getJSONRecords()[0].CSS=="colheader"?(this.element.find(".pivotGridTable thead tr:first").prepend(t.buildTag("th.grpRow",t.buildTag("div.rows",t.buildTag("span","",{width:"5px",display:"inline-block"})[0].outerHTML+this._getLocalizedLabels("RowArea"))[0].outerHTML,{},{rowspan:this.element.find("thead tr").length})[0].outerHTML),this.element.find(".pivotGridTable tbody tr:first").prepend(t.buildTag("td.rowheader","Total")[0].outerHTML)):this.element.find(".rows .pivotButton").length==0&&(this.element.find(".rows").text("").children("span").remove(),this.element.find(".rows").append(t.buildTag("span","",{width:"5px",display:"inline-block"})[0].outerHTML+this._getLocalizedLabels("RowArea"))),(this.element.find(".rowheader").length==0&&this.element.find(".colheader").length==0&&this.element.find(".values .pivotButton").length==0||this.element.find(".pivotGridTable th").length==0)&&(l=t.buildTag("div.emptyRows",t.buildTag("span.rows",this._pivotRow!=""?this._pivotRow:this._getLocalizedLabels("RowArea"),{width:"5px"})[0].outerHTML,{width:140})[0].outerHTML,this.element.find(".rows").length==0?this.element.find(".groupingBarPivot").append(l):"",this.model.enableDeferUpdate&&this._pivotRow!=""&&(this.element.find(".rows").text(""),this.element.find(".rows").append(this._pivotRow)),this.element.find(".emptyRows,.rows").ejDroppable({})),this.element.find(".values").find(".filter").remove(),this.element.find(".values").find(".sorting").remove(),this.element.find(".drag").find(".sorting").remove(),this._dataModel=="Olap"&&this.element.find(".pivotButton").find(".sorting").remove(),this.element.find(".pivotButton .pvtBtn").ejButton({size:"normal",type:t.ButtonType.Button}).ejDraggable({handle:"button",clone:!0,cursorAt:{left:-5,top:-5},dragStart:t.proxy(function(){this._isDragging=!0},this),dragStop:t.proxy(this._onPvtBtnDropped,this),helper:t.proxy(function(t){return n(t.sender.target.parentElement).css({"background-color":n(t.sender.target).css("background-color")}),n(t.sender.target).css({"background-color":n(t.sender.target).css("background-color")}),t.sender.target.className.indexOf("e-btn")>-1?n(t.sender.target).clone().addClass("dragClone").appendTo(this.element):!1},this)}),this.element.find(".drag, .values, .columns, .grpRow, .rows").ejDroppable({}),this.element.find(".pivotGridTable").find("thead th:eq(1)").length>0)this.element.find(".groupingBarPivot").width(this.element.find(".pivotGridTable").width());else if(this.element.find(".pivotGridTable").find("thead").length>0)this.model.isResponsive||this.element.find(".groupingBarPivot").width(this.element.find(".rows").width()+150);else if(this.element.find(".columns .pivotButton").length==0||this.element.find(".values .pivotButton").length==0&&this.element.find(".columns .pivotButton").length==1)this.element.find(".groupingBarPivot").width(300);else{for(e=0,r=0;r<n(this.element.find(".columns .pivotButton")).length;r++)e=Math.max(n(this.element.find(".columns .pivotButton")[r]).width(),e);a=e*n(this.element.find(".columns .pivotButton")).length+this.element.find(".values").width();this.element.find(".groupingBarPivot").width(a)}for((this.element.find(".rows").width()>140||this.model.enableDeferUpdate&&this.element.find(".rows").width()<this.element.find(".grpRow").width())&&(this.enableDeferUpdate?this.element.find(".rows").width(this.element.find(".colheader").length==0?this.element.find(".grpRow").width()-140:this.element.find(".grpRow").width()):this.model.isResponsive||this.element.find(".rows").width(this.model.enableDeferUpdate?this.element.find(".grpRow").width()-8:this.element.find(".grpRow").width())),(this.element.find(".pivotGridTable thead").length>0||this.model.enableDeferUpdate&&this.element.find(".pivotGridTable thead").length==0)&&(this.model.isResponsive&&this.element.find(".values .pivotButton").length==0&&this.element.find(".columns .pivotButton").length==0?this.element.find(".values").width(140):this.element.find(".values").width(this.element.find(".grpRow").length>0?this.model.enableDeferUpdate&&this.element.find(".colheader").length==0?this.element.find(".grpRow").width():this.element.find(".grpRow").width()+4:140),this.model.enableDeferUpdate&&this.element.find(".colheader").length==0&&this.element.find(".pivotGridTable .rowheader").length!=0&&(f=this.element.find(".groupingBarPivot").width()-this.element.find(".values").width(),f<140&&this.element.find(".groupingBarPivot").width(this.element.find(".groupingBarPivot").width()+140)),this.element.find(".pivotGridTable").find("thead th:eq(1)").length>0||this.model.enableDeferUpdate&&this.element.find(".columns .pivotButton").length==0?(u=this.element.find(".pivotGridTable").width()-this.element.find(".values").width()-4,this.element.find(".pivotGridTable").find("thead th:eq(2)").length==0?(this.element.find(".columns").css("min-width",u>=30&&this.element.find(".pivotGridTable .colheader").length==0?140:u),(this.element.find(".columns .pivotButton").length==0||this.model.enableDeferUpdate&&this.element.find(".pivotGridTable .colheader").length==0)&&(this.element.find(".columns .pivotButton").length==0&&(u=this.element.find(".groupingBarPivot").width()-this.element.find(".values").width()-5,this.element.find(".columns").width(u),u<140&&(n(".groupingBarPivot .values .pivotButton").length==1||n(".groupingBarPivot .values .pivotButton").length==0&&this.model.enableDeferUpdate)&&this.element.find(".columns").css("min-width",u+"px")),this.element.find(".columns").addClass("widthSetter"))):u<140?this.element.find(".columns").css("min-width",u).addClass("widthSetter"):this.element.find(".columns").width(u)):this.element.find(".pivotGridTable").find("thead th:eq(1)").length!=0||this.model.enableDeferUpdate||(v=this.element.find(".columns .pivotButton").length<1?1:this.element.find(".columns .pivotButton").length,this.element.find(".columns").addClass("widthSetter"),this.element.find(".columns").css("min-width",(this.element.find(".groupingBarPivot").width()-this.element.find(".values").width()-7)/v))),this.model.dataSource.data!=null&&this.model.url==""&&(h=0,n(".columns .pivotButton").each(function(){h+=parseInt(n(this).width()+10)}),n(".valueColumn").height()>30&&this.element.find(".values button").length==0&&this.element.find(".columns").width()<h&&(c=this.element.find(".columns .pivotButton").length,i=(this.element.find(".valueColumn").width()-this.element.find(".values").width())/(c==0?1:c)-70,this.element.find(".columns .pvtBtn").width(i).css({"text-overflow":"ellipsis"}))),this.element.find(".columns").height()>30?(i=this.model.isResponsive?this.element.find(".columns").width()/this.element.find(".columns .pivotButton").length-5:this.element.find(".columns").width()/2-60,this.element.find(".columns .pvtBtn").width(i).css({"text-overflow":"ellipsis"})):this.element.find(".columns .pivotButton").width()>this.element.find(".columns").width()&&(i=this.element.find(".columns").width()-60,this.element.find(".columns .pvtBtn").width(i).css({"text-overflow":"ellipsis"})),this.element.find(".drag").height()>30&&(i=this.element.find(".groupingBarPivot").width()/4-35,this.element.find(".drag .pvtBtn").width(i).css({"text-overflow":"ellipsis"})),this.element.find(".values").height()>30?(i=this.model.isResponsive?this.element.find(".values").width()/this.element.find(".values .pivotButton").length-5:this.element.find(".values").width()/2-40,this.element.find(".values .pvtBtn").width(i).css({"text-overflow":"ellipsis"})):this.element.find(".values .pivotButton").width()>this.element.find(".values").width()&&(i=this.element.find(".values").width()-40,this.element.find(".values .pvtBtn").width(i).css({"text-overflow":"ellipsis"})),o=0,r=0;r<this.element.find(".rows .pivotButton").length;r++)o=o+this.element.find(".rows .pivotButton:eq("+r+")").width();if(o>this.element.find(".rows").parent().width()&&(i=this.element.find(".rows").width()/2-40,this.element.find(".rows .pvtBtn").width(i).css({"text-overflow":"ellipsis"})),this.model.enableDeferUpdate&&this.element.find(".columns .pivotButton").length!=0){for(s=0,f=0,r=0;this.element.find(".columns .pivotButton").length>r;r++)s=this.element.find(".columns .pivotButton:eq("+r+")").width()+s+7;if(this.element.find(".pivotGridTable .colheader,.pivotGridTable tr:eq(0) .summary").each(function(){f=f+n(this).width()}),s>=f){var y=this.element.find(".pivotGridTable .colheader").length>0?1:0,u=y==0?140:f,i=u/(this.model.enableDeferUpdate?this.element.find(".columns .pivotButton").length:3)-15;this.model.enableDeferUpdate?this.element.find(".columns .pvtBtn").width(30).css({"text-overflow":"ellipsis"}):this.element.find(".columns .pvtBtn").width(i).css({"text-overflow":"ellipsis"})}}(this.element.find(".values").height()>this.element.find(".columns").height()||this.element.find(".columns").height()>this.element.find(".values").height())&&(this.element.find(".values").height()>this.element.find(".columns").height()?this.element.find(".columns").height(this.element.find(".values").height()):this.element.find(".values").height(this.element.find(".columns").height()));this.element.find(".colheader, .rowheader, .value").addClass("e-droppable");this.element.find(".summary").removeClass("e-droppable")},_onPvtBtnDropped:function(i){var w,u,b,k,d,o,f,v,y,p;for(this._isUpdateRequired=!0,w=n(i.target).parents(),o=0;o<w.length;o++)if(w[o].className.split(" ")[0]=="e-pivotschemadesigner"){this.element.find(".dragClone").remove();return}this._isDragging=!1;this.element.find(".dropIndicator").removeClass("dropIndicatorHover");var c=null,h="",s="",e,l=!1,a=!1;if(droppedClass=i.target.className.indexOf("e-droppable")>=0?i.target.className.split(" ")[0]:"",droppedClass=droppedClass=="grpRow"?"rows":droppedClass,this._dataModel=="Pivot"||this._dataModel=="XMLA"){if(n(i.target).hasClass("pvtBtn")&&this.model.operationalMode!=t.PivotGrid.OperationalMode.ServerMode&&(droppedClass=n(i.target).attr("axis").toLowerCase()),this._dataModel=="XMLA"){if(e=i.element.attr("fieldName"),u=n.grep(this.model.dataSource.columns,function(n){return n.fieldName==e}),u.length==0&&(u=n.grep(this.model.dataSource.rows,function(n){return n.fieldName==e})),u.length==0&&(u=n.grep(this.model.dataSource.filters,function(n){return n.fieldName==e})),b=u.length>0&&u[0].isNamedSets!=r&&u[0].isNamedSets==!0&&(droppedClass=="values"||droppedClass=="drag"),k=(droppedClass=="drag"||droppedClass=="filters")&&e.indexOf(""+this._getLocalizedLabels("Measures")+"")>=0,b||k||e.toLowerCase().indexOf("[measures]")>=0&&droppedClass!=""&&droppedClass!="values"||droppedClass!=""&&droppedClass=="values"&&!(e.toLowerCase().indexOf("[measures]")>=0))return this.element.find(".dragClone,.dropIndicator").remove(),i.element.parent().removeAttr("style"),i.element.css("background-color","inherit"),i.Cancel;if(e.toLowerCase().indexOf("measures")>=0&&!(e.toLowerCase().indexOf("[measures]")>=0))return n(i.element.parent()).remove(),t.isNullOrUndefined(this._schemaData)||(d=n(i.element).attr("axis")=="Columns"?"schemaColumn":"schemaRow",this._schemaData.element.find("."+d+" .pivotButton:contains('"+this._getLocalizedLabels("Measures")+"')").remove()),e.toLowerCase().indexOf("Measures")>=0&&droppedClass==""||droppedClass!="rows"&&droppedClass!="columns"?(this.model.dataSource.values[0].measures=[],t.isNullOrUndefined(this._schemaData)||this._schemaData.element.find(".schemaValue .pivotButton").remove()):(this.model.dataSource.values[0].axis=droppedClass,t.isNullOrUndefined(this._schemaData)||this._schemaData._createPivotButton({fieldName:"Measures",fieldCaption:this._getLocalizedLabels("Measures")},droppedClass=="rows"?"row":droppedClass=="columns"?"column":droppedClass=="drag"?"filter":droppedClass=="values"?"value":"",l,a,0)),this._ogridWaitingPopup.show(),this.getJSONData({action:"pvtBtnDropped"},this.model.dataSource,this),!1}else e=i.element.text(),l=i.element.find("~ .filterIndicator").length>0?!0:!1,a=i.element.find("~ span:eq(0) span.descending").length>0?!0:!1;for(droppedClass==""&&(i.target.tagName=="BUTTON"||i.target.tagName=="SPAN")&&(droppedClass=i.target.parentNode.parentElement.className.split(" ")[0]),o=0;o<this._pivotTableFields.length;o++)this._pivotTableFields[o].name==e&&(this._pivotTableFields[o].isSelected=!0,s=this._pivotTableFields[o])}else c=i.target.className.indexOf("pvtBtn")>-1?n(i.target).parents(".e-droppable")[0]:i.target.className.indexOf("e-droppable")?i.target:i.target[0].tagName.toLowerCase()=="td"?i.target.children(":last")[0]:i.target,h=c.className.split(" ")[0]=="columns"?"Categorical":c.className.split(" ")[0]=="rows"||c.className.split(" ")[0]=="grpRow"?"Series":c.className.split(" ")[0]=="filters"?"Slicer":"",h==""&&i.element.parent().attr("tag").indexOf("[Measures]")>-1&&(h=this.element.find(".schemaRow .pivotButton:contains('"+this._getLocalizedLabels("Measures")+"')").length>0?"Series":"Categorical"),s=n(i.element.parent()[0]).attr("tag"),droppedClass=c.className.split(" ")[0],droppedClass=droppedClass=="grpRow"?"rows":droppedClass,h=h=="grpRow"?"Series":h,e=i.element.text();if(this.element.find(".dragClone").remove(),this._dataModel=="Olap"&&(s.split(":")[1].toLocaleUpperCase()=="MEASURES"&&(droppedClass!="columns"||droppedClass!="rows")&&(droppedClass=="drag"||droppedClass=="values")||s.toUpperCase().indexOf("[MEASURES]")>-1&&droppedClass!="values"&&(droppedClass=="rows"||droppedClass=="columns"||droppedClass=="drag")||s.toUpperCase().indexOf("[MEASURES]")==-1&&droppedClass=="values"))return this._createErrorDialog(this._getLocalizedLabels("AlertMsg"),"Error"),this.element.find(".dragClone,.dropIndicator").remove(),i.element.parent().removeAttr("style"),i.element.css("background-color","inherit"),!1;if(droppedClass=="rows"||droppedClass=="columns"||droppedClass=="values"||droppedClass=="drag"){f=this._setSplitBtnTargetPos(i,droppedClass,"drop");v=this._setSplitBtnTargetPos(i,droppedClass,"original");droppedClass=="drag"&&this.element.find(".drag").text("");try{report=JSON.parse(this.getOlapReport()).Report}catch(nt){report=this.getOlapReport()}if(this._dataModel=="XMLA"&&(report=this.model.dataSource),n(i.element.parent()).remove(),this.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode)y=i.element.parents(".pivotButton").attr("tag").split(":")[0],this._ogridWaitingPopup=this.element.data("ejWaitingPopup"),t.isNullOrUndefined(this._ogridWaitingPopup)||this._ogridWaitingPopup.show(),n.isNumeric(f)&&droppedClass==y.toLowerCase()&&f>v&&(f=f-1),this._schemaData!=null&&(this._dataModel=="Pivot"?(this._schemaData.element.find("#pivotButton"+e).parent().remove(),this._schemaData._createPivotButton(e,droppedClass=="rows"?"row":droppedClass=="columns"?"column":droppedClass=="drag"?"filter":droppedClass=="values"?"value":"",l,a,f)):(this._schemaData.element.find("div[tag ^='"+s+"']").remove(),this._schemaData._createPivotButton(s.split(":")[1],droppedClass=="rows"?"row":droppedClass=="columns"?"column":droppedClass=="drag"?"filter":droppedClass=="values"?"value":"",l,a,f))),droppedClass=droppedClass=="rows"?"schemaRow":droppedClass=="columns"?"schemaColumn":droppedClass=="drag"?"schemaFilter":droppedClass=="values"?"schemaValue":"",this._dataModel=="Olap"?(params=JSON.parse(this._olapReport).CurrentCube+"--"+s+"--"+h+"--"+f,this.model.beforeServiceInvoke!=null&&this._trigger("beforeServiceInvoke",{action:"nodeDropped",element:this.element,customObject:this.model.customObject}),p=JSON.stringify(this.model.customObject),eventArgs=JSON.stringify({action:"nodeDropped",dropType:"SplitButton",nodeInfo:params,currentReport:report,gridLayout:this.model.layout,customObject:p}),this.model.enableDeferUpdate?(t.isNullOrUndefined(this._ogridWaitingPopup)||this._ogridWaitingPopup.hide(),this.doAjaxPost("POST",this.model.url+"/"+this.model.serviceMethodSettings.nodeDropped,eventArgs.replace("nodeDropped","nodeDroppedDeferUpdate"),this._pvtBtnDroppedSuccess)):this.doAjaxPost("POST",this.model.url+"/"+this.model.serviceMethodSettings.nodeDropped,eventArgs,this._pvtBtnDroppedSuccess)):(this.model.beforeServiceInvoke!=null&&this._trigger("beforeServiceInvoke",{action:"nodeDropped",element:this.element,customObject:this.model.customObject}),p=JSON.stringify(this.model.customObject),eventArgs=JSON.stringify({action:"nodeDropped",dropAxis:droppedClass+"::"+f,headerTag:JSON.stringify(s),sortedHeaders:this._ascdes,currentReport:report,customObject:p}),successMethod=this._renderControlSuccess,this.model.enableDeferUpdate?(t.isNullOrUndefined(this._ogridWaitingPopup)||this._ogridWaitingPopup.hide(),this.doAjaxPost("POST",this.model.url+"/"+this.model.serviceMethodSettings.nodeDropped,eventArgs.replace("nodeDropped","nodeDroppedDeferUpdate"),this._pvtBtnDroppedSuccess)):this.doAjaxPost("POST",this.model.url+"/"+this.model.serviceMethodSettings.nodeDropped,eventArgs,this._pvtBtnDroppedSuccess));else{var u=this._getDroppedItem(e),g={fieldName:u[0].fieldName,fieldCaption:u[0].fieldCaption},y=i.element.parents(".pivotButton").attr("tag").split(":")[0];this._dataModel=="XMLA"&&u.length>0&&droppedClass=="drag"&&(u[0].advancedFilter=[]);n.isNumeric(f)?droppedClass==y.toLowerCase()&&f>v?droppedClass=="rows"?this.model.dataSource.rows.splice(f-1,0,u[0]):droppedClass=="columns"?this.model.dataSource.columns.splice(f-1,0,u[0]):droppedClass=="values"?this._dataModel=="XMLA"?this.model.dataSource.values[0].measures.splice(f-1,0,u[0]):this.model.dataSource.values.splice(f,0,u[0]):this.model.dataSource.filters.splice(f,0,u[0]):droppedClass=="rows"?this.model.dataSource.rows.splice(f,0,u[0]):droppedClass=="columns"?this.model.dataSource.columns.splice(f,0,u[0]):droppedClass=="values"?this._dataModel=="XMLA"?this.model.dataSource.values[0].measures.splice(f,0,u[0]):this.model.dataSource.values.splice(f,0,u[0]):this.model.dataSource.filters.splice(f,0,u[0]):droppedClass=="rows"?this.model.dataSource.rows.push(u[0]):droppedClass=="columns"?this.model.dataSource.columns.push(u[0]):droppedClass=="values"?this._dataModel=="XMLA"?this.model.dataSource.values[0].measures.push(u[0]):this.model.dataSource.values.push(u[0]):this.model.dataSource.filters.push(u[0]);this._dataModel=="XMLA"&&(this.model.dataSource=this._clearDrilledItems(this.model.dataSource,{action:"pvtBtnDropped"}));this._schemaData!=null&&(droppedClass==y&&f>v&&(f=f-1),this._dataModel=="XMLA"?this._schemaData.element.find("button[fieldName='"+e+"']").remove():this._schemaData.element.find("#pivotButton"+e).parent().remove(),this._schemaData._createPivotButton(g,droppedClass=="rows"?"row":droppedClass=="columns"?"column":droppedClass=="drag"?"filter":droppedClass=="values"?"value":"",l,a,f));this._dataModel=="XMLA"?(t.isNullOrUndefined(this._ogridWaitingPopup)||this._ogridWaitingPopup.show(),this.getJSONData({action:"pvtBtnDropped"},this.model.dataSource,this)):this._populatePivotGrid()}}else this._removePvtBtn(i)},_getReportItem:function(t){var r="columns",i=n.grep(this.model.dataSource.columns,function(n){return n.fieldName.toLowerCase()==t.toLowerCase()}),u;return i.length==0&&(i=n.grep(this.model.dataSource.rows,function(n){return n.fieldName.toLowerCase()==t.toLowerCase()}),r="rows"),i.length==0&&(u=this._dataModel=="XMLA"?this.model.dataSource.values[0].measures:this.model.dataSource.values,i=n.grep(u,function(n){return n.fieldName.toLowerCase()==t.toLowerCase()}),r="values"),i.length==0&&(i=n.grep(this.model.dataSource.filters,function(n){return n.fieldName.toLowerCase()==t.toLowerCase()}),r="filters"),{item:i,axis:r}},_getDroppedItem:function(t){var u=this._dataModel=="XMLA"?!0:!1,i=n.grep(this.model.dataSource.columns,function(n){return n.fieldName==t}),r;return i.length>0?this.model.dataSource.columns=n.grep(this.model.dataSource.columns,function(n){return n.fieldName!=t}):(i=n.grep(this.model.dataSource.rows,function(n){return n.fieldName==t}),i.length>0?this.model.dataSource.rows=n.grep(this.model.dataSource.rows,function(n){return n.fieldName!=t}):(r=this.model.dataSource.values,this._dataModel=="XMLA"&&(r=this.model.dataSource.values[0].measures),i=n.grep(r,function(n){return n.fieldName==t}),i.length>0?this._dataModel=="XMLA"?this.model.dataSource.values[0].measures=n.grep(r,function(n){return n.fieldName!=t}):this.model.dataSource.values=n.grep(r,function(n){return n.fieldName!=t}):(i=n.grep(this.model.dataSource.filters,function(n){return n.fieldName==t}),i.length>0&&(this.model.dataSource.filters=n.grep(this.model.dataSource.filters,function(n){return n.fieldName!=t}))))),i},_clearDrilledItems:function(i,u){var f=u.action;return i.rows=n.grep(i.rows,function(n){return n.filterItems!=r&&f!="filtering"?delete n.filterItems:n,n.filterItems!=r&&f!="advancedFilter"?delete n.advancedFilter:n,n.drilledItems!=r?delete n.drilledItems:n,n}),i.columns=n.grep(i.columns,function(n){return n.filterItems!=r&&f!="filtering"?delete n.filterItems:n,n.filterItems!=r&&f!="advancedFilter"?delete n.advancedFilter:n,n.drilledItems!=r?delete n.drilledItems:n,n}),i.filters=n.grep(i.filters,function(n){return n.filterItems!=r&&f!="filtering"?delete n.filterItems:n,n.filterItems!=r&&f!="advancedFilter"?delete n.advancedFilter:n,n.drilledItems!=r?delete n.drilledItems:n,n}),f!="filtering"&&(this._currentReportItems=[],t.isNullOrUndefined(this._schemaData)||this._schemaData.element.find(".filter").remove()),this._drilledCellSet=[],i},_clearCollapsedItems:function(t,i,u){return t=="rowheader"?u.rows=n.map(u.rows,function(t){return t.drilledItems!=r&&t.drilledItems.length&&(t.drilledItems=n.map(t.drilledItems,function(n){if(n.join("").indexOf(i.repItms.replace(/&/g,"&amp;"))<0)return[n]})),t}):t=="colheader"&&(u.columns=n.map(u.columns,function(t){return t.drilledItems!=r&&t.drilledItems.length&&(t.drilledItems=n.map(t.drilledItems,function(n){if(n.join("").indexOf(i.repItms.replace(/&/g,"&amp;"))<0)return[n]})),t})),u},_setSplitBtnTargetPos:function(t,i,r){var e="",f,o,u;for(o=r=="drop"?n(t.target).parents(".pivotButton"):n(t.element).parents(".pivotButton"),f=this.element.find("."+i)[0],u=0;u<f.children.length;u++)n(f.childNodes[u]).attr("tag")==n(o).attr("tag")&&(e=u);return e},_pvtBtnDroppedSuccess:function(n){!t.isNullOrUndefined(n[0])&&n.length>0?n[2]!=null&&n[2]!=r&&(this.model.customObject=n[2].Value):!t.isNullOrUndefined(n.d)&&n.d.length>0?n.d[2]!=null&&n.d[2]!=r&&(this.model.customObject=n.d[2].Value):t.isNullOrUndefined(n)||t.isNullOrUndefined(n.OlapReport)||n!=null&&n.customObject!=r&&(this.model.customObject=n.customObject);this.model.afterServiceInvoke!=null&&this._trigger("afterServiceInvoke",{action:"nodeDropped",element:this.element,customObject:this.model.customObject});this.model.enableDeferUpdate?this._deferUpdateSuccess(n):this._renderControlSuccess(n)},_deferUpdateSuccess:function(i){t.isNullOrUndefined(i.PivotReport)&&t.isNullOrUndefined(i.OlapReport)?(this.setOlapReport(i.d[0].Value),n(".e-pivotpager")[0]!=null&&n(".e-pivotpager")[0]!=r&&this.model.pivotControl._pagerObj.initPagerProperties(JSON.parse(i.d[2].Value),JSON.parse(i.d[1].Value))):(t.isNullOrUndefined(i.PivotReport)?this.setOlapReport(i.OlapReport):this.setOlapReport(i.PivotReport),i.HeaderCounts!=r&&n(".e-pivotpager")[0]!=null&&n(".e-pivotpager")[0]!=r&&this.model.pivotControl._pagerObj.initPagerProperties(JSON.parse(i.HeaderCounts),JSON.parse(i.PageSettings)));this.model.enableGroupingBar&&(report=JSON.parse(this.getOlapReport()),this._pivotTableFields=JSON.parse(report.ItemsProperties),this._createGroupingBar(report),this.element.find(".grpRow .rows").text(""),this.element.find(".grpRow .rows").children().remove(),this.element.find(".grpRow .rows").append(this._pivotRow),this._createFields(null,n("#"+this._id).find(".pivotGridTable").width(),n("#"+this._id).find(".pivotGridTable th").outerWidth()))},_removePvtBtn:function(i){var a,h,f,u,s,r,v,o,l,c;if(this._isUpdateRequired=!0,this.model.operationalMode==t.PivotGrid.OperationalMode.ClientMode){if(i.type=="click"){var f=n(n(i.target).siblings()[0]).attr("fieldName"),e="",s="";a=n(n(i.target).siblings()[0]).text()}else{var f=i.element.attr("fieldName"),e="",s="";a=i.element.text()}for(r=0;r<this.element.find(".pivotButton").length;r++)s=n(this.element.find(".pivotButton")[r]).find("button").attr("fieldName"),s==f&&(e=n(this.element.find(".pivotButton")[r]));if(n(e).remove(),this._schemaData!=null){if(l=this._dataModel=="XMLA"?this._schemaData._tableTreeObj.element.find("li [tag='"+f+"']"):this._schemaData._tableTreeObj.element.find("li:contains('"+f+"')"),this._dataModel=="XMLA"&&l.length==0&&f.toLowerCase()=="measures"){for(this._schemaData.element.find("div[tag='"+e.attr("tag")+"']").remove(),r=0;r<this.model.dataSource.values[0].measures.length;r++)this._schemaData._nodeCheck=!0,selectedTreeNode=this._schemaData._tableTreeObj.element.find("li[tag='"+this.model.dataSource.values[0].measures[r].fieldName+"']"),this._schemaData._tableTreeObj.uncheckNode(selectedTreeNode),this.element.find("div[tag='values:"+this.model.dataSource.values[0].measures[r].fieldName+"']").remove(),this._schemaData.element.find("div[tag='values:"+this.model.dataSource.values[0].measures[r].fieldName+"']").remove();this.model.dataSource.values[0].measures=[];t.isNullOrUndefined(this._ogridWaitingPopup)||this._ogridWaitingPopup.show();this.getJSONData({action:"removeBtn"},this.model.dataSource,this)}this._schemaData._tableTreeObj.uncheckNode(l)}else this.model.dataSource.columns=n.grep(this.model.dataSource.columns,function(n){return n.fieldName!=f}),this.model.dataSource.rows=n.grep(this.model.dataSource.rows,function(n){return n.fieldName!=f}),this._dataModel=="XMLA"?e.attr("tag").split(":")[1].toLowerCase()=="measures"?this.model.dataSource.values[0].measures=[]:this._getItemPosition(this.model.dataSource.values[0].measures,e.attr("tag").split(":")[1]).length>0&&this.model.dataSource.values[0].measures.splice(this._getItemPosition(this.model.dataSource.values[0].measures,e.attr("tag").split(":")[1])[0],1):this.model.dataSource.values=n.grep(this.model.dataSource.values,function(n){return n.fieldName!=f}),this.model.dataSource.filters=n.grep(this.model.dataSource.filters,function(n){return n.fieldName!=f}),this._dataModel!="XMLA"?this._populatePivotGrid():(t.isNullOrUndefined(this._ogridWaitingPopup)||this._ogridWaitingPopup.show(),this.model.dataSource=this._clearDrilledItems(this.model.dataSource,{action:"removeButton"}),this.getJSONData({action:"removeButton"},this.model.dataSource,this))}else{for(i.type=="click"?f=n(n(i.target).siblings()[1]).text():(f=i.element.text(),u=i.element.parent().attr("tag")),filterTag="",filterItems="",e="",u="",s="",h="",e=this.element.find(".pivotButton:contains("+f+")"),r=0;r<this._pivotTableFields.length;r++)this._pivotTableFields[r].name==f&&(this._pivotTableFields[r].isSelected=!1,u=this._pivotTableFields[r]);try{h=JSON.parse(this.getOlapReport()).Report}catch(y){h=this.getOlapReport()}if(this._dataModel=="Olap")if(u=n(e).attr("tag"),s=u.indexOf("[Measures]")>-1||u.indexOf("[")>-1?u.split(":")[1]:this._getNodeUniqueName(u),s=="[Measures]"){if(e.remove(),!t.isNullOrUndefined(this._schemaData)){for(this._schemaData.element.find(".pivotButton:contains("+f+")").remove(),r=0;r<this._schemaData.model.pivotCalculations.length&&u.indexOf("Measures")>-1;r++)s=this._schemaData.model.pivotCalculations[r].Tag,this._schemaData._isMeasureBtnRemove=!0,selectedTreeNode=this._getNodeByUniqueName(s),this._schemaData._tableTreeObj.uncheckNode(selectedTreeNode);this._schemaData.element.find(".schemaNoClick").addClass("freeze")}this._ogridWaitingPopup.show();this.model.beforeServiceInvoke!=null&&this._trigger("beforeServiceInvoke",{action:"removeButton",element:this.element,customObject:this.model.customObject});c=JSON.stringify(this.model.customObject);o=JSON.stringify({action:"removeButton",headerInfo:u,currentReport:h,gridLayout:this.model.layout,customObject:c});!t.isNullOrUndefined(this._schemaData)&&u.indexOf("[Measures]")<0&&u.indexOf("Measures")>=0&&this._schemaData.element.find(".schemaValue .pivotButton").remove();this.model.enableDeferUpdate?(this._removeButtonDeferUpdate=!0,this.doAjaxPost("POST",this.model.url+"/"+this._schemaData.model.serviceMethods.removeButton,o.replace("removeButton","removeButtonDeferUpdate"),this._onDroppedSuccess),this.element.find(".schemaNoClick").removeClass("freeze")):this.doAjaxPost("POST",this.model.url+"/RemoveButton",o,this._pvtBtnDroppedSuccess)}else if(t.isNullOrUndefined(this._schemaData)){if(c=JSON.stringify(this.model.customObject),o=JSON.stringify({action:"removeButton",headerInfo:u,currentReport:h,gridLayout:this.model.layout,customObject:c}),t.isNullOrUndefined(u))return!1;t.isNullOrUndefined(this._ogridWaitingPopup)||this._ogridWaitingPopup.show();this.model.enableDeferUpdate?this.doAjaxPost("POST",this.model.url+"/"+this.model.serviceMethodSettings.removeButton,o.replace("removeButton","removeButtonDeferUpdate"),this._pvtBtnDroppedSuccess):this.doAjaxPost("POST",this.model.url+"/RemoveButton",o,this._pvtBtnDroppedSuccess)}else selectedTreeNode=this._getNodeByUniqueName(s),this._schemaData._tableTreeObj.uncheckNode(selectedTreeNode);else filterTag="schemaRow::"+f+"::FILTERED"+filterItems,v=this._droppedClass!=""?this._droppedClass:u.pivotType=="PivotItem"?"schemaRow":"schemaValue",this._droppedClass="",n(e).remove(),this._ogridWaitingPopup=this.element.data("ejWaitingPopup"),t.isNullOrUndefined(this._ogridWaitingPopup)||this._ogridWaitingPopup.show(),this._schemaData!=null?(l=this._schemaData._tableTreeObj.element.find("li:contains('"+f+"')"),this._schemaData._tableTreeObj.uncheckNode(l)):(this.model.beforeServiceInvoke!=null&&this._trigger("beforeServiceInvoke",{action:"nodeStateModified",element:this.element,customObject:this.model.customObject}),c=JSON.stringify(this.model.customObject),o=JSON.stringify({action:"nodeStateModified",headerTag:JSON.stringify(u),dropAxis:v+"::",sortedHeaders:this._ascdes,filterParams:filterTag,currentReport:h,customObject:c}),this.model.enableDeferUpdate?(this.doAjaxPost("POST",this.model.url+"/nodeStateModified",o.replace("nodeStateModified","nodeStateModifiedDeferUpdate"),this._nodeStateModifiedSuccess),t.isNullOrUndefined(this._ogridWaitingPopup)||this._ogridWaitingPopup.hide()):this.doAjaxPost("POST",this.model.url+"/nodeStateModified",o,this._nodeStateModifiedSuccess))}},_getNodeUniqueName:function(n){for(var t="",i=0;i<n.split(":")[1].split(".").length;i++)t!=""&&(t+="."),t+="["+n.split(":")[1].split(".")[i]+"]";return t},_getNodeByUniqueName:function(t){for(var r=null,i=0;i<n(this._schemaData._tableTreeObj.element.find("li")).length;i++)n(this._schemaData._tableTreeObj.element.find("li")[i]).attr("tag").toLowerCase()==t.toLowerCase()&&(r=n(this._schemaData._tableTreeObj.element.find("li")[i]));return r},_nodeStateModifiedSuccess:function(n){n[0]!=r?n[2]!=null&&n[2]!=r&&(this.model.customObject=n[2].Value):n.d!=r?n.d[2]!=null&&n.d[2]!=r&&(this.model.customObject=n.d[2].Value):n.customObject!=null&&n.customObject!=r&&(this.model.customObject=n.customObject);this.model.afterServiceInvoke!=null&&this._trigger("afterServiceInvoke",{action:"nodeStateModified",element:this.element,customObject:this.model.customObject});this.model.enableDeferUpdate?this._deferUpdateSuccess(n):this._renderControlSuccess(n)},_drillDownSuccess:function(t){t[0]!=r?(this.setJSONRecords(t[0].Value),this.setOlapReport(t[1].Value),typeof oclientProxy!="undefined"&&(oclientProxy.currentReport=JSON.parse(t[1].Value).Report,t[2].Value!=r&&t[2].Value!="undefined"&&(oclientProxy.reports=t[2].Value)),t[3]!=null&&t[3]!=r&&t[3].Key=="PageSettings"&&(this.model.enableVirtualScrolling?(this._categPageCount=Math.ceil(JSON.parse(t[4].Value).Column/JSON.parse(t[3].Value).CategorialPageSize),this._seriesPageCount=Math.ceil(JSON.parse(t[4].Value).Row/JSON.parse(t[3].Value).SeriesPageSize),this._categCurrentPage=JSON.parse(t[3].Value).CategorialCurrentPage,this._seriesCurrentPage=JSON.parse(t[3].Value).SeriesPageSize):n(".e-pivotpager")[0]!=null&&n(".e-pivotpager")[0]!=r&&this._pagerObj.initPagerProperties(JSON.parse(t[4].Value),JSON.parse(t[3].Value)),t[5]!=null&&t[5]!=r&&(this.model.customObject=t[5].Value)),t[3]!=null&&t[3]!=r&&t[3].Key!="PageSettings"&&(this.model.customObject=t[3].Value)):t.d!=r?(this.setJSONRecords(t.d[0].Value),this.setOlapReport(t.d[1].Value),typeof oclientProxy!="undefined"&&(oclientProxy.currentReport=JSON.parse(t.d[1].Value).Report,t.d[2].Value!=r&&t.d[2].Value!="undefined"&&(oclientProxy.reports=t.d[2].Value)),t.d[3]!=null&&t.d[3]!=r&&t.d[3].Key=="PageSettings"&&(this.model.enableVirtualScrolling?(this._categPageCount=Math.ceil(JSON.parse(t.d[4].Value).Column/JSON.parse(t.d[3].Value).CategorialPageSize),this._seriesPageCount=Math.ceil(JSON.parse(t.d[4].Value).Row/JSON.parse(t.d[3].Value).SeriesPageSize),this._categCurrentPage=JSON.parse(t.d[3].Value).CategorialCurrentPage,this._seriesCurrentPage=JSON.parse(t.d[3].Value).SeriesCurrentPage):n(".e-pivotpager")[0]!=null&&n(".e-pivotpager")[0]!=r&&this._pagerObj.initPagerProperties(JSON.parse(t.d[4].Value),JSON.parse(t.d[3].Value)),t.d[5]!=null&&t.d[5]!=r&&(this.model.customObject=t.d[5].Value)),t.d[3]!=null&&t.d[3]!=r&&t.d[3].Key!="PageSettings"&&(this.model.customObject=t.d[3].Value)):(this.setJSONRecords(t.PivotRecords),this.setOlapReport(t.OlapReport),typeof oclientProxy!="undefined"&&(oclientProxy.currentReport=JSON.parse(t.OlapReport).Report,t.ClientReports!=r&&t.ClientReports!="undefined"&&(oclientProxy.reports=t.ClientReports)),t.PageSettings!=r&&t.PageSettings!=null&&(this.model.enableVirtualScrolling?(this._categPageCount=Math.ceil(JSON.parse(t.HeaderCounts).Column/JSON.parse(t.PageSettings).CategorialPageSize),this._seriesPageCount=Math.ceil(JSON.parse(t.HeaderCounts).Row/JSON.parse(t.PageSettings).SeriesPageSize),this._categCurrentPage=JSON.parse(t.PageSettings).CategorialCurrentPage,this._seriesCurrentPage=JSON.parse(t.PageSettings).SeriesCurrentPage):n(".e-pivotpager")[0]!=null&&n(".e-pivotpager")[0]!=r&&this._pagerObj.initPagerProperties(JSON.parse(t.HeaderCounts),JSON.parse(t.PageSettings))),t.customObject!=null&&t.customObject!=r&&(this.model.customObject=t.customObject));this.model.afterServiceInvoke!=null&&this._trigger("afterServiceInvoke",{action:"drillDown",element:this.element,customObject:this.model.customObject});this.renderControlFromJSON(this.getJSONRecords());try{this.model.currentReport=JSON.parse(this.getOlapReport()).Report}catch(u){this.model.currentReport=this.getOlapReport()}this._trigger("drillSuccess",this.element);typeof oclientWaitingPopup!="undefined"&&oclientWaitingPopup!=null?n("#"+oclientProxy._id+"_maxView")[0]&&this._maxViewLoading?(this._maxViewLoading.hide(),oclientWaitingPopup.hide()):oclientProxy.model.displaySettings.mode=="gridOnly"&&oclientWaitingPopup.hide():typeof oclientProxy!="undefined"?(!oclientProxy||oclientProxy.ogridObj._startDrilldown||oclientProxy.ochartObj._startDrilldown)&&oclientProxy.model.displaySettings.mode!="gridOnly"||oclientWaitingPopup.hide():typeof oclientWaitingPopup=="undefined"&&(this._ogridWaitingPopup=n("#"+this._id).data("ejWaitingPopup"),this._ogridWaitingPopup.hide());typeof oclientProxy!="undefined"?oclientProxy.ogridObj._startDrilldown=!1:this._ogridWaitingPopup.hide();var i={action:this._drillAction,customObject:this.model.customObject,element:this.element};this._trigger("renderSuccess",i)},doAjaxPost:function(i,u,f,e,o,s){var h,c,l,a=!0;f.XMLA==r?(h="application/json; charset=utf-8",c="json",l=n.proxy(e,this)):(h="text/xml",c="xml",f=f.XMLA,l=n.proxy(e,t.olap.base,s),a=!t.isNullOrUndefined(s)&&s.action!="loadFieldElements"?!0:!1);n.ajax({type:i,url:u,contentType:h,async:a,dataType:c,data:f,success:l,complete:t.proxy(function(t){n.proxy(t,this);var i={action:this._currentAction,customObject:this.model.customObject,element:this.element};this._trigger("renderComplete",i)},this),error:t.proxy(function(n){typeof this._ogridWaitingPopup!="undefined"&&this._ogridWaitingPopup!=null&&this._ogridWaitingPopup.hide();typeof oclientWaitingPopup!="undefined"&&oclientWaitingPopup!=null&&oclientWaitingPopup.hide();var t={action:this._drillAction!=""?this._drillAction:"initialize",customObject:this.model.customObject,element:this.element,Message:n};this._trigger("renderFailure",t);this.renderControlFromJSON("");this._dataModel=="XMLA"&&this._createErrorDialog(n.statusText,"Error");n.statusText},this)})},doPostBack:function(t,i){var r=n("<form>").attr({action:t,method:"POST",name:"export"}),f=function(t,i){var u=n('<input type="hidden" title="params">').attr({id:t,name:t,value:i}).appendTo(r)};for(var u in i)f(u,i[u]);r.appendTo(document.body).submit().remove()},refreshPagedPivotGrid:function(i,r){this._isUpdateRequired=!0;typeof oclientWaitingPopup=="undefined"&&(this._ogridWaitingPopup=n("#"+this._id).data("ejWaitingPopup"),this._ogridWaitingPopup.show());i=i.indexOf("categ")!=-1?"categorical":"series";var u;try{u=JSON.parse(this.getOlapReport()).Report}catch(f){u=this.getOlapReport()}this.model.enableDeferUpdate?(this.doAjaxPost("POST",this.model.url+"/"+this.model.serviceMethodSettings.paging,JSON.stringify({action:"pagingDeferUpdate",pagingInfo:i+":"+r,currentReport:u,layout:this.layout(),customObject:null}),this._deferUpdateSuccess),t.isNullOrUndefined(this._ogridWaitingPopup)||this._ogridWaitingPopup.hide()):this.doAjaxPost("POST",this.model.url+"/"+this.model.serviceMethodSettings.paging,JSON.stringify({action:"paging",pagingInfo:i+":"+r,currentReport:u,layout:this.layout(),customObject:null}),this._renderControlSuccess)},renderControlFromJSON:function(i){var o=n('<table class="pivotGridTable" cellspacing="0" cellpadding="0" role=\'grid\'  aria-readonly=\'true\'><\/table>'),nt,tt,ot,h,r,ft,et,b,k,p,l,s,v,a,y,d,g,u,f,c,e;if(this.model.isResponsive&&o.addClass("e-table"),(i!=null&&i!=""||this.model.enableGroupingBar)&&this._dataModel!=""){if(i!=null&&i!=""){for(this._rowCount=0,ot=this,s=0;s<i.length;s++)if(parseInt(i[s].Index.split(",")[0])==0)this._rowCount++;else break;var it=n("<thead><\/thead>"),rt=n("<tbody><\/tbody>"),ut=!0,w=0;for(i[0].CSS=="none"?w=i[0].RowSpan-1:(jQuery.each(i,function(n){return w+=i[n].RowSpan,i[n].CSS=="colheader"}),w=w-2),s=0;s<i.length;s++)if(s<this._rowCount)if(ut){for(ut=s>=w?!1:!0,h="<tr role='row'>",r=s;r<i.length;r=r+this._rowCount)if(i[r].Span!="Block")if(h=i[r].Index=="0,0"&&i[r].CSS!="colheader"&&this.model.enableGroupingBar?h+"<th class=grpRow p="+i[r].Index+" colspan="+i[r].ColSpan+" rowspan="+i[r].RowSpan+" role='columnheader'>"+(i[r].State==0?'<span style="margin-left: 0px"><\/span>':i[r].State==2?'<span class="expand e-icon">&nbsp;<\/span>':i[r].State==1?'<span class="collapse e-icon" title="Collapsed">&nbsp;<\/span>':"")+i[r].Value+t.buildTag("div.rows",this._pivotRow,{})[0].outerHTML+"<\/th>":h+"<th"+(i[r].CSS=="none"?"":' class="'+i[r].CSS)+(i[r].CSS=="none"?" p="+i[r].Index:'" p='+i[r].Index)+" colspan="+i[r].ColSpan+" rowspan="+i[r].RowSpan+" role='columnheader'>"+(i[r].State==0?'<span style="margin-left: 10px"><\/span>':i[r].State==2?'<span class="expand e-icon">&nbsp;<\/span>':i[r].State==1?'<span class="collapse e-icon" title="Collapsed">&nbsp;<\/span>':"")+t.buildTag("span.cellValue",i[r].Value)[0].outerHTML+"<\/th>",i[r].RowSpan>1&&i[r].ColSpan<=1)for(u=r+1;u<r+i[r].RowSpan;u++)i[u].Span="Block";else if(i[r].ColSpan>1&&i[r].RowSpan<=1)for(u=r+this._rowCount;u<r+i[r].ColSpan*this._rowCount;u=u+this._rowCount)i[u].Span="Block";else if(i[r].ColSpan>1&&i[r].RowSpan>1)for(u=r;u<r+i[r].RowSpan;u++){for(e=u+this._rowCount;e<u+i[r].ColSpan*this._rowCount;e=e+this._rowCount)i[e].Span="Block";u!=r&&(i[u].Span="Block")}h+="<\/tr>";n(h).children().length>0&&n(it).append(h)}else{for(h="<tr role='row'>",r=s;r<i.length;r=r+this._rowCount)if(i[r].Span!="Block")if(h=i[r].CSS=="rowheader"||i[r].CSS=="summary"||i[r].CSS=="summary"?this.layout().toLowerCase()=="excellikelayout"?h+"<th"+(i[r].CSS=="none"?"":' class="'+i[r].CSS)+'" p='+i[r].Index+" colspan="+i[r].ColSpan+" rowspan="+i[r].RowSpan+" role='rowheader'>"+(i[r].State==2?'<span style="margin-left:'+i[r].Level*10+'px" class="expand e-icon">&nbsp;<\/span>':i[r].State==1?'<span style="margin-left:'+i[r].Level*10+'px" class="collapse e-icon">&nbsp;<\/span>':'<span style="margin-left:'+(i[r].Level+=i[r].Level==1?0:2)*10+'px">&nbsp;<\/span>')+t.buildTag("span.cellValue",i[r].Value)[0].outerHTML+"<\/th>":h+"<th"+(i[r].CSS=="none"?"":' class="'+i[r].CSS)+'" p='+i[r].Index+" colspan="+i[r].ColSpan+" rowspan="+i[r].RowSpan+" role='rowheader'>"+(i[r].State==0?'<span style="margin-left: 10px"><\/span>':i[r].State==2?'<span class="expand e-icon">&nbsp;<\/span>':i[r].State==1?'<span class="collapse e-icon">&nbsp;<\/span>':"")+t.buildTag("span.cellValue",i[r].Value)[0].outerHTML+"<\/th>":h+"<td"+(i[r].CSS=="none"?"":' class="'+i[r].CSS)+'" p='+i[r].Index+" colspan="+i[r].ColSpan+" rowspan="+i[r].RowSpan+" role='gridcell'>"+(i[r].State==2?'<span class="expand e-icon">&nbsp;<\/span>':i[r].State==1?'<span class="collapse e-icon">&nbsp;<\/span>':"")+t.buildTag("span.cellValue",i[r].Value)[0].outerHTML+"<\/td>",i[r].RowSpan>1&&i[r].ColSpan<=1)for(u=r+1;u<r+i[r].RowSpan;u++)i[u].Span="Block";else if(i[r].ColSpan>1&&i[r].RowSpan<=1)for(u=r+this._rowCount;u<r+i[r].ColSpan*this._rowCount;u=u+this._rowCount)i[u].Span="Block";else if(i[r].ColSpan>1&&i[r].RowSpan>1)for(u=r;u<r+i[r].RowSpan;u++){for(e=u+this._rowCount;e<u+i[r].ColSpan*this._rowCount;e=e+this._rowCount)i[e].Span="Block";u!=r&&(i[u].Span="Block")}h+="<\/tr>";n(rt).append(h)}}}else nt=t.buildTag("tr",t.buildTag("th","",{width:"70px"})[0].outerHTML+t.buildTag("th","",{width:"70px"})[0].outerHTML+t.buildTag("th","",{width:"70px"})[0].outerHTML),tt=t.buildTag("tr",t.buildTag("td","",{width:"70px"})[0].outerHTML+t.buildTag("td","",{width:"70px"})[0].outerHTML+t.buildTag("td","",{width:"70px"})[0].outerHTML)[0].outerHTML+t.buildTag("tr",t.buildTag("td","",{width:"70px"})[0].outerHTML+t.buildTag("td","",{width:"70px"})[0].outerHTML+t.buildTag("td","",{width:"70px"})[0].outerHTML)[0].outerHTML+t.buildTag("tr",t.buildTag("td","",{width:"70px"})[0].outerHTML+t.buildTag("td","",{width:"70px"})[0].outerHTML+t.buildTag("td","",{width:"70px"})[0].outerHTML)[0].outerHTML,n(o).append(nt),n(o).append(tt);if(this._unWireEvents(),this._wireEvents(),n(o).append(it),n(o).append(rt),this.model.enableVirtualScrolling||n(o).find("tr:last").find("td").text()!=""||this.model.operationalMode==t.PivotGrid.OperationalMode.ClientMode&&this._dataModel=="Pivot"||this._pagerObj!=null||n(o).find("tr:last").hide(),this._dataModel=="Pivot"&&this.model.enableCollapseByDefault&&this.model.collapsedMembers==null){for(ft=this.model.operationalMode==t.PivotGrid.OperationalMode.ClientMode?this.model.dataSource.rows.length:JSON.parse(this.getOlapReport()).PivotRows.length,et=this.model.operationalMode==t.PivotGrid.OperationalMode.ClientMode?this.model.dataSource.columns.length:JSON.parse(this.getOlapReport()).PivotColumns.length,this.model.collapsedMembers={},b=ft;b>=0;b--)for(thRList=n(o).find("th[p^='"+b+",']:has('span.collapse')[class^='rowheader']"),p=this._getFieldName(thRList[0]),this.model.collapsedMembers[p]=[],l=0;l<thRList.length;l++)this.model.collapsedMembers[p].push(thRList[l].textContent),this._collapseMember(o,n(thRList[l]).find(".collapse"));for(k=et;k>=0;k--)for(thCList=n(o).find("th[p$=',"+k+"']:has('span.collapse')[class$='colheader']"),p=this._getFieldName(thCList[0]),this.model.collapsedMembers[p]=[],l=0;l<thCList.length;l++)this.model.collapsedMembers[p].push(thCList[l].textContent),this._collapseMember(o,n(thCList[l]).find(".collapse"))}else if(!t.isNullOrUndefined(this.model.collapsedMembers))for(s=0;s<this.model.collapsedMembers.length;s++)if(v=this.model.collapsedMembers[s],this.model.operationalMode==t.PivotGrid.OperationalMode.ClientMode){for(u=0;u<this.model.dataSource.rows.length;u++)this.model.dataSource.rows[u].fieldName==s&&(a=u,y="row");for(u=0;u<this.model.dataSource.columns.length;u++)this.model.dataSource.columns[u].fieldName==s&&(a=u,y="column");if(!t.isNullOrUndefined(a))if(y=="row")for(u=this.model.dataSource.columns.length+1;u<this._rowCount;u+=t.isNullOrUndefined(f)?1:f.rowSpan){for(f=n(o).find("tBody th[p='"+a+","+u+"']")[0],c=!1,e=0;e<v.length;e++)if(n(f).text().trim()==v[e].toString().trim()){c=!0;break}!t.isNullOrUndefined(f)&&(n(f).hasClass("rowheader")||n(f).attr("role")=="rowheader")&&c&&n(f).find(".collapse").length>0&&this._collapseMember(o,n(f).find(".collapse"))}else if(y=="column")for(u=this.model.dataSource.rows.length;u<Math.ceil(this.getJSONRecords().length/this._rowCount);u+=t.isNullOrUndefined(f)?1:f.colSpan){for(f=n(o).find("thead th[p='"+u+","+a+"']")[0],c=!1,e=0;e<v.length;e++)if(n(f).text().trim()==v[e].toString().trim()){c=!0;break}!t.isNullOrUndefined(f)&&(n(f).hasClass("colheader")||n(f).attr("role")=="columnheader")&&c&&n(f).find(".collapse").length>0&&this._collapseMember(o,n(f).find(".collapse"))}}else{for(d=JSON.parse(this.getOlapReport()).PivotRows,g=JSON.parse(this.getOlapReport()).PivotColumns,u=0;u<d.length;u++)d[u].FieldName==s&&(a=u,y="row");for(u=0;u<g.length;u++)g[u].FieldName==s&&(a=u,y="column");if(!t.isNullOrUndefined(a))if(y=="row")for(u=g.length+1;u<this._rowCount;u+=t.isNullOrUndefined(f)?1:f.rowSpan){for(f=n(o).find("tBody th[p='"+a+","+u+"']")[0],c=!1,e=0;e<v.length;e++)if(n(f).text().trim()==v[e].toString().trim()){c=!0;break}!t.isNullOrUndefined(f)&&(n(f).hasClass("rowheader")||n(f).attr("role")=="rowheader")&&c&&n(f).find(".collapse").length>0&&this._collapseMember(o,n(f).find(".collapse"))}else if(y=="column")for(u=d.length;u<Math.ceil(this.getJSONRecords().length/this._rowCount);u+=t.isNullOrUndefined(f)?1:f.colSpan){for(f=n(o).find("thead th[p='"+u+","+a+"']")[0],c=!1,e=0;e<v.length;e++)if(n(f).text().trim()==v[e].toString().trim()){c=!0;break}!t.isNullOrUndefined(f)&&(n(f).hasClass("colheader")||n(f).attr("role")=="columnheader")&&c&&n(f).find(".collapse").length>0&&this._collapseMember(o,n(f).find(".collapse"))}}this.element.html("");this.model.enableVirtualScrolling?(this._createVirtualPivotGrid(o),this._applyVScrolling()):this.model.enableGroupingBar?(this.element.append(o),(this._JSONRecords==null||this._JSONRecords.length==0)&&this.element.append(t.buildTag("span","No records to display.",{display:"inline-block",padding:"10px 0px 0px 0px","font-family":"Segoe UI"})[0].outerHTML),this._createFields(o,n("#"+this._id).find(".pivotGridTable").width(),n("#"+this._id).find(".pivotGridTable th").outerWidth())):this.element.append(o);this.model.enableCellEditing&&this._on(this.element,"mousedown",".value",this._initCellEditing);this.model.enableCellDoubleClick&&this._on(this.element,"dblclick",".value, .summary",this._cellRangeInfo);this.model.enableRTL?(this.element.find("table").addClass("e-rtl"),this.element.find(".groupingBarPivot").addClass("e-rtl"),this.element.find(".groupingBarPivot").width(n(".pivotGridTable").width()),this.element.find("table .rowheader,.colheader,.summary, .groupingBarPivot, .grpRow").css("text-align","right")):(this.element.find("table").removeClass("e-rtl"),this.element.find(".groupingBarPivot").removeClass("e-rtl"),this.element.find("table .rowheader,.colheader,.summary, .grpRow, .groupingBarPivot ").css("text-align","left"));this.model.enableConditionalFormatting&&this._formattingArrayClone.length>0&&(this._drillAction!=""&&(this.isDrillDown=!0),this._applyFormatting());this._schemaData!=null&&this.element.find(".colheader, .rowheader, .value").addClass("e-droppable");this.exportRecords=i},_cellRangeInfo:function(t){var w=n("thead tr").length,s=[],l=0,r=n.grep(this.getJSONRecords(),function(i){return(i.CSS=="colheader"||i.CSS=="summary"||i.CSS==" calc")&&i.Index.split(",")[0]==n(t.target).attr("p").split(",")[0]}),e=n.grep(this.getJSONRecords(),function(i){return(i.CSS=="rowheader"||i.CSS=="summary")&&i.Index.split(",")[1]==n(t.target).attr("p").split(",")[1]}),p,h,c,u,o,f,i,y;if(e.length==1&&r.length==1&&(e[0].Value.indexOf("Grand")>=0||r[0].Value.indexOf("Grand")>=0||r[0].CSS==" calc"))if(p=[],(r[0].Value.indexOf("Grand")>=0||r[0].CSS==" calc")&&e[0].Value.indexOf("Grand")>=0)for(i=0;i<this.model.dataSource.data.length;i++)s[i]=this.model.dataSource.data[i];else for(e[0].Value.indexOf("Grand")>=0?h=r[0].Value.indexOf("Total")>=0?r[0].Value.replace(" Total",""):r[0].Value:(r[0].Value.indexOf("Total")>=0||r[0].CSS==" calc")&&(h=e[0].Value.indexOf("Total")>=0?e[0].Value.replace(" Total",""):e[0].Value),i=0;i<this.model.dataSource.data.length;i++)n.each(this.model.dataSource.data[i],function(n,t){t==h&&(s[l]=this.model.dataSource.data[i],l++)});else if(e.length>=1&&r.length>=1&&(e[0].Value.indexOf("Total")>=0||r[0].Value.indexOf("Total")>=0)){for(e[0].Value.indexOf("Total")>=0?(h=r,c=e):r[0].Value.indexOf("Total")>=0&&(h=e,c=r),u=this.model.dataSource.data,o=h.length-1;o>=0;o--){for(f=[],i=0;i<u.length;i++)n.each(u[i],function(n,t){t==h[o].Value&&f.push(u[i])});u=f}if(s=f,c[0].Value.indexOf("Grand")<=0)for(f=[],i=0;i<u.length;i++)n.each(u[i],function(n,t){t==c[0].Value.replace(" Total","")&&(s=[],f.push(u[i]))});s=s.length==0?f:s}else{var a=e,v=r,u=this.model.dataSource.data;for(o=a.length-1;o>=0;o--){for(f=[],i=0;i<u.length;i++)n.each(u[i],function(n,t){t==a[o].Value&&f.push(u[i])});u=f}for(o=v.length-1;o>=0;o--){for(f=[],i=0;i<u.length;i++)n.each(u[i],function(n,t){t==v[o].Value&&f.push(u[i])});u=f}s=s.length==0?f:s}this.model.cellDoubleClick!=null&&(y={selectedData:s,element:this.element,customObject:this.model.customObject},this._trigger("cellDoubleClick",y))},_initCellEditing:function(i){if(i.target.tagName!="INPUT"){this._on(this.element,"mouseup",".value",this._completeCellEditing);var r;_oriX=i.pageX;_oriY=i.pageY;r=i.target||window.event.srcElement;n(".value").addClass("selection");n("#"+this._id).append(t.buildTag("div.cellSelection#"+this._id+"_cellSelection","",{}));_startPosCell=n(r)[0].attributes.getNamedItem("p").value;this._on(this.element,"mousemove",".value, .cellSelection",this._cellSelection)}else this._off(this.element,"mouseup",".value",this._completeCellEditing)},_completeCellEditing:function(t){var tt,c,p=[],f,w,e,it,s,h,rt,b,v,g,y,l,u,o,i,d,nt;if(t.target.tagName!="INPUT"){if(this._off(this.element,"mousemove",".value"),n(".value").removeClass("selection"),tt=t.target||window.event.srcElement,c=n(tt)[0].attributes.getNamedItem("p").value,e=0,it=this.element.find(".curInput"),it.length>0)return this._updateTableCell(),n("#"+this._id+"_cellSelection").remove(),this._on(this.element,"mousemove",".value",this._applyToolTip),this._off(this.element,"mouseup",".value"),!1;for(s=parseInt(_startPosCell.split(",")[1])<parseInt(c.split(",")[1])?parseInt(_startPosCell.split(",")[1]):parseInt(c.split(",")[1]);s<=(parseInt(_startPosCell.split(",")[1])>parseInt(c.split(",")[1])?parseInt(_startPosCell.split(",")[1]):parseInt(c.split(",")[1]));s++)if(this._dataModel=="Olap"||n("#"+this._id).find("td[p*=',"+s+"']").parent().is(":visible"))for(h=parseInt(_startPosCell.split(",")[0])<parseInt(c.split(",")[0])?parseInt(_startPosCell.split(",")[0]):parseInt(c.split(",")[0]);h<=(parseInt(_startPosCell.split(",")[0])>parseInt(c.split(",")[0])?parseInt(_startPosCell.split(",")[0]):parseInt(c.split(",")[0]));h++)if(this._dataModel=="Olap"||n("#"+this._id).find("[p*='"+h+",']").last("th").is(":Visible")){p[e]=this.getJSONRecords()[h*this._rowCount+s];this.model.enableCellEditing&&(rt=n("[p='"+h+","+s+"']").text()!=""?n("[p='"+h+","+s+"']").text():n(".curInput").val());n("[p='"+h+","+s+"']").html("<input type='text' class='curInput' value='"+rt+"' />");var a,k="",ft,et,ut=0;if(f=n("#"+this._id).find("tbody").find('[p="'+h+","+s+'"]').parent("tr").find(".rowheader").last().attr("p"),f==r&&(f=n("#"+this._id).find("tbody").find('[p="'+h+","+s+'"]').parent("tr").find(".summary").first().attr("p")),ft=f,f!=null){while(f[0]>=0)f==this.getJSONRecords()[parseInt(parseInt(f.split(",")[0])*this._rowCount+parseInt(f.split(",")[1]))].Index&&(a=this.model.enableCellEditing?this.getJSONRecords()[parseInt(parseInt(f.split(",")[0])*this._rowCount+parseInt(f.split(",")[1]))].Info.split("::")[0]:this.getJSONRecords()[parseInt(parseInt(f.split(",")[0])*this._rowCount+parseInt(f.split(",")[1]))].Value,this._dataModel=="Pivot"&&(a=n("#"+this._id).find("td[p*='"+h+","+s+"']").prevAll("th").children(".expand").length>0?a.replace("Total",""):a),f=parseInt(f.split(",")[0])-1+","+parseInt(f.split(",")[1])),k&&a!=""?k=a+"-"+k:a!=""&&(k=a);if(this._rowHeader[e]=k,u=this._rowHeader[e].split("-"),u.length>1){for(i=0;i<u.length-1;i++)for(o=0;o<u[i].split(".").length;o++)if(u[i].split(".")[o]==u[i+1].split(".")[o]&&u[i].split(".")[o+1]==u[i+1].split(".")[o+1]){u.splice(i,1);break}for(this._rowHeader[e]="",i=0;i<u.length;i++)this._rowHeader[e]+=this._rowHeader[e]==""?u[i]:"-"+u[i]}}for(b="",g=n("#"+this._id).find("td[p*='"+parseInt(p[e].Index.split(",")[0])+","+parseInt(p[e].Index.split(",")[1])+"']").closest("tbody").prev().children("tr:last").children("th").attr("p")[2],et=g,w=p[e].Index,w!=r&&w==this.getJSONRecords()[parseInt(parseInt(w.split(",")[0])*this._rowCount+parseInt(w.split(",")[1]))].Index&&(y=parseInt(w.split(",")[0])),l=0;l<=g;l++){if(y!=null&&y+","+l==this.getJSONRecords()[parseInt(parseInt(y)*this._rowCount+l)].Index){if(v=this.model.enableCellEditing?this.getJSONRecords()[parseInt(parseInt(y)*this._rowCount+l)].Info.split("::")[0]:this.getJSONRecords()[parseInt(parseInt(y)*this._rowCount+l)].Value,this._dataModel=="Pivot")for(i=y;i>=0;i--)if(n("#"+this._id).find("th[p*='"+i+","+l+"']").length>0){v=n("#"+this._id).find("th[p*='"+i+","+l+"']").find(".expand").length>0?v.replace("Total",""):v;break}b==""?b=v:v!=""&&(b=b+"-"+v)}this._colHeader[e]=b}if(u=this._colHeader[e].split("-"),u.length>1){for(i=0;i<u.length-1;i++)for(o=0;o<u[i].split(".").length;o++)if(u[i].split(".")[o]==u[i+1].split(".")[o]&&u[i].split(".")[o+1]==u[i+1].split(".")[o+1]){u.splice(i,1);break}for(this._colHeader[e]="",i=0;i<u.length;i++)this._colHeader[e]+=this._colHeader[e]==""?u[i]:"-"+u[i]}e++}for(this._originalValue="",d=0;d<this.element.find(".curInput").length;d++)nt=this.element.find(".curInput")[d],this._originalValue+=this._originalValue==""?nt.value:":"+nt.value;args={JSONRecords:p,rowHeader:this._rowHeader,columnHeader:this._colHeader,measureCount:ut>0?"Row:"+ut:"Column:0"};this._trigger("cellSelection",args);p=rowHeader=colHeader=[];n("#"+this._id+"_cellSelection").remove();this._on(this.element,"mousemove",".value",this._applyToolTip);this._off(this.element,"mouseup",".value")}n(".curInput").keypress(function(t){if(t.which==13){var i=n(t.target).parents(".e-pivotgrid").data("ejPivotGrid");i._updateTableCell()}})},_updateTableCell:function(){var i="",u="",f,r,t;editValue=n(".curInput");n.each(editValue,function(n,t){i+=i==""?t.value:":"+t.value});try{f=JSON.parse(this.getOlapReport()).Report}catch(e){f=this.getOlapReport()}for(rowUniqueName=this._rowHeader,columnUniqueName=this._colHeader,u=i.split(":"),r=u.length-1;r>=0;r--)u[r]==this._originalValue.split(":")[r]&&(rowUniqueName.splice(r,1),columnUniqueName.splice(r,1),u.splice(r,1));for(i="",t=0;t<u.length;t++)i+=i==""?u[t]:":"+u[t];if(i.length==0){for(t=editValue.length-1;t>=0;t--)n(editValue[t]).closest("td").text(n(".curInput")[t].value);return!1}this._ogridWaitingPopup.show();this.model.beforeServiceInvoke!=null&&this._trigger("beforeServiceInvoke",{action:"writeBack",element:this.element});eventArgs=JSON.stringify({action:"writeBack",value:i,rowUniqueName:JSON.stringify(rowUniqueName),columnUniqueName:JSON.stringify(columnUniqueName),currentReport:f});editValue="";rowUniqueName="";columnUniqueName="";this.doAjaxPost("POST",this.model.url+"/"+this.model.serviceMethodSettings.writeBack,eventArgs,this._renderControlSuccess)},_createVirtualPivotGrid:function(n){var u=this._seriesPageCount>1?t.buildTag("div.vScrollPanel")[0].outerHTML:"",f=this._categPageCount>1?t.buildTag("div.hScrollPanel")[0].outerHTML:"",e=t.buildTag("td.virtualScrollGrid",n[0].outerHTML)[0],o=t.buildTag("td.virtualScrollElement",u),s=t.buildTag("td.virtualScrollElement",f),h=t.buildTag("tr.virtualScrollElement",e.outerHTML+o[0].outerHTML),c=t.buildTag("tr.virtualScrollElement",s[0].outerHTML+t.buildTag("td.virtualScrollElement")[0].outerHTML),l=t.buildTag("tbody.oGridOuterDiv.virtualScrollElement",h[0].outerHTML+c[0].outerHTML),i,r;this.element.html(t.buildTag("table.virtualScrollElement",l[0].outerHTML));i=t.buildTag("div.seriesPageIndicator inActive",t.buildTag("span.axislabel",this._getLocalizedLabels("SeriesPage"))[0].outerHTML+t.buildTag("span.series_CurrentPage",this._seriesCurrentPage)[0].outerHTML+" / "+t.buildTag("span.series_pageCount",this._seriesPageCount)[0].outerHTML)[0].outerHTML;this._seriesPageCount>1&&this.element.append(i);r=t.buildTag("div.categPageIndicator inActive",t.buildTag("span.axislabel",this._getLocalizedLabels("CategoricalPage"))[0].outerHTML+t.buildTag("span.categ_CurrentPage",this._categCurrentPage)[0].outerHTML+" / "+t.buildTag("span.categ_pageCount",this._categPageCount)[0].outerHTML)[0].outerHTML;this._categPageCount>1&&this.element.append(r)}});t.PivotGrid.Layout={Normal:"normal",NormalTopSummary:"normaltopsummary",NoSummaries:"nosummaries",ExcelLikeLayout:"excellikelayout"};t.PivotGrid.Locale={};t.PivotGrid.Locale["en-US"]={Sort:"Sort",SelectField:"select Field",LabelFilterLabel:"Show the items for which the label",ValueFilterLabel:"Show the items for which",LabelFilters:"Label Filters  ",BeginsWith:"Begins With",NotBeginsWith:"Not Begins With",EndsWith:"Ends With",NotEndsWith:"Not Ends With",Contains:"Contains",NotContains:"Not Contains",ValueFilters:"Value Filters",ClearFilter:"Clear Filter",Equals:"Equals",NotEquals:"Not Equals",GreaterThan:"Greater Than ",GreaterThanOrEqualTo:"Greater Than Or Equal To ",LessThan:"Less Than ",LessThanOrEqualTo:"Less Than Or Equal To ",Between:"Betweens",NotBetween:"Not Between",Warning:"Warning",AlertMsg:"The field you are moving cannot be placed in that area of the report",Measures:"Measures",ToolTipRow:"Row",ToolTipColumn:"Column",ToolTipValue:"Value",SeriesPage:"Series Page",CategoricalPage:"Categorical Page",DragFieldHere:"Drag field here",ColumnArea:"Drop column here",RowArea:"Drop row here",ValueArea:"Drop values here",OK:"OK",Cancel:"Cancel",Remove:"Remove",Goal:"Goal",Status:"Status",Trend:"Trend",Value:"value",ConditionalFormatting:"Conditional Formatting",Condition:"Conditional Type",Value1:"Value1",Value2:"Value2",Editcondtion:"Edit Condition",Backcolor:"Back Color",Borderrange:"Border Range",Borderstyle:"Border Style",Fontsize:"Font Size",Fontstyle:"Font Style",Bordercolor:"Border Color",CubeDimensionBrowser:"Cube Dimension Browser",SelectHierarchy:"Select Hierarchy"};t.PivotGrid.ExportOptions={Excel:"excel",Word:"word",PDF:"pdf",CSV:"csv"};t.PivotGrid.AnalysisMode={Olap:"olap",Relational:"relational"};t.PivotGrid.OperationalMode={ClientMode:"clientmode",ServerMode:"servermode"};t.olap.base&&n.extend(t.PivotGrid.prototype,t.olap.base);t.olap._mdxParser&&n.extend(t.PivotGrid.prototype,t.olap._mdxParser)})(jQuery,Syncfusion)});
