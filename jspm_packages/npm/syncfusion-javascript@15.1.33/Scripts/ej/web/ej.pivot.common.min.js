/*!
*  filename: ej.pivot.common.min.js
*  version : 15.1.0.33
*  Copyright Syncfusion Inc. 2001 - 2017. All rights reserved.
*  Use of this code is subject to the terms of our license.
*  A copy of the current license can be obtained at any time by e-mailing
*  licensing@syncfusion.com. Any infringement will be prosecuted under
*  applicable laws. 
*/
(function(n){typeof define=="function"&&define.amd?define(["./../common/ej.core.min"],n):n()})(function(){ej.Pivot=ej.Pivot||{},function(n,t,r){t.Pivot={addReportItem:function(n,i){if(i.isMeasuresDropped)i.droppedClass!=""?n.values[0].axis=i.droppedClass=="row"?"rows":i.droppedClass=="column"?"columns":n.values[0].axis:n.values[0].measures=[];else{var r=this.removeReportItem(n,i.droppedFieldName,i.isMeasuresDropped);t.isNullOrUndefined(r)&&(r={fieldName:i.droppedFieldName,fieldCaption:i.droppedFieldCaption});switch(i.droppedClass){case"row":i.droppedPosition.toString()!=""?n.rows.splice(i.droppedPosition,0,r):n.rows.push(r);break;case"column":i.droppedPosition.toString()!=""?n.columns.splice(i.droppedPosition,0,r):n.columns.push(r);break;case"value":n.cube==""?i.droppedPosition.toString()!=""?n.values.splice(i.droppedPosition,0,r):n.values.push(r):i.droppedPosition.toString()!=""?n.values[0].measures.splice(i.droppedPosition,0,r):n.values[0].measures.push(r);break;case"filter":i.droppedPosition.toString()!=""?n.filters.splice(i.droppedPosition,0,r):n.filters.push(r)}}},removeReportItem:function(i,r,u){var o=i.cube==""?t.Pivot.AnalysisMode.Pivot:t.Pivot.AnalysisMode.Olap,f=n.grep(i.columns,function(n){return n.fieldName==r}),e;return u?i.values[0].measures=[]:f.length>0?i.columns=n.grep(i.columns,function(n){return n.fieldName!=r}):(f=n.grep(i.rows,function(n){return n.fieldName==r}),f.length>0?i.rows=n.grep(i.rows,function(n){return n.fieldName!=r}):(e=o==t.Pivot.AnalysisMode.Olap?i.values[0].measures:i.values,f=n.grep(e,function(n){return n.fieldName==r}),f.length>0?i.values=o==t.Pivot.AnalysisMode.Olap?[{measures:n.grep(e,function(n){return n.fieldName!=r}),axis:i.values[0].axis}]:n.grep(e,function(n){return n.fieldName!=r}):(f=n.grep(i.filters,function(n){return n.fieldName==r}),f.length>0&&(i.filters=n.grep(i.filters,function(n){return n.fieldName!=r}))))),f[0]},getReportItemByFieldName:function(i,r){var f="columns",u=n.grep(r.columns,function(n){return n.fieldName.toLowerCase()==i.toLowerCase()}),e;return u.length==0&&(u=n.grep(r.rows,function(n){return n.fieldName.toLowerCase()==i.toLowerCase()}),f="rows"),u.length==0&&(e=r.cube==""?r.values:r.values.length>0&&!t.isNullOrUndefined(r.values[0].measures)?r.values[0].measures:[],u=n.grep(e,function(n){return n.fieldName.toLowerCase()==i.toLowerCase()}),f="values"),u.length==0&&(u=n.grep(r.filters,function(n){return n.fieldName.toLowerCase()==i.toLowerCase()}),f="filters"),{item:u[0],axis:f}},getReportItemByFieldCaption:function(i,r){var f="columns",u=n.grep(r.columns,function(n){return n.fieldCaption.toLowerCase()==i.toLowerCase()}),e;return u.length==0&&(u=n.grep(r.rows,function(n){return n.fieldCaption.toLowerCase()==i.toLowerCase()}),f="rows"),u.length==0&&(e=r.cube==""?r.values:r.values.length>0&&!t.isNullOrUndefined(r.values[0].measures)?r.values[0].measures:[],u=n.grep(e,function(n){return n.fieldCaption.toLowerCase()==i.toLowerCase()}),f="values"),u.length==0&&(u=n.grep(r.filters,function(n){return n.fieldCaption.toLowerCase()==i.toLowerCase()}),f="filters"),{item:u[0],axis:f}},closePreventPanel:function(n){var i=n.type!="close"?n:this;i.element.find("#preventDiv").remove();t.isNullOrUndefined(i.model.pivotControl)||i.model.pivotControl.element.find("#preventDiv").remove();t.isNullOrUndefined(i._waitingPopup)||i._waitingPopup.hide();t.isNullOrUndefined(i.model.pivotControl)||t.isNullOrUndefined(i.model.pivotControl._waitingPopup)||i.model.pivotControl._waitingPopup.hide()},openPreventPanel:function(i){var r=t.buildTag("div#preventDiv.errorDlg").css({width:n("body").width()+"px",height:n("body").height()+"px",position:"absolute",top:n("body").offset().top+"px",left:n("body").offset().left+"px","z-index":10})[0].outerHTML;n("#"+i._id).append(r)},_createErrorDialog:function(i,r,u){var e,o;if(t.Pivot.closePreventPanel(u),u._errorDialog=r,t.Pivot.openPreventPanel(u),u.element.find(".errorDialog:visible").length==0){e=t.isNullOrUndefined(i.Exception)?t.buildTag("div.errorDialog#ErrorDialog",t.buildTag("div.warningImg")[0].outerHTML+t.buildTag("div.warningContent action:",u.model.enableRTL?i+"--"+r:r+"--"+i)[0].outerHTML+t.buildTag("div",t.buildTag("button#ErrOKBtn.errOKBtn","OK",{margin:"20px 0 10px 165px"})[0].outerHTML)[0].outerHTML).attr("title","Warning")[0].outerHTML:t.buildTag("div.errorDialog#ErrorDialog",t.buildTag("div.warningImg")[0].outerHTML+t.buildTag("div.warningContent action:",u.model.enableRTL?i.Exception.Message+"--"+r:r+"--"+i.Exception.Message)[0].outerHTML+t.buildTag("br")[0].outerHTML+t.buildTag("div."+u._id+"stackTraceContent","Stack Trace :"+i.Exception.StackTraceString)[0].outerHTML+t.buildTag("div",t.buildTag("button#ErrOKBtn.errOKBtn","OK",{margin:"20px 0 10px 165px"})[0].outerHTML)[0].outerHTML).attr("title","Warning")[0].outerHTML;u.element.append(e);u.element.find(".errorDialog").ejDialog({target:"#"+u._id,enableResize:!1,enableRTL:u.model.enableRTL,width:"400px",close:t.proxy(t.Pivot.closePreventPanel,u)});o=u.element.find(".errorDialog").data("ejDialog");n("#"+o._id+"_wrapper").css({left:"50%",top:"50%"});u.element.find(".errOKBtn").ejButton({type:t.ButtonType.Button,width:"50px"}).on(t.eventType.click,function(){u._errorDialog!="nodeCheck"||t.isNullOrUndefined(u._schemaData)||t.isNullOrUndefined(u._schemaData._selectedTreeNode)||u._schemaData._tableTreeObj.uncheckNode(u._schemaData._selectedTreeNode);u.element.find("#preventDiv").remove();(u._errorDialog=="Warning"||u._errorDialog=="Exception"||u._errorDialog=="Error")&&u.element.children("#ErrorDialog_wrapper").remove()});if(u.element.find(".e-dialog .e-close").attr("title","Close"),t.isNullOrUndefined(n("#"+u._id).data("ejWaitingPopup"))||n("#"+u._id).data("ejWaitingPopup").hide(),typeof oclientWaitingPopup!="undefined"&&oclientWaitingPopup!=null&&oclientWaitingPopup.hide(),!t.isNullOrUndefined(i.Exception)){var f=50,h="...",s="Show more",c="Show less";n("."+u._id+"stackTraceContent").each(function(){var i=n(this).html();if(i.length>f){u._id;var r=i.substr(0,f),e=i.substr(f,i.length-f),o=r+t.buildTag("span."+u._id+"moreellipses",h)[0].outerHTML+t.buildTag("span."+u._id+"morecontent",t.buildTag("span",e).css("display","none")[0].outerHTML+t.buildTag("a."+u._id+"morelink",s).css("display","block")[0].outerHTML)[0].outerHTML;n(this).html(o)}});n("."+u._id+"morelink").click(function(){return n(this).hasClass("less")?(n(this).removeClass("less"),n(this).html(s)):(n(this).addClass("less"),n(this).html(c)),n(this).parent().prev().toggle("slow",function(){}),n(this).prev().toggle("slow",function(){}),!1})}}},_contextMenuOpen:function(i,r){var f,e,u;if(t.Pivot.openPreventPanel(r),r._selectedMember=n(i.target),r.pluginName=="ejPivotGrid"?(f=r.model.analysisMode==t.Pivot.AnalysisMode.Olap?"olap":"pivot",u=n("#pivotTree").data("ejMenu")):(t.isNullOrUndefined(r.model.pivotControl)||(f=r.model.pivotControl.model.analysisMode==t.Pivot.AnalysisMode.Olap?"olap":"pivot"),u=n("#pivotTreeContextMenu").data("ejMenu")),f==t.Pivot.AnalysisMode.Olap){if(t.isNullOrUndefined(n(i.target).parent().attr("tag"))&&n(i.target).hasClass("pivotButton")&&n(i.target).children(".pvtBtn:eq(0)").length>0)return r._selectedMember=n(i.target).children(".pvtBtn:eq(0)"),!1;n(i.target).parent().attr("tag").split(":")[1].toLowerCase().startsWith("[measures]")?u.disable():r._selectedMember.parent().attr("tag").split(":")[1].toLowerCase()=="measures"?(u.disableItem(r._getLocalizedLabels("AddToValues")),u.disableItem(r._getLocalizedLabels("AddToFilter")),u.enableItem(r._getLocalizedLabels("AddToRow")),u.enableItem(r._getLocalizedLabels("AddToColumn"))):(u.disableItem(r._getLocalizedLabels("AddToValues")),n(i.target.parentElement).find(".namedSetCDB").length>0?u.disableItem(r._getLocalizedLabels("AddToFilter")):u.enableItem(r._getLocalizedLabels("AddToFilter")),u.enableItem(r._getLocalizedLabels("AddToRow")),u.enableItem(r._getLocalizedLabels("AddToColumn")))}else f==t.Pivot.AnalysisMode.Pivot&&(e=i.target.textContent,n(i.target).hasClass("e-btn")?(u.enable(),r.pluginName=="ejPivotGrid"&&(u.disableItem(r._getLocalizedLabels("CalculatedField")),n(i.target).parents(".pivotButton").attr("tag").split(":")[0].toLowerCase()=="values"&&(r.model.operationalMode==t.PivotGrid.OperationalMode.ClientMode&&n.grep(r.model.dataSource.values,function(n){return n.fieldCaption==e&&n.isCalculatedField==!0}).length>0?u.disable():r.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode&&n.grep(JSON.parse(r.getOlapReport()).PivotCalculations,function(n){return n.FieldHeader==e&&n.CalculationType==8}).length>0&&u.disable(),u.enableItem(r._getLocalizedLabels("CalculatedField"))))):(u=n("#pivotTree").data("ejMenu"),u.disable()))},_searchTreeNodes:function(){var l=this.element.find(".searchEditorTreeView").data("ejMaskEdit"),r=this.element.find(".editorTreeView").data("ejTreeView"),o=r.element,a=t.isNullOrUndefined(l.get_StrippedValue())?"":l.get_StrippedValue().toLowerCase(),u,f,h,e,c,i;if(a.length>0){var v=[],y=[],s=o.find("ul>li>div>a");for(u=0;u<s.length;u++)n(s[u]).text().toLowerCase().indexOf(a)!=-1?v.push(s[u]):y.push(s[u]);for(f=o.find(v).closest("li").css("display","block"),o.find(y).closest("li").css("display","none"),i=0;i<f.length;i++)h=n(f[i]),e=h.parents("ul").closest("li").css("display","block"),e.length>0&&(r.expandNode(e),r.model.expandedNodes.indexOf(n(r._liList).index(e))==-1&&window._temp.push(e)),c=h.children("ul"),c.length>0&&c.children("li:visible").length==0&&(h.children("ul").children("li").css("display","block"),r.expandNode(f[i]),r.model.expandedNodes.indexOf(n(r._liList).index(f[i]))==-1&&window._temp.push(f[i]))}else{if(o.find("ul>li").css("display","block"),!t.isNullOrUndefined(window._temp))for(i=0;i<window._temp.length;i++)r._collpaseNode(window._temp[i]);window._temp=[]}},editorTreeNavigatee:function(i,r){var f=r._memberPageSettings.currentMemeberPage,e,s;if(!n(i.target).hasClass("disabled")){if(n(i.target).hasClass("nextPage"))r._memberPageSettings.startPage+=r.model.memberEditorPageSize,r._memberPageSettings.currentMemeberPage+=1,r._memberPageSettings.endPage+=r.model.memberEditorPageSize;else if(n(i.target).hasClass("prevPage"))r._memberPageSettings.currentMemeberPage-=1,r._memberPageSettings.startPage=Math.abs(r._memberPageSettings.startPage-(r._memberPageSettings.currentMemeberPage==1?r.model.memberEditorPageSize:r.model.memberEditorPageSize)),r._memberPageSettings.endPage-=r.model.memberEditorPageSize;else if(n(i.target).hasClass("firstPage"))r._memberPageSettings.currentMemeberPage=1,r._memberPageSettings.endPage=r.model.memberEditorPageSize,r._memberPageSettings.startPage=0;else if(n(i.target).hasClass("lastPage"))r._memberPageSettings.currentMemeberPage=parseInt(r.element.find(".memberPageCount").text().split("/")[1].trim()),r._memberPageSettings.endPage=r._memberPageSettings.currentMemeberPage*r.model.memberEditorPageSize,r._memberPageSettings.startPage=r._memberPageSettings.endPage-r.model.memberEditorPageSize;else{if(parseInt(n(i.target).val())>parseInt(r.element.find(".memberPageCount").text().split("/")[1].trim())||parseInt(n(i.target).val())==0)return!1;r._memberPageSettings.currentMemeberPage=parseInt(n(i.target).val());r._memberPageSettings.endPage=r._memberPageSettings.currentMemeberPage*r.model.memberEditorPageSize;r._memberPageSettings.startPage=r._memberPageSettings.currentMemeberPage==1||r._memberPageSettings.currentMemeberPage==0?0:r._memberPageSettings.endPage-r.model.memberEditorPageSize}if(r._waitingPopup.show(),r.model.operationalMode==t.Pivot.OperationalMode.ClientMode){r._isMemberPageFilter=!0;e=t.Pivot.updateTreeView(r._pivotSchemaDesigner);r._memberPageSettings.filterCollection=n.grep(r._memberPageSettings.filterCollection,function(n){if(f!=n.pageNo)return n});r._memberPageSettings.filterCollection.push({pageNo:f,memberTreeObj:n.extend({},e)});var h=r._schemaData._selectedFieldName,o=r.model.dataSource,u=n.map(r._currentReportItems,function(n){if(n.fieldName==h&&(t.isNullOrUndefined(n.dataSrc)||n.dataSrc.cube==o.cube&&n.dataSrc.reportName==o.reportName))return n.filterItems});u.length>0?r.model.enableMemberEditorPaging&&(u=n.grep(u,function(n){if(n.pageNo==r._memberPageSettings.currentMemeberPage)return n}),u.length>0?r._schemaData._fetchMemberSuccess({EditorTreeInfo:JSON.stringify(u[0].memberTreeObj.dataSource())}):t.olap._mdxParser.getMembers(r.model.dataSource,r._pivotSchemaDesigner._selectedFieldName,r._pivotSchemaDesigner)):t.olap._mdxParser.getMembers(r.model.dataSource,r._pivotSchemaDesigner._selectedFieldName,r._pivotSchemaDesigner)}else t.isNullOrUndefined(r._memberPageSettings.filterReportCollection)&&(r._memberPageSettings.filterReportCollection={}),r._updateTreeView(),r._memberPageSettings.filterReportCollection[f]=r._getUnSelectedNodes()+"CHECKED"+r._getSelectedNodes(r._currentAxis=="Slicers"?!0:!1),r.model.beforeServiceInvoke!=null&&r._trigger("beforeServiceInvoke",{action:"fetchMemberTreeNodes",element:r.element,customObject:r.model.customObject}),s=JSON.stringify(r.model.customObject),r.doAjaxPost("POST",r.model.url+"/"+r.model.serviceMethodSettings.fetchMemberTreeNodes,JSON.stringify({action:"fetchMemberTreeNodes",dimensionName:r._dimensionName+":"+r._memberPageSettings.startPage+"-"+r.model.memberEditorPageSize+"-"+r.model.enableMemberEditorPaging,olapReport:r.currentReport,customObject:s}),r._editorTreePageInfoSuccess)}},editorTreePageInfoSuccess:function(t,i){i._memberPageSettings.currentMemeberPage>1?i.element.find(".prevPage, .firstPage").removeClass("disabled").addClass("enabled"):i.element.find(".prevPage, .firstPage").removeClass("enabled").addClass("disabled");i._memberPageSettings.currentMemeberPage==parseInt(i.element.find(".memberPageCount").text().split("/")[1].trim())?i.element.find(".nextPage, .lastPage").removeClass("enabled").addClass("disabled"):i.element.find(".nextPage, .lastPage").removeClass("disabled").addClass("enabled");var f,u;f=t[0]!=r?t[0].Value:t.d!=r?t.d[0].Value:t.EditorTreeInfo;u=n.parseJSON(f);i.element.find(".memberCurrentPage").val(i._memberPageSettings.currentMemeberPage);u.splice(-1,1);i._appendTreeViewData(u,!1);i._unWireEvents();i._wireEvents();i._waitingPopup.hide()},createErrorDialog:function(i){var r,u;t.Pivot.openPreventPanel(i);i.element.find(".errorDialog").length==0?(u=t.buildTag("div.errorDialog#ErrorDialog",t.buildTag("div.warningImg")[0].outerHTML+t.buildTag("div.warningContent",i._getLocalizedLabels("AlertMsg"))[0].outerHTML+t.buildTag("div",t.buildTag("button#ErrOKBtn.errOKBtn","OK")[0].outerHTML)[0].outerHTML).attr("title",i._getLocalizedLabels("Warning"))[0].outerHTML,i.element.append(u),i.element.find(".errorDialog").ejDialog({target:"#"+i._id,enableResize:!1,enableRTL:i.model.enableRTL,width:"400px"}),r=i.element.find(".errorDialog").data("ejDialog"),n("#"+r._id+"_wrapper").css({left:"50%",top:"50%"}),i.element.find(".errOKBtn").ejButton({type:t.ButtonType.Button,click:t.proxy(t.Pivot.errOKBtnClick,i)}),i.element.find(".e-dialog .e-close").attr("title",i._getLocalizedLabels("Close"))):(r=i.element.find(".errorDialog").data("ejDialog"),r.open())},errOKBtnClick:function(){this.element.find("#preventDiv").remove();var n=this.element.find(".errorDialog").data("ejDialog");n._ejDialog.find("div.e-dialog-icon").trigger("click")},doAjaxPost:function(i,u,f,e,o,s){var h,c,l,a=!0;f.XMLA==r?(h="application/json; charset=utf-8",c="json",l=n.proxy(e,this)):(h="text/xml",c="xml",f=f.XMLA,l=n.proxy(e,t.olap.base,s),a=t.browserInfo().name=="msie"&&t.browserInfo().version<=9?!1:!t.isNullOrUndefined(s)&&s.action!="loadFieldElements"?!0:!1);n.ajax({type:i,url:u,contentType:h,async:a,dataType:c,data:f,success:l,complete:t.proxy(function(t){n.proxy(t,this);var i={action:this._currentAction,customObject:"",element:this.element}},this),error:t.proxy(function(n){typeof this._ogridWaitingPopup!="undefined"&&this._ogridWaitingPopup!=null&&this._ogridWaitingPopup.hide();typeof oclientWaitingPopup!="undefined"&&oclientWaitingPopup!=null&&oclientWaitingPopup.hide();var t={action:this._drillAction!=""?this._drillAction:"initialize",customObject:"",element:this.element,Message:n};this._trigger("renderFailure",t);this.renderControlFromJSON("");this._dataModel=="XMLA"&&this._createErrorDialog(n.statusText,this._getLocalizedLabels("Error"));n.statusText},this)})},getCubeList:function(t,i){for(var f,u=[],r=0;r<n(i).find("row").length;r++)f=n(n(i).find("row")[r]),u.push({name:n(f).children("CUBE_NAME").text()});t.pvtCtrldObj.setCubeList(u)},generateTreeViewData:function(n){var t={catalog:n.model.pivotControl.model.dataSource.catalog,cube:n.model.pivotControl.model.dataSource.cube,url:n.model.pivotControl.model.dataSource.data,request:"MDSCHEMA_DIMENSIONS"};this._getTreeData(t,this.loadDimensionElements,{schemaData:n,action:"loadFieldElements"})},loadDimensionElements:function(i,u){var s,h={},l=t.olap.base._getConnectionInfo(i.schemaData.model.pivotControl.model.dataSource.data),e={},o;for(e={catalog:i.schemaData.model.pivotControl.model.dataSource.catalog,cube:i.schemaData.model.pivotControl.model.dataSource.cube,url:i.schemaData.model.pivotControl.model.dataSource.data,request:"MDSCHEMA_DIMENSIONS"},i.schemaData.model.pivotControl.schemaTreeView=[],i.schemaData.model.pivotControl.reportItemNames=[],o=0;o<n(u).find("row").length;o++){var c=n(n(u).find("row")[o]),f=c.find("DIMENSION_UNIQUE_NAME").text(),s=c.find("DIMENSION_CAPTION").text();f.toLowerCase().indexOf("[measure")>=0?h={hasChildren:!0,isSelected:!1,id:f,name:s,spriteCssClass:f.toLowerCase()=="[measures]"?"folderCDB e-icon":"dimensionCDB e-icon",tag:f}:!n(n(u).find("row")[0]).find("HIERARCHY_CAPTION").length>0&&i.schemaData.model.pivotControl.schemaTreeView.push({hasChildren:!0,isSelected:!1,id:f,name:s,spriteCssClass:"dimensionCDB e-icon",tag:f,defaultHierarchy:n(n(u).find("row")[o]).children("DEFAULT_HIERARCHY").text()})}i.schemaData.model.pivotControl.schemaTreeView.splice(0,0,h);!i.schemaData.model.pivotControl.model.enableDrillThrough||i.schemaData!=r&&i.schemaData.model.olap.showNamedSets?(e.request="MDSCHEMA_SETS",t.Pivot._getTreeData(e,t.Pivot.loadNamedSetElements,i)):(e.request="MDSCHEMA_HIERARCHIES",(t.isNullOrUndefined(i.schemaData.model.pivotControl._fieldData)||!t.isNullOrUndefined(i.schemaData.model.pivotControl._fieldData)&&t.isNullOrUndefined(i.schemaData.model.pivotControl._fieldData.hierarchy))&&this._getFieldItemsInfo(i.schemaData.model.pivotControl),i.schemaData.model.pivotControl._fieldData.hierarchySuccess==r?t.Pivot._getTreeData(e,i.schemaData.model.pivotControl.loadHierarchyElements,i):t.Pivot.loadHierarchyElements(i,i.schemaData.model.pivotControl._fieldData.hierarchySuccess))},loadNamedSetElements:function(i,u){var h={catalog:i.schemaData.model.pivotControl.model.dataSource.catalog,cube:i.schemaData.model.pivotControl.model.dataSource.cube,url:i.schemaData.model.pivotControl.model.dataSource.data,request:"MDSCHEMA_HIERARCHIES"},u=i.schemaData.model.pivotControl.model.dataSource,s=[],e,o,f;for(e=n.map(u.rows,function(n){if(n.fieldName!=r)return n.fieldName}),n.merge(e,n.map(u.columns,function(n){if(n.fieldName!=r)return n.fieldName})),n.merge(e,n.map(u.filters,function(n){if(n.fieldName!=r)return n.fieldName})),o=0;o<n(u).find("row").length;o++)f=n(n(u).find("row")[o]),n.inArray(f.find("DIMENSIONS").text().split(".")[0],s)>=0||(i.schemaData.model.pivotControl.schemaTreeView.push({hasChildren:!0,isSelected:!1,pid:f.find("DIMENSIONS").text().split(".")[0],id:f.find("SET_DISPLAY_FOLDER").text()+"_"+f.find("DIMENSIONS").text().split(".")[0],name:f.find("SET_DISPLAY_FOLDER").text(),spriteCssClass:"folderCDB e-icon namedSets"}),s.push(f.find("DIMENSIONS").text().split(".")[0])),i.schemaData.model.pivotControl.schemaTreeView.push({hasChildren:!0,isSelected:n.inArray("["+n.trim(f.children("SET_NAME").text())+"]",e)>=0,pid:f.find("SET_DISPLAY_FOLDER").text()+"_"+f.find("DIMENSIONS").text().split(".")[0],id:"["+n.trim(f.children("SET_NAME").text()).replace(/\&/g,"&amp;")+"]",name:f.children("SET_CAPTION").text(),spriteCssClass:"namedSetCDB e-icon",tag:f.find("EXPRESSION").text()});t.isNullOrUndefined(i.schemaData.model.pivotControl._fieldData)||i.schemaData.model.pivotControl._fieldData.hierarchySuccess==r?t.Pivot._getTreeData(h,t.Pivot.loadHierarchyElements,i):t.Pivot.loadHierarchyElements(i,i.schemaData.model.pivotControl._fieldData.hierarchySuccess)},loadHierarchyElements:function(i,u){var l={catalog:i.schemaData.model.pivotControl.model.dataSource.catalog,cube:i.schemaData.model.pivotControl.model.dataSource.cube,url:i.schemaData.model.pivotControl.model.dataSource.data,request:"MDSCHEMA_LEVELS"},h=i.schemaData.model.pivotControl.model.dataSource,e,o;for(e=n.map(h.rows,function(n){if(n.fieldName!=r)return n.fieldName}),n.merge(e,n.map(h.columns,function(n){if(n.fieldName!=r)return n.fieldName})),n.merge(e,n.map(h.filters,function(n){if(n.fieldName!=r)return n.fieldName})),o=0;o<n(u).find("row").length;o++){var f=n(n(u).find("row")[o]),c=f.find("DIMENSION_UNIQUE_NAME").text(),s=f.find("HIERARCHY_UNIQUE_NAME").text(),a=n(i.schemaData.model.pivotControl.schemaTreeView).filter(function(n,t){return t.tag==c}).map(function(n,t){return t});a.length>0&&c!=s&&i.schemaData.model.pivotControl.schemaTreeView.push({hasChildren:!0,isSelected:n.inArray(s,e)>=0,pid:c,id:s,name:f.find("HIERARCHY_CAPTION").text(),spriteCssClass:f.find("HIERARCHY_ORIGIN").text()!="2"&&f.find("HIERARCHY_ORIGIN").text()!="6"?"hierarchyCDB e-icon":"attributeCDB e-icon",tag:s})}t.Pivot._getTreeData(l,t.Pivot.loadLevelElements,i)},loadLevelElements:function(i,r){var f=n.map(n(r).find("row"),function(t){if(parseInt(n(t).children("LEVEL_TYPE").text())!="1"&&n(t).children("HIERARCHY_UNIQUE_NAME").text().toLowerCase()!="[measures]")return{hasChildren:!1,isChecked:!1,id:n(t).find("LEVEL_UNIQUE_NAME").text(),pid:n(t).find("HIERARCHY_UNIQUE_NAME").text(),name:n(t).find("LEVEL_CAPTION").text(),tag:n(t).find("LEVEL_UNIQUE_NAME").text(),spriteCssClass:"level"+parseInt(n(t).children("LEVEL_NUMBER").text())+" e-icon"}}),u;n.merge(i.schemaData.model.pivotControl.schemaTreeView,f);(!i.schemaData.model.pivotControl.model.enableDrillThrough||i.schemaData.model.pivotControl._fieldData.measureSuccess)&&(t.isNullOrUndefined(i.schemaData.model.pivotControl._fieldData)||!i.schemaData.model.pivotControl._fieldData.measureSuccess?(u={catalog:i.schemaData.model.pivotControl.model.dataSource.catalog,cube:i.schemaData.model.pivotControl.model.dataSource.cube,url:i.schemaData.model.pivotControl.model.dataSource.data,request:"MDSCHEMA_MEASURES"},t.Pivot._getTreeData(u,t.Pivot.loadMeasureElements,i)):t.Pivot.loadMeasureElements(i,i.schemaData.model.pivotControl._fieldData.measureSuccess))},loadMeasureGroups:function(i,r){t.isNullOrUndefined(i.pivotControl._fieldData)&&(i.pivotControl._fieldData={});i.pivotControl._fieldData.measuresGroups=n(r).find("row")},loadMeasureElements:function(i,u){var o={catalog:i.schemaData.model.pivotControl.model.dataSource.catalog,cube:i.schemaData.model.pivotControl.model.dataSource.cube,url:i.schemaData.model.pivotControl.model.dataSource.data,request:"MDSCHEMA_DIMENSIONS"},a=[],v=[],h,s,l;for(a=n.map(i.schemaData.model.pivotControl.model.dataSource.values,function(n){if(n.measures!=r)return n.measures}),i.schemaData.model.pivotControl.reportItemNames=n.map(a,function(n){if(n.fieldName!=r)return n.fieldName}),i.schemaData.model.pivotControl.model.locale!="en-US"&&(o={catalog:i.schemaData.model.pivotControl.model.dataSource.catalog,cube:i.schemaData.model.pivotControl.model.dataSource.cube,url:i.schemaData.model.pivotControl.model.dataSource.data,request:"MDSCHEMA_MEASUREGROUPS"},t.Pivot._getTreeData(o,t.Pivot.loadMeasureGroups,{pivotControl:i.schemaData.model.pivotControl,action:"loadFieldElements"})),s=0;s<n(u).find("row").length;s++){var c=n(n(u).find("row")[s]),f=c.children("MEASUREGROUP_NAME").text(),e=c.find("MEASURE_UNIQUE_NAME").text();n.inArray(f,v)>=0||(i.schemaData.model.pivotControl.model.locale!="en-US"?(l=n.map(i.schemaData.model.pivotControl._fieldData.measuresGroups,function(t){if(n(t).children("MEASUREGROUP_NAME").text()==f)return n(t).children("MEASUREGROUP_CAPTION").text()}),h=l.length>0?l[0]:f):h=f,i.schemaData.model.pivotControl.schemaTreeView.push({hasChildren:!0,isChecked:!1,pid:"[Measures]",id:f,name:h,spriteCssClass:"measureGroupCDB e-icon",tag:f}),v.push(f));i.schemaData.model.pivotControl.schemaTreeView.push({hasChildren:!0,isSelected:n.inArray(e,i.schemaData.model.pivotControl.reportItemNames)>=0,id:e,pid:f,name:c.children("MEASURE_CAPTION").text(),spriteCssClass:"measure",tag:e});n.inArray(e,i.schemaData.model.pivotControl.reportItemNames)>=0&&i.schemaData.model.pivotControl.reportItemNames.splice(i.schemaData.model.pivotControl.reportItemNames.indexOf(e),1)}!t.isNullOrUndefined(i.schemaData)&&i.schemaData.model.olap.showKpi?(treeNodeElement={hasChildren:!0,isChecked:!1,id:"folderStruct",name:"KPI",spriteCssClass:"KPICDB folderCDB e-icon",tag:""},i.schemaData.model.pivotControl.schemaTreeView.splice(1,0,treeNodeElement),o.request="MDSCHEMA_KPIS",i.schemaData.model.pivotControl._getTreeData(o,i.schemaData.model.pivotControl.loadKPIElements,i)):t.isNullOrUndefined(i.schemaData)||i.schemaData._createTreeView(this,i.schemaData.model.pivotControl.schemaTreeView)},loadKPIElements:function(t,i){for(var i=t.schemaData.model.pivotControl.model.dataSource,f=this.reportItemNames,l=[],e=0;e<n(i).find("row").length;e++){var u=n(n(i).find("row")[e]),r=u.children("KPI_CAPTION").text(),o=u.children("KPI_goal").text(),s=u.children("KPI_STATUS").text(),h=u.children("KPI_TREND").text(),c=u.find("KPI_VALUE").text();n.inArray(u.children("KPI_NAME").text(),l)>=0||(treeNodeElement={hasChildren:!0,isChecked:!1,pid:"folderStruct",id:r,name:r,spriteCssClass:"measureGroupCDB e-icon",tag:r},t.schemaData.model.pivotControl.schemaTreeView.push(treeNodeElement),l.push(r));treeNodeElement={hasChildren:!0,isSelected:n.inArray(o,f)>=0,id:o,pid:r,name:t.schemaData.model.pivotControl._getLocalizedLabels("Goal"),spriteCssClass:"kpiGoal e-icon",tag:o};t.schemaData.model.pivotControl.schemaTreeView.push(treeNodeElement);treeNodeElement={hasChildren:!0,isSelected:n.inArray(s,f)>=0,id:s,pid:r,name:t.schemaData.model.pivotControl._getLocalizedLabels("Status"),spriteCssClass:"kpiStatus e-icon",tag:s};t.schemaData.model.pivotControl.schemaTreeView.push(treeNodeElement);treeNodeElement={hasChildren:!0,isSelected:n.inArray(h,f)>=0,id:h,pid:r,name:t.schemaData.model.pivotControl._getLocalizedLabels("Trend"),spriteCssClass:"kpiTrend e-icon",tag:h};t.schemaData.model.pivotControl.schemaTreeView.push(treeNodeElement);treeNodeElement={hasChildren:!0,isSelected:n.inArray(c,f)>=0,id:c,pid:r,name:t.schemaData.model.pivotControl._getLocalizedLabels("Value"),spriteCssClass:"kpiValue e-icon",tag:c};t.schemaData.model.pivotControl.schemaTreeView.push(treeNodeElement)}t.schemaData._createTreeView(this,t.schemaData.model.pivotControl.schemaTreeView);delete t.schemaData.model.pivotControl.reportItemNames;delete t.schemaData.model.pivotControl.schemaTreeView},_drillThroughCellClick:function(r,u){var s,f,h,e,c,o;if(u._waitingPopup.show(),f=n(r.currentTarget.parentElement).attr("p"),u.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode)u.doAjaxPost("POST",u.model.url+"/"+u.model.serviceMethodSettings.drillThroughDataTable,JSON.stringify({currentReport:JSON.parse(u.getOlapReport()).Report,layout:u.model.layout,cellPos:f,customObject:JSON.stringify(u.model.customObject)}),function(t){n(u.element).parents(".e-pivotclient").length>0?n(u.element).parents(".e-pivotclient").data("ejPivotClient")._trigger("drillThrough",{element:u.element,data:t}):u._trigger("drillThrough",{element:u.element,data:t})});else{for(h=n("#"+u._id).find("tbody").find("tr:first").find("th").length,i=0;i<h;i++)e=u.getJSONRecords()[parseInt(i*u._rowCount+parseInt(f.split(",")[1]))].Info.indexOf("Measures")!=-1||u.getJSONRecords()[parseInt(i*u._rowCount+parseInt(f.split(",")[1]))].RowSpan<=1?u.getJSONRecords()[parseInt(i*u._rowCount+parseInt(f.split(",")[1]))].Info.split("::")[0]:"",e.indexOf("Measures")!=-1&&(s=e),e!=""&&(u._rowHeader[i]=e);for(c=n("#"+u._id).find("tbody").find('[p="'+parseInt(f.split(",")[0])+","+parseInt(f.split(",")[1])+'"]').closest("tbody").prev().children("tr").length,i=0;i<c;i++)o=u.getJSONRecords()[parseInt(parseInt(f.split(",")[0])*u._rowCount+i)].Info.indexOf("Measures")!=-1||u.getJSONRecords()[parseInt(parseInt(f.split(",")[0])*u._rowCount+i)].ColSpan<=1?u.getJSONRecords()[parseInt(parseInt(f.split(",")[0])*u._rowCount+i)].Info.split("::")[0]:"",o.indexOf("Measures")!=-1&&(s=o),o!=""&&(u._colHeader[i]=o);for((t.isNullOrUndefined(u._fieldData)||!t.isNullOrUndefined(u._fieldData)&&t.isNullOrUndefined(u._fieldData.hierarchy))&&u._getFieldItemsInfo(u),j=0;j<u._fieldData.measures.length;j++)s==u._fieldData.measures[j].id&&(u.measureGrp=u._fieldData.measures[j].pid);u._rowHeader=n.grep(u._rowHeader,function(n){return n==0||n});u._colHeader=n.grep(u._colHeader,function(n){return n==0||n});u._createDrillThroughQuery("",u)}},openHierarchySelector:function(n,i){var r,u,f;n.model.operationalMode==t.Pivot.OperationalMode.ServerMode?this._createDrillThroughDialog(n,i):(n._waitingPopup.show(),r=n.target.className.indexOf("e-pivotclient")>=0?n._pivotGrid:n,u=r._getConnectionInfo(n.model.dataSource.data),f='<Envelope xmlns="http://schemas.xmlsoap.org/soap/envelope/"><Header/><Body><Discover xmlns="urn:schemas-microsoft-com:xml-analysis"><RequestType>MDSCHEMA_MEASUREGROUP_DIMENSIONS<\/RequestType><Restrictions><RestrictionList><CATALOG_NAME>'+n.model.dataSource.catalog+"<\/CATALOG_NAME><CUBE_NAME>"+n.model.dataSource.cube+"<\/CUBE_NAME><MEASUREGROUP_NAME>"+r.measureGrp+"<\/MEASUREGROUP_NAME><\/RestrictionList><\/Restrictions><Properties><PropertyList><Catalog>"+n.model.dataSource.catalog+"<\/Catalog> <LocaleIdentifier>"+u.LCID+"<\/LocaleIdentifier><\/PropertyList><\/Properties><\/Discover><\/Body><\/Envelope>",this.doAjaxPost("POST",u.url,{XMLA:f},r._loadDimensionElements,null,{pvtGridObj:r,action:"loadMeasureElements"}))},_createDrillThroughDialog:function(i,r){var e,u,o,f;i.model.operationalMode!=t.PivotGrid.OperationalMode.ServerMode&&r.shift();i.element.find(".e-dialog, .clientDialog").remove();var s=t.buildTag("label#",i._getLocalizedLabels("SelectHierarchy"))[0].outerHTML,h="<div class=cubeTable style='width:200px; overflow:auto'><div valign=\"bottom\">"+this._createHierarchyBrowser()+"<\/div><\/div>",c=t.buildTag("div#dropDlg.dropDlg",'<table class="outerTable"><tr><td>'+h+"<\/td><td>"+s+"<br><textarea id='hrSel' style='width:270px; height:300px; resize:none; margin:0px 5px 0 5px'><\/textarea><\/br><br><\/td><\/tr><\/table>")[0].outerHTML+"<\/br>",l=t.buildTag("div",t.buildTag("button#btnOK.dialogBtnOK",i._getLocalizedLabels("OK"))[0].outerHTML+t.buildTag("button#btnCancel.dialogBtnCancel",i._getLocalizedLabels("Cancel"))[0].outerHTML,{float:"right",margin:"-5px 0 6px"})[0].outerHTML,a=t.buildTag("div#clientDialog.clientDialog",c+l,{opacity:"1"}).attr("title","Hierarchy Selector")[0].outerHTML;for(n(a).appendTo("#"+i._id),n("#btnOK, #btnCancel").ejButton(),n("#btnOK, #btnCancel").css({margin:"0 20px 20px 0",width:"50px"}),i.element.find(".clientDialog").ejDialog({width:550,target:"#"+i._id,enableResize:!1,enableRTL:i.model.enableRTL,close:t.proxy(t.Pivot.closePreventPanel,i)}),i.element.find(".cubeTreeViewHierarchy").ejTreeView({showCheckbox:!0,fields:{id:"id",parentId:"pid",text:"name",isChecked:"isSelected",spriteCssClass:"spriteCssClass",dataSource:i.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode?n.parseJSON(r.d):r},allowDragAndDrop:!0,allowDropChild:!1,allowDropSibling:!1,enableRTL:i.model.enableRTL?!0:!1,beforeDelete:function(){return!1},dragAndDropAcrossControl:!0,nodeDropped:t.proxy(this._hierarchyNodeDropped,i)}),i._tableTreeObj=i.element.find(".cubeTreeViewHierarchy").data("ejTreeView"),i._tableTreeObj.element.find(".e-ul").css({width:"100%",height:"100%"}),i._tableTreeObj.element.find(".e-chkbox-wrap").remove(),e=i._tableTreeObj.element.find("li"),u=0;u<e.length;u++)o=i.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode?n.parseJSON(r.d)[u].tag:r[u].tag,e[u].setAttribute("tag",o);i._tableTreeObj&&i._tableTreeObj.element.find("li").mouseover(t.proxy(function(t){n(t.target).parent().find(".measureGroupCDB, .dimensionCDB, .folderCDB").length>0&&n(t.target).css("cursor","default")},i));f=i;n("#btnOK").click(function(){var i=n("#hrSel").val();n(".e-dialog, .clientDialog, .drilltableDialog").remove();f._waitingPopup.show();t.olap._mdxParser._createDrillThroughQuery(i,f);f._waitingPopup.hide()});n("#btnCancel").click(function(){n(".e-dialog, .clientDialog").remove();f._waitingPopup.hide()});i.model.enableRTL&&(n(".e-dialog").addClass("e-rtl"),n(".dialogBtnCancel").css("margin","0 -70px 0 0"))},_createHierarchyBrowser:function(){return t.buildTag("div.cubeBrowserHierarchy",t.buildTag("div.cubeTreeViewHierarchy")[0].outerHTML,{width:"200px",height:"300px",overflow:"auto"})[0].outerHTML},_hierarchyNodeDropped:function(i){var r,f,u;if(i.dropTarget[0].id=="hrSel"){for(r=n(n(i.droppedElement).children()[0]).find(".dimensionCDB").length>0?this.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode?n(i.droppedElement).find("li:first").attr("tag"):n(i.droppedElement).find("li:first")[0].id:n(i.droppedElement).find("li:first").length==0?this.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode?n(i.droppedElement.parent().parent()).attr("tag"):n(i.droppedElement.parent().parent())[0].id:this.model.operationalMode==t.PivotGrid.OperationalMode.ServerMode?n(i.droppedElement).attr("tag"):i.droppedElementData.id,r=r.replace("[","[$"),f=0;f<n("#hrSel").val().split(",").length;f++)if(r==n("#hrSel").val().split(",")[f])return!1;u=this.element.find("#hrSel").val();u.length!=0?(u=u+","+r,this.element.find("#hrSel").val(u)):this.element.find("#hrSel").val(r)}},_generateDrillData:function(t,i){for(var e=n(i).find("row").children(),r=n.map(e,function(n){var t=parseFloat(n.textContent),i=n.tagName.replace(/_x005B_/g,"[").replace(/_x0020_/g," ").replace(/_x005D_/g,"]").replace(/_x0024_/g,"$").replace("].[","]-[");return'"'+i+'":'+t}),o=r[0],u="",f=0;f<r.length;f++){if(r[f]==o){u+=u==""?"[{"+r[f]:"}, {"+r[f];continue}u+=","+r[f]}u+="}]";n(t.pvtGridObj.element).parents(".e-pivotclient").length>0?n(t.pvtGridObj.element).parents(".e-pivotclient").data("ejPivotClient")._trigger("drillThrough",{element:t.pvtGridObj.element,data:u}):t.pvtGridObj._trigger("drillThrough",{element:t.pvtGridObj.element,data:u})},_getEditorMember:function(i,r,u){var e;if(r.model.operationalMode==t.PivotGrid.OperationalMode.ClientMode){var h=r._getTreeViewItems(u?r._schemaData:r),c=n.extend(!0,[],u?r._schemaData._memberTreeObj.dataSource():r._memberTreeObj.dataSource()),o=n.map(h,function(i){if(i.Id!="All")return n.map(c,function(n){i.Id==n.id&&(i=n,i.name=t.isNullOrUndefined(i.parentId)?i.name+"_1":i.name)}),i}),f=[],s=n.map(o,function(t){return n.map(o,function(n){t.parentId==n.id&&(t.name=t.name+"_"+(Number(n.name.split("_")[n.name.split("_").length-1])+1))}),t});return n.map(s,function(n){var t=n.name.split("_")[n.name.split("_").length-2],i=Number(n.name.split("_")[n.name.split("_").length-1]),r=n.checkedStatus;f.push({name:t,checked:r,level:Number(i)})}),this._updateEditorMembers(i,f,r)}if(r.model.analysisMode==t.Pivot.AnalysisMode.Olap){var l=u?r._schemaData.element.find(".editorTreeView"):r.element.find(".editorTreeView"),f=[],s=n(l).find(":input.nodecheckbox");return n.map(s,function(t){if(n(t).parents("li:eq(0)").attr("id")!="All"){var i=n(t).parent().siblings("a").text(),r=t.value.split("_")[t.value.split("_").length-1],u=t.checked||n(t.parentElement).attr("aria-checked")=="mixed"?!0:!1;f.push({name:i,checked:u,level:Number(r)})}}),this._updateEditorMembers(i,f,r)}for(textArr=[],e=1;e<i.length;e++)textArr.push(n(i[e].parentElement).siblings("a").text());return textArr},_updateEditorMembers:function(i,r,u){var f,y,s,a;if(!t.isNullOrUndefined(u._fieldMembers[i])){var v=[],e=0,c="",o=u._fieldMembers[i];for(f=0;f<r.length;f++)if(t.isNullOrUndefined(o[f+e])||r[f].level==o[f+e].level)v.push(r[f]);else if(t.isNullOrUndefined(o[f+e])||r[f].level<o[f+e].level){s=f;do r[f-1].checked&&v.push(o[s]),e++,s++;while(r[f].level<o[s].level);f--}else if(t.isNullOrUndefined(o[f+e])||r[f].level>o[f+e].level){y=o[f+e].level;s=f;do v.push(r[s]),e--,s++,f=s-1;while(r[s].level>y)}}u._fieldMembers[i]=t.isNullOrUndefined(u._fieldMembers[i])?r:v;var l=1,p="",w="",h=[];do if(a=n.map(u._fieldMembers[i],function(n){if(n.level==l)return n}),h=n.map(a,function(n){if(n.checked)return n}),a.length==h.length)c=l==1?"All":p,a.length>1&&(w="All"),l++;else if(h.length==1)p=c=w=="All"?"multiple":h[0].name,l++;else if(h.length>1&&a.length>h.length){c="multiple";break}while(h.length>0&&c!="All"&&c!="multiple"&&n.map(u._fieldMembers[i],function(n){if(n.level==l)return n}).length>0);return c},_getTreeData:function(n,i,r){var u=t.olap.base._getConnectionInfo(n.url),f='<Envelope xmlns="http://schemas.xmlsoap.org/soap/envelope/"><Header/><Body><Discover xmlns="urn:schemas-microsoft-com:xml-analysis"><RequestType>'+n.request+"<\/RequestType><Restrictions><RestrictionList><CATALOG_NAME>"+n.catalog+"<\/CATALOG_NAME>"+(r.action=="loadcubelist"?"":"<CUBE_NAME>"+n.cube+"<\/CUBE_NAME>")+"<\/RestrictionList><\/Restrictions><Properties><PropertyList><Catalog>"+n.catalog+"<\/Catalog><LocaleIdentifier>"+u.LCID+"<\/LocaleIdentifier> <\/PropertyList><\/Properties><\/Discover><\/Body><\/Envelope>";r.action="loadFieldElements";this.doAjaxPost("POST",u.url,{XMLA:f},i,null,r)},updateTreeView:function(t){for(var o,f,e,u,i=0;i<t.element.find(".editorTreeView").find("li").length;i++)for(u=0;u<t._memberTreeObj.dataSource().length;u++)if(t.element.find(".editorTreeView").find("li")[i].id==t._memberTreeObj.dataSource()[u].id&&(n(t.element.find(".editorTreeView").find("li")[i]).find("span:first").attr("aria-checked")=="mixed"||n(t.element.find(".editorTreeView").find("li")[i]).find("span:first").attr("aria-checked")=="true")){t._memberTreeObj.dataSource()[u].checkedStatus=!0;break}else if(t.element.find(".editorTreeView").find("li")[i].id==t._memberTreeObj.dataSource()[u].id&&n(t.element.find(".editorTreeView").find("li")[i]).find("span:first").attr("aria-checked")=="false"){t._memberTreeObj.dataSource()[u].checkedStatus=!1;break}for(i=0;i<t._memberTreeObj.dataSource().length;i++)if(o=!1,t._memberTreeObj.dataSource()[i].checkedStatus==!0){for(u=0;u<t._memberTreeObj.dataSource().length;u++)if(t._memberTreeObj.dataSource()[u].hasOwnProperty("parentId")&&t._memberTreeObj.dataSource()[u].parentId==t._memberTreeObj.dataSource()[i].id&&t._memberTreeObj.dataSource()[u].checkedStatus==!0){o=!0;break}if(!o)for(f=0;f<t._memberTreeObj.dataSource().length;f++)t._memberTreeObj.dataSource()[f].hasOwnProperty("parentId")&&t._memberTreeObj.dataSource()[f].parentId==t._memberTreeObj.dataSource()[i].id&&(t._memberTreeObj.dataSource()[f].checkedStatus=!0)}else if(t._memberTreeObj.dataSource()[i].checkedStatus==!1)for(e=0;e<t._memberTreeObj.dataSource().length;e++)t._memberTreeObj.dataSource()[e].hasOwnProperty("parentId")&&t._memberTreeObj.dataSource()[e].parentId==t._memberTreeObj.dataSource()[i].id&&(t._memberTreeObj.dataSource()[e].checkedStatus=!1);for(i=0;i<t.element.find(".editorTreeView").find("li").length;i++)if(n(t.element.find(".editorTreeView").find("li")[i]).attr("tag")==null||r)for(u=0;u<t._memberTreeObj.dataSource().length;u++)if(n(t.element.find(".editorTreeView").find("li")[i])[0].id==t._memberTreeObj.dataSource()[u].id){n(t.element.find(".editorTreeView").find("li")[i]).attr("tag",t._memberTreeObj.dataSource()[u].tag);break}return t._memberTreeObj},getNodesState:function(n){for(var i="",r="",t=0;t<n.dataSource().length;t++)n.dataSource()[t].checkedStatus==!0?i+="::"+n.dataSource()[t].id+"||"+n.dataSource()[t].tag+"||"+n.dataSource()[t].parentId+"||"+n.dataSource()[t].name:r+="::"+n.dataSource()[t].parentId+"||"+n.dataSource()[t].tag+"||"+n.dataSource()[t].name;return{selectedNodes:i,unSelectedNodes:r}},removeParentSelectedNodes:function(t){for(var i,u=n.extend([],t),f=0;f<t.length;f++)for(i=0;i<u.length;i++)u[i].Id==t[f].parentId&&u.splice(i,1);return n.map(u,function(n){if(n.tag!=""&&n.tag!=r)return n.tag.replace(/\&/g,"&amp;")})},getChildNodes:function(i,u,f,e,o){var s=i.targetElement,p=e.cube,w=e.catalog,b=e.data,k=o._generateChildMembers,v=n(i.currentElement).find("li").length,h=!1,l,y,c,a;v==0&&(l=n(s).parents("li:eq(0)").attr("id"),y=n.map(f,function(i){if(i.fieldName==u&&!t.isNullOrUndefined(i.filterItems)){var f=i.filterItems;(t.isNullOrUndefined(o.model.pivotControl)?o.model.enableMemberEditorPaging:o.model.pivotControl.model.enableMemberEditorPaging)&&(f=n.grep(f,function(n){if(n.pageNo==o.model.pivotControl._memberPageSettings.currentMemeberPage)return n})[0].memberTreeObj.dataSource());n.map(f,function(n){n.parentId!=r&&n.parentId==l.replace(/\]*\]/g,"-").replace(/\[*\[/g,"-")&&(h=!0)})}}),i.isChildLoaded=h?!0:!1,h||(n(s).parents("li:eq(0)").attr("tag")==r&&(c=n.map(f,function(n){if(n.fieldName==u)return n})[0],c&&n.map(c.filterItems,function(t){t.id==n(s).parents("li:eq(0)").attr("id")&&n(s).parents("li:eq(0)").attr("tag",t.tag)})),a=n(s).parents("li:eq(0)").attr("tag").replace(/\&/g,"&amp;"),t.olap._mdxParser.getChildren(e,a,o)))},_getFilterParams:function(n,i,r){var o="",f,u,e;if(n!="schemaValue"){if(f="",!t.isNullOrUndefined(i))for(u=0;u<i.length;u++)if(!t.isNullOrUndefined(i[u][r]))for(e=0;e<i[u][r].length;e++)f+="##"+i[u][r][e];f!=""&&(o=n+"::"+r+"::FILTERED"+f)}return o},generateChildMembers:function(t,i){for(var e=n(i).find("Axis:eq(0) Tuple"),f=[],r=n("[tag='"+t.currentNode.replace(/&amp;/g,"&")+"']"),u=0;u<e.length;u++){var o=n(n(i).find("Axis:eq(0) Tuple:eq("+u+")").children().children()[0]).text(),s=n(n(i).find("Axis:eq(0) Tuple:eq("+u+")").children()).find("Caption").text(),h={hasChildren:n(e[u]).find("CHILDREN_CARDINALITY").text()!="0",checkedStatus:!1,id:o.replace(/\]*\]/g,"-").replace(/\[*\[/g,"-"),name:s,tag:o};f.push(h)}parentNode=n(r).parents("li").length>1?n(r).parents("li").first():n(r).parents("li");r.find(".e-load").removeClass("e-load");n(n(parentNode).find("input.nodecheckbox")[0]).ejCheckBox({checked:!1});this._memberTreeObj=n(".editorTreeView").data("ejTreeView");this._memberTreeObj.addNode(f,n(r));n.each(r.find("li"),function(n,t){t.setAttribute("tag",f[n].tag)})},createAdvanceFilterTag:function(r,u){var f="",k=t.buildTag("li.e-separator").css("margin-left","29px")[0].outerHTML,o=u.element.hasClass("e-pivotschemadesigner")?u.model.pivotControl.model.operationalMode:u.model.operationalMode,b=u.element.hasClass("e-pivotschemadesigner")?u.model.pivotControl.model.analysisMode:u.model.analysisMode,h,c,s,a,v,e,y,l,p,w;if(r.action=="filterTag")f=[{id:"ascOrder",text:"Sort A to Z",parentId:null,spriteCssClass:"ascImage e-icon"},{id:"descOrder",text:"Sort Z to A",parentId:null,spriteCssClass:"descImage e-icon"},{id:"clearSorting",text:"Clear Sorting ",parentId:null,spriteCssClass:"e-clrSort e-icon"},{id:"sep",parentId:null,text:"",spriteCssClass:"e-seperator"},{id:"clearAllFilters",text:"Clear Filter from ",parentId:null,spriteCssClass:"e-clrFilter e-icon"},{id:"labelFilterBtn",text:"Label Filters",parentId:null},{id:"valueFilterBtn",text:"Value Filters",parentId:null},{id:"labelClearFilter",parentId:"labelFilterBtn",text:u._getLocalizedLabels("ClearFilter"),spriteCssClass:"e-clrFilter e-icon"},{id:"sep",parentId:"labelFilterBtn",text:"",spriteCssClass:"e-seperator"},{id:"equals",parentId:"labelFilterBtn",text:u._getLocalizedLabels("Equals"),spriteCssClass:"sprite"},{id:"notequals",parentId:"labelFilterBtn",text:u._getLocalizedLabels("DoesNotEquals")+"...",spriteCssClass:"sprite"},{id:"sep",parentId:"labelFilterBtn",text:"",spriteCssClass:"e-seperator"},{id:"beginswith",parentId:"labelFilterBtn",text:u._getLocalizedLabels("BeginsWith")+"...",spriteCssClass:"sprite"},{id:"notbeginswith",parentId:"labelFilterBtn",text:u._getLocalizedLabels("DoesNotBeginsWith")+"...",spriteCssClass:"sprite"},{id:"endswith",parentId:"labelFilterBtn",text:u._getLocalizedLabels("EndsWith")+"...",spriteCssClass:"sprite"},{id:"notendswith",parentId:"labelFilterBtn",text:u._getLocalizedLabels("DoesNotEndsWith")+"...",spriteCssClass:"sprite"},{id:"sep",parentId:"labelFilterBtn",text:"",spriteCssClass:"e-seperator"},{id:"contains",parentId:"labelFilterBtn",text:u._getLocalizedLabels("Contains")+"...",spriteCssClass:"sprite"},{id:"notcontains",parentId:"labelFilterBtn",text:u._getLocalizedLabels("DoesNotContains")+"...",spriteCssClass:"sprite"},{id:"sep",parentId:"labelFilterBtn",text:"",spriteCssClass:"e-seperator"},{id:"greaterthan",parentId:"labelFilterBtn",text:u._getLocalizedLabels("GreaterThan")+"...",spriteCssClass:"sprite"},{id:"greaterthanorequalto",parentId:"labelFilterBtn",text:u._getLocalizedLabels("GreaterThanOrEqualTo")+"...",spriteCssClass:"sprite"},{id:"lessthan",parentId:"labelFilterBtn",text:u._getLocalizedLabels("LessThan")+"...",spriteCssClass:"sprite"},{id:"lessthanorequalto",parentId:"labelFilterBtn",text:u._getLocalizedLabels("LessThanOrEqualTo")+"...",spriteCssClass:"sprite"},{id:"valueClearFilter",parentId:"valueFilterBtn",text:u._getLocalizedLabels("ClearFilter"),spriteCssClass:"e-clrFilter e-icon"},{id:"sep",parentId:"valueFilterBtn",text:"",spriteCssClass:"e-seperator"},{id:"equals",parentId:"valueFilterBtn",text:u._getLocalizedLabels("Equals"),spriteCssClass:"equals"},{id:"notequals",parentId:"valueFilterBtn",text:u._getLocalizedLabels("DoesNotEquals")+"...",spriteCssClass:"sprite"},{id:"sep",parentId:"valueFilterBtn",text:"",spriteCssClass:"e-seperator"},{id:"greaterthan",parentId:"valueFilterBtn",text:u._getLocalizedLabels("GreaterThan")+"...",spriteCssClass:"sprite"},{id:"greaterthanorequalto",parentId:"valueFilterBtn",text:u._getLocalizedLabels("GreaterThanOrEqualTo")+"...",spriteCssClass:"sprite"},{id:"lessthan",parentId:"valueFilterBtn",text:u._getLocalizedLabels("LessThan")+"...",spriteCssClass:"sprite"},{id:"lessthanorequalto",parentId:"valueFilterBtn",text:u._getLocalizedLabels("LessThanOrEqualTo")+"...",spriteCssClass:"sprite"},{id:"sep",parentId:"valueFilterBtn",text:"",spriteCssClass:"e-seperator"},{id:"between",parentId:"valueFilterBtn",text:u._getLocalizedLabels("Between")+"...",spriteCssClass:"sprite"},{id:"notbetween",parentId:"valueFilterBtn",text:u._getLocalizedLabels("NotBetween")+"...",spriteCssClass:"sprite"},{id:"sep",parentId:"valueFilterBtn",text:"",spriteCssClass:"e-seperator"},{id:"topCount",parentId:"valueFilterBtn",text:u._getLocalizedLabels("Top10")+"...",spriteCssClass:"sprite"}],o==t.Pivot.OperationalMode.ClientMode||o==t.Pivot.OperationalMode.ServerMode&&b==t.Pivot.AnalysisMode.Pivot?f.splice(f.length-1,2):f.splice(0,5);else if(r.action=="clearFilter")f=t.buildTag("div.clearSorting",t.buildTag("span.e-clrSort","",{padding:"0px 10px 0px 4px"}).addClass("e-icon").attr("aria-label","clear sort")[0].outerHTML+t.buildTag("span.clearSortText","Clear Sorting",{padding:"5px 0px"})[0].outerHTML)[0].outerHTML+t.buildTag("div.separator",{padding:"5px 0px"})[0].outerHTML+t.buildTag("div.clearAllFilters",t.buildTag("span.e-clrFilter","",{padding:"0px 10px 0px 4px"}).addClass("e-icon").attr("aria-label"," clear filter")[0].outerHTML+t.buildTag("span.clearFltrText",'Clear Filter From "'+r.selectedLevel.text+'"',{padding:"5px 0px"})[0].outerHTML)[0].outerHTML;else if(r.action=="sort")f=t.buildTag("div#sortDiv.sortDiv",t.buildTag("li#ascOrder.ascOrder",t.buildTag("span.ascImage").addClass("e-icon").attr("aria-label","ascending")[0].outerHTML+u._getLocalizedLabels("Sort")+" A to Z")[0].outerHTML+t.buildTag("li#descOrder.descOrder",t.buildTag("span.descImage").addClass("e-icon").attr("aria-label","descending")[0].outerHTML+u._getLocalizedLabels("Sort")+" Z to A")[0].outerHTML)[0].outerHTML;else if(r.action=="labelFilterDlg"||r.action=="valueFilterDlg"){if(h="",c=[],r.action=="labelFilterDlg")h=t.buildTag("table.labelfilter",t.buildTag("tr",t.buildTag("td",u._getLocalizedLabels("LabelFilterLabel")).attr("colspan","2")[0].outerHTML)[0].outerHTML+t.buildTag("tr",t.buildTag("td","<input type='text' id='filterOptions' class='filterOptions'  style='width:220px'/>")[0].outerHTML+t.buildTag("td.filterValuesTd","<input type='text' id='filterValue1'  value='"+(r.filterInfo.length>0?o==t.Pivot.OperationalMode.ClientMode?r.filterInfo[0].values[0]:r.filterInfo[0].value1:"")+"' style='display:inline; width:160px; height:19px; margin-left:7px;' class='filterValues'/><\/br>")[0].outerHTML)[0].outerHTML)[0].outerHTML,c=[{value:"equals",option:u._getLocalizedLabels("Equals").toLowerCase()},{value:"not equals",option:u._getLocalizedLabels("DoesNotEquals").toLowerCase()},{value:"begins with",option:u._getLocalizedLabels("BeginsWith").toLowerCase()},{value:"not begins with",option:u._getLocalizedLabels("DoesNotBeginsWith").toLowerCase()},{value:"ends with",option:u._getLocalizedLabels("EndsWith").toLowerCase()},{value:"not ends with",option:u._getLocalizedLabels("DoesNotEndsWith").toLowerCase()},{value:"contains",option:u._getLocalizedLabels("Contains").toLowerCase()},{value:"not contains",option:u._getLocalizedLabels("DoesNotContains").toLowerCase()},{value:"greater than",option:u._getLocalizedLabels("IsGreaterThan").toLowerCase()},{value:"greater than or equal to",option:u._getLocalizedLabels("IsGreaterThanOrEqualTo").toLowerCase()},{value:"less than",option:u._getLocalizedLabels("IsLessThan").toLowerCase()},{value:"less than or equal to",option:u._getLocalizedLabels("IsLessThanOrEqualTo").toLowerCase()},];else{if(s=[],v=n(r.selectedArgs.element).attr("id")=="between"||n(r.selectedArgs.element).attr("id")=="notbetween"||r.selectedArgs.value=="between"||r.selectedArgs.value=="not between"?"4":"3",u.element.find(".cubeTreeView ").length>0)s=n.map(u.element.find(".cubeTreeView [tag*='[Measures]'] "),function(t){return{option:n(t).text(),value:n(t).attr("tag")}});else for(e=u.element.hasClass("e-pivotschemadesigner")?u.element.find(".schemaValue .pivotButton"):u.element.find(".groupingBarPivot .values .pivotButton"),e=u._schemaData&&e.length==0?n(u._schemaData.element.find(".schemaValue .pivotButton")):e,i=0;i<e.length;i++)s.push({option:n(e[i]).text(),value:n(e[i]).attr("tag").split(":")[1]});a=n(r.selectedArgs.element).hasClass("topCount")?t.buildTag("td","<input type='text' id='filterOptions' class='filterOptions' />").attr("width","80px")[0].outerHTML+t.buildTag("td","<input type='text' id='filterValue1' class='filterValues' />").attr("width","50px")[0].outerHTML+t.buildTag("td","<input type='text' id='filterMeasures' class='filterMeasures' />").attr("width","180px")[0].outerHTML:t.buildTag("td","<input type='text' id='filterMeasures' class='filterMeasures' />").attr("width","180px")[0].outerHTML+t.buildTag("td","<input type='text' id='filterOptions' class='filterOptions'/>").attr("width","180px")[0].outerHTML+t.buildTag("td.filterValuesTd","<input type='text' id='filterValue1' value='"+(r.filterInfo.length>0?o==t.Pivot.OperationalMode.ClientMode?r.filterInfo[0].values[0]:r.filterInfo[0].value1:"")+"' style='display:inline; width:190px; height:19px;' class='filterValues'/>"+(v=="4"?"<span> and <\/span><input type='text' id='filterValue2' value='"+(r.filterInfo.length>0?o==t.Pivot.OperationalMode.ClientMode&&!t.isNullOrUndefined(r.filterInfo[0].values[1])?r.filterInfo[0].values[1]:o==t.Pivot.OperationalMode.ServerMode&&!t.isNullOrUndefined(r.filterInfo[0].value2)?r.filterInfo[0].value2:"":"")+"' style='display:inline; width:190px; height:19px;' class='filterValues'/> <\/br>":"<\/br>"))[0].outerHTML;h=t.buildTag("table.valuefilter",t.buildTag("tr",t.buildTag("td",u._getLocalizedLabels("ValueFilterLabel")).attr("colspan",r.text=="Between"?"4":"3")[0].outerHTML)[0].outerHTML+t.buildTag("tr",a)[0].outerHTML)[0].outerHTML;c=[{value:"equals",option:u._getLocalizedLabels("Equals").toLowerCase()},{value:"not equals",option:u._getLocalizedLabels("DoesNotEquals").toLowerCase()},{value:"greater than",option:u._getLocalizedLabels("IsGreaterThan").toLowerCase()},{value:"greater than or equal to",option:u._getLocalizedLabels("IsGreaterThanOrEqualTo").toLowerCase()},{value:"less than",option:u._getLocalizedLabels("IsLessThan").toLowerCase()},{value:"less than or equal to",option:u._getLocalizedLabels("IsLessThanOrEqualTo").toLowerCase()},{value:"between",option:u._getLocalizedLabels("Between").toLowerCase()},{value:"not between",option:u._getLocalizedLabels("NotBetween").toLowerCase()}]}y=t.buildTag("div",t.buildTag("button#filterDlgOKBtn.dialogOKBtn","OK")[0].outerHTML+t.buildTag("button#filterDlgCancelBtn.dialogCancelBtn","Cancel")[0].outerHTML,{float:u.model.enableRTL?"left":"right",margin:"8px 0 6px"})[0].outerHTML;u.element.find(".e-dialog").remove();n(t.buildTag("div#filterDialog.filterDialog",h+y,{opacity:"1"})).appendTo("#"+u._id);u.element.find(".filterDialog").ejDialog({enableRTL:u.model.enableRTL,enableResize:!1,width:"auto",content:"#"+u._id,close:t.proxy(t.Pivot.closePreventPanel,u)});r.action=="valueFilterDlg"&&(u.element.find(".filterMeasures").ejDropDownList({dataSource:s,width:"180px",height:"25px",fields:{text:"option",value:"value"}}),u._measureDDL=u.element.find(".filterMeasures").data("ejDropDownList"),l=s.length>0?s[0].value:r.filterInfo.length>0?r.filterInfo[0].measure:"",l!=""&&u._measureDDL.selectItemByValue(l));n(r.selectedArgs.element).attr("id")=="topCount"?(u.element.find("#filterOptions").ejDropDownList({dataSource:[{option:"Top",value:"topCount"},{option:"Bottom",value:"BottomCount"}],fields:{text:"option",value:"value"},value:r.filterInfo.length>0?r.filterInfo[0].operator:"topCount"}),u.element.find("#filterValue1").ejNumericTextbox({value:r.filterInfo.length>0?parseInt(r.filterInfo[0].value1):5,minValue:1})):(p=n(r.selectedArgs.element).parent().children("li:not(#sep)").index(r.selectedArgs.element),u.element.find(".filterOptions").ejDropDownList({dataSource:c,width:"180px",height:"25px",fields:{value:"value",text:"option"},selectedIndices:[p-1],change:t.proxy(u._filterOptionChanged,u)}),n(r.selectedArgs.element).length==0&&(w=u.element.find(".filterOptions").data("ejDropDownList"),w.selectItemByValue(r.selectedArgs.selectedValue)));u.element.find("#filterDlgOKBtn").ejButton({type:t.ButtonType.Button,click:t.proxy(u._filterElementOkBtnClick,u)});u.element.find("#filterDlgCancelBtn").ejButton({type:t.ButtonType.Button,click:function(){n(".e-dialog").hide();t.Pivot.closePreventPanel(u)}});u.element.find(".e-titlebar").prepend(t.buildTag("div",(r.action=="valueFilterDlg"?"Value Filter (":"Label Filter (")+(u._selectedLevelUniqueName.indexOf(".")==-1?u._selectedLevelUniqueName:u._selectedLevelUniqueName.indexOf(".")<0?u._selectedLevelUniqueName:u._selectedLevelUniqueName.split(".")[2].replace(/\[/g,"").replace(/\]/g,""))+")",{display:"inline"}))}return f}};t.Pivot.SortOrder={None:"none",Ascending:"ascending",Descending:"descending"};t.Pivot.AdvancedFilterType={LabelFilter:"label",ValueFilter:"value"};t.Pivot.ValueFilterOptions={None:"none",Equals:"equals",NotEquals:"notequals",GreaterThan:"greaterthan",GreaterThanOrEqualTo:"greaterthanorequalto",LessThan:"lessthan",LessThanOrEqualTo:"lessthanorequalto",Between:"between",NotBetween:"notbetween"};t.Pivot.LabelFilterOptions={None:"none",BeginsWith:"beginswith",NotBeginsWith:"notbeginswith",EndsWith:"endswith",NotEndsWith:"notendswith",Contains:"contains",NotContains:"notcontains",Equals:"equals",NotEquals:"notequals",GreaterThan:"greaterthan",GreaterThanOrEqualTo:"greaterthanorequalto",LessThan:"lessthan",LessThanOrEqualTo:"lessthanorequalto",Between:"between",NotBetween:"notbetween"};t.Pivot.AnalysisMode={Olap:"olap",Pivot:"pivot"};t.Pivot.OperationalMode={ClientMode:"clientmode",ServerMode:"servermode"}}(jQuery,Syncfusion)});
